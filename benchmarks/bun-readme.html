<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8" />
    <title>github-md</title>
    <meta name="description" content="A markdown parser API for GitHub" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/@exampledev/new.css@1.1.3/new.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/highlight.js@11.5.1/styles/a11y-dark.css"
    />
  </head>
  <body>
    <main>
      <custom-element>
        <article>
          <h1 id="bun">bun</h1>
          <p>
            <a href="https://bun.sh"
              ><img
                src="https://user-images.githubusercontent.com/709451/182802334-d9c42afe-f35d-4a7b-86ea-9985f73f20c3.png"
                alt="Logo"
                height="170"
            /></a>
            <br />
            <br />
            <a href="https://bun.sh/discord" target="_blank"
              ><img
                height="20"
                src="https://img.shields.io/discord/876711213126520882"
            /></a>
          </p>

          <p>bun is a new:</p>
          <ul>
            <li>
              JavaScript runtime with Web APIs like
              <a href="https://developer.mozilla.org/en-US/docs/Web/API/fetch"
                ><code>fetch</code></a
              >,
              <a
                href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket"
                ><code>WebSocket</code></a
              >, and several more built-in. bun embeds JavaScriptCore, which
              tends to be faster and more memory efficient than more popular
              engines like V8 (though harder to embed)
            </li>
            <li>JavaScript/TypeScript/JSX transpiler</li>
            <li>JavaScript &amp; CSS bundler</li>
            <li>Task runner for package.json scripts</li>
            <li>npm-compatible package manager</li>
          </ul>
          <p>
            All in one fast &amp; easy-to-use tool. Instead of 1,000
            node_modules for development, you only need bun.
          </p>
          <p>
            <strong>bun is experimental software</strong>. Join
            <a href="https://bun.sh/discord">bun’s Discord</a> for help and have
            a look at
            <a href="#not-implemented-yet">things that don’t work yet</a>.
          </p>
          <p>Today, bun's primary focus is bun.js: bun's JavaScript runtime.</p>
          <h2 id="install">Install</h2>
          <p>
            Native: (macOS x64 &amp; Silicon, Linux x64, Windows Subsystem for
            Linux)
          </p>
          <pre><code class="hljs language-sh">curl -fsSL https://bun.sh/install | bash
  </code></pre>
          <p>Homebrew: (MacOS and Linux)</p>
          <pre><code class="hljs language-sh">brew tap oven-sh/bun
  brew install bun
  </code></pre>
          <p>Docker: (Linux x64)</p>
          <pre><code class="hljs language-sh">docker pull jarredsumner/bun:edge
  docker run --<span class="hljs-built_in">rm</span> --init --<span class="hljs-built_in">ulimit</span> memlock=-1:-1 jarredsumner/bun:edge
  </code></pre>
          <p>
            If using Linux, kernel version 5.6 or higher is strongly
            recommended, but the minimum is 5.1.
          </p>
          <h2 id="upgrade">Upgrade</h2>
          <p>To upgrade to the latest version of Bun, run:</p>
          <pre><code class="hljs language-sh">bun upgrade
  </code></pre>
          <p>
            Bun automatically releases a canary build on every commit to
            <code>main</code>. To upgrade to the latest canary build, run:
          </p>
          <pre><code class="hljs language-sh">bun upgrade --canary
  </code></pre>
          <p>
            <a href="https://github.com/oven-sh/bun/releases/tag/canary"
              >View canary build</a
            >
          </p>
          <p><sup>Canary builds are released without automated tests</sup></p>
          <h2 id="table-of-contents">Table of Contents</h2>
          <ul>
            <li><a href="#install">Install</a></li>
            <li>
              <a href="#using-bunjs---a-new-javascript-runtime-environment"
                >Using bun.js - a new JavaScript runtime environment</a
              >
              <ul>
                <li>
                  <a href="#types-for-bunjs-editor-autocomplete"
                    >Types for bun.js (editor autocomplete)</a
                  >
                </li>
                <li>
                  <a href="#fast-paths-for-web-apis">Fast paths for Web APIs</a>
                </li>
              </ul>
            </li>
            <li>
              <a href="#using-bun-as-a-package-manager"
                >Using bun as a package manager</a
              >
            </li>
            <li>
              <a href="#using-bun-as-a-task-runner"
                >Using bun as a task runner</a
              >
            </li>
            <li>
              <a href="#creating-a-discord-bot-with-bun"
                >Creating a Discord bot with Bun</a
              >
              <ul>
                <li>
                  <a href="#application-commands">Application Commands</a>
                </li>
              </ul>
            </li>
            <li><a href="#using-bun-with-nextjs">Using bun with Next.js</a></li>
            <li>
              <a href="#using-bun-with-single-page-apps"
                >Using bun with single page apps</a
              >
              <ul>
                <li>
                  <a href="#using-bun-with-create-react-app"
                    >Using bun with Create React App</a
                  >
                </li>
              </ul>
            </li>
            <li>
              <a href="#using-bun-with-typescript">Using bun with TypeScript</a>
              <ul>
                <li>
                  <a href="#transpiling-typescript-with-bun"
                    >Transpiling TypeScript with Bun</a
                  >
                </li>
                <li>
                  <a href="#adding-type-definitions">Adding Type Definitions</a>
                </li>
              </ul>
            </li>
            <li>
              <a href="#not-implemented-yet">Not implemented yet</a>
              <ul>
                <li>
                  <a href="#limitations--intended-usage"
                    >Limitations &amp; intended usage</a
                  >
                </li>
                <li>
                  <a href="#upcoming-breaking-changes"
                    >Upcoming breaking changes</a
                  >
                </li>
              </ul>
            </li>
            <li>
              <a href="#configuration">Configuration</a>
              <ul>
                <li><a href="#bunfigtoml">bunfig.toml</a></li>
                <li><a href="#loaders">Loaders</a></li>
                <li>
                  <a href="#css-in-js-bun-dev-only">CSS in JS</a>
                  <ul>
                    <li>
                      <a href="#when-platform-is-browser"
                        >When <code>platform</code> is <code>browser</code></a
                      >
                    </li>
                    <li>
                      <a href="#when-platform-is-bun"
                        >When <code>platform</code> is <code>bun</code></a
                      >
                    </li>
                  </ul>
                </li>
                <li><a href="#css-loader">CSS Loader</a></li>
                <li><a href="#css-runtime">CSS runtime</a></li>
                <li><a href="#frameworks">Frameworks</a></li>
              </ul>
            </li>
            <li>
              <a href="#troubleshooting">Troubleshooting</a>
              <ul>
                <li>
                  <a href="#bun-not-running-on-an-m1-or-apple-silicon"
                    >bun not running on an M1 (or Apple Silicon)</a
                  >
                </li>
                <li><a href="#error-unexpected">error: Unexpected</a></li>
                <li>
                  <a href="#bun-install-is-stuck">bun install is stuck</a>
                </li>
                <li>
                  <a href="#unzip-is-required">Unzip is required</a>
                  <ul>
                    <li>
                      <a href="#debian--ubuntu--mint">Debian / Ubuntu / Mint</a>
                    </li>
                    <li>
                      <a href="#redhat--centos--fedora"
                        >RedHat / CentOS / Fedora</a
                      >
                    </li>
                    <li><a href="#arch--manjaro">Arch / Manjaro</a></li>
                    <li><a href="#opensuse">OpenSUSE</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li>
              <a href="#reference">Reference</a>
              <ul>
                <li>
                  <a href="#bun-install"><code>bun install</code></a>
                  <ul>
                    <li>
                      <a href="#configuring-bun-install-with-bunfigtoml"
                        >Configuring bun install with
                        <code>bunfig.toml</code></a
                      >
                    </li>
                    <li>
                      <a href="#configuring-with-environment-variables"
                        >Configuring with environment variables</a
                      >
                    </li>
                    <li>
                      <a href="#platform-specific-dependencies"
                        >Platform-specific dependencies?</a
                      >
                    </li>
                    <li><a href="#peer-dependencies">Peer dependencies?</a></li>
                    <li><a href="#lockfile">Lockfile</a></li>
                    <li><a href="#why-is-it-binary">Why is it binary?</a></li>
                    <li>
                      <a href="#how-do-i-inspect-it">How do I inspect it?</a>
                    </li>
                    <li>
                      <a href="#what-does-the-lockfile-store"
                        >What does the lockfile store?</a
                      >
                    </li>
                    <li><a href="#why-is-it-fast">Why is it fast?</a></li>
                    <li><a href="#cache">Cache</a></li>
                    <li>
                      <a href="#npm-registry-metadata">npm registry metadata</a>
                    </li>
                  </ul>
                </li>
                <li>
                  <a href="#bun-run"><code>bun run</code></a>
                </li>
                <li>
                  <a href="#bun-create"><code>bun create</code></a>
                  <ul>
                    <li><a href="#usage">Usage</a></li>
                    <li><a href="#local-templates">Local templates</a></li>
                    <li><a href="#flags">Flags</a></li>
                    <li>
                      <a href="#publishing-a-new-template"
                        >Publishing a new template</a
                      >
                    </li>
                    <li>
                      <a href="#testing-your-new-template"
                        >Testing your new template</a
                      >
                    </li>
                    <li><a href="#config">Config</a></li>
                    <li>
                      <a href="#how-bun-create-works"
                        >How <code>bun create</code> works</a
                      >
                    </li>
                  </ul>
                </li>
                <li>
                  <a href="#bun-init"><code>bun init</code></a>
                </li>
                <li>
                  <a href="#bun-bun"><code>bun bun</code></a>
                  <ul>
                    <li><a href="#why-bundle">Why bundle?</a></li>
                    <li>
                      <a href="#what-is-bun">What is <code>.bun</code>?</a>
                    </li>
                    <li>
                      <a href="#position-independent-code"
                        >Position-independent code</a
                      >
                    </li>
                    <li><a href="#where-is-the-code">Where is the code?</a></li>
                    <li><a href="#advanced">Advanced</a></li>
                    <li>
                      <a href="#what-is-the-module-id-hash"
                        >What is the module ID hash?</a
                      >
                    </li>
                  </ul>
                </li>
                <li>
                  <a href="#bun-upgrade"><code>bun upgrade</code></a>
                </li>
                <li>
                  <a href="#bun-completions"><code>bun completions</code></a>
                </li>
              </ul>
            </li>
            <li>
              <a href="#bunserve---fast-http-server"
                ><code>Bun.serve</code> - fast HTTP server</a
              >
              <ul>
                <li><a href="#usage-1">Usage</a></li>
                <li><a href="#https-with-bunserve">HTTPS</a></li>
                <li><a href="#websockets-with-bunserve">WebSockets</a></li>
                <li><a href="#error-handling">Error handling</a></li>
              </ul>
            </li>
            <li>
              <a href="#bunwrite--optimizing-io"
                ><code>Bun.write</code> – optimizing I/O</a
              >
            </li>
            <li>
              <a href="#bunspawn--spawn-a-process"
                ><code>Bun.spawn</code> - spawn processes</a
              >
            </li>
            <li>
              <a href="#bunwhich--find-the-path-to-a-binary"
                ><code>Bun.which</code> - find the path to a bin</a
              >
            </li>
            <li>
              <a href="#bunsqlite-sqlite3-module"
                >bun:sqlite (SQLite3 module)</a
              >
              <ul>
                <li><a href="#bunsqlite-benchmark">bun:sqlite Benchmark</a></li>
                <li>
                  <a href="#getting-started-with-bunsqlite"
                    >Getting started with bun:sqlite</a
                  >
                </li>
                <li>
                  <a href="#database"><code>Database</code></a>
                  <ul>
                    <li>
                      <a href="#databaseprototypequery"
                        >Database.prototype.query</a
                      >
                    </li>
                    <li>
                      <a href="#databaseprototypeprepare"
                        >Database.prototype.prepare</a
                      >
                    </li>
                    <li>
                      <a href="#databaseprototypeexec--databaseprototyperun"
                        >Database.prototype.exec &amp; Database.prototype.run</a
                      >
                    </li>
                    <li>
                      <a href="#databaseprototypeserialize"
                        >Database.prototype.serialize</a
                      >
                    </li>
                    <li>
                      <a href="#databaseprototypeloadextension"
                        >Database.prototype.loadExtension</a
                      >
                    </li>
                  </ul>
                </li>
                <li>
                  <a href="#statement">Statement</a>
                  <ul>
                    <li><a href="#statementall">Statement.all</a></li>
                    <li><a href="#statementvalues">Statement.values</a></li>
                    <li><a href="#statementget">Statement.get</a></li>
                    <li><a href="#statementrun">Statement.run</a></li>
                    <li><a href="#statementfinalize">Statement.finalize</a></li>
                    <li>
                      <a href="#statementtostring">Statement.toString()</a>
                    </li>
                  </ul>
                </li>
                <li><a href="#datatypes">Datatypes</a></li>
              </ul>
            </li>
            <li>
              <a href="#bunffi-foreign-functions-interface"
                ><code>bun:ffi</code> (Foreign Functions Interface)</a
              >
              <ul>
                <li><a href="#low-overhead-ffi">Low-overhead FFI</a></li>
                <li><a href="#usage-2">Usage</a></li>
                <li>
                  <a href="#supported-ffi-types-ffitype"
                    >Supported FFI types (<code>FFIType</code>)</a
                  >
                </li>
                <li>
                  <a href="#strings-cstring">Strings (<code>CString</code>)</a>
                  <ul>
                    <li>
                      <a href="#returning-a-string">Returning a string</a>
                    </li>
                  </ul>
                </li>
                <li>
                  <a href="#function-pointers-CFunction"
                    >Function pointers (<code>CFunction</code>)</a
                  >
                </li>
                <li>
                  <a href="#pointers">Pointers</a>
                  <ul>
                    <li><a href="#passing-a-pointer">Passing a pointer</a></li>
                    <li><a href="#reading-pointers">Reading pointers</a></li>
                    <li>
                      <a href="#not-implemented-yet-1">Not implemented yet</a>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><a href="#node-api-napi">Node-API (napi)</a></li>
            <li>
              <a href="#buntranspiler"><code>Bun.Transpiler</code></a>
              <ul>
                <li>
                  <a href="#buntranspilertransformsync"
                    ><code>Bun.Transpiler.transformSync</code></a
                  >
                </li>
                <li>
                  <a href="#buntranspilertransform"
                    ><code>Bun.Transpiler.transform</code></a
                  >
                </li>
                <li>
                  <a href="#buntranspilerscan"
                    ><code>Bun.Transpiler.scan</code></a
                  >
                </li>
                <li>
                  <a href="#buntranspilerscanimports"
                    ><code>Bun.Transpiler.scanImports</code></a
                  >
                </li>
              </ul>
            </li>
            <li>
              <a href="#bunpeek---read-a-promise-without-resolving-it"
                ><code>Bun.peek</code> - read a promise same-tick</a
              >
            </li>
            <li>
              <a href="#module-resolution-in-bun">Module resolution in Bun</a>
            </li>
            <li><a href="#environment-variables">Environment variables</a></li>
            <li><a href="#credits">Credits</a></li>
            <li><a href="#license">License</a></li>
            <li>
              <a href="#developing-bun">Developing bun</a>
              <ul>
                <li>
                  <a href="#dev-container-linuxwindows"
                    >Dev Container (Linux/Windows)</a
                  >
                </li>
                <li>
                  <a href="#macos">MacOS</a>
                  <ul>
                    <li><a href="#build-bun-macos">Build bun (macOS)</a></li>
                    <li>
                      <a href="#verify-it-worked-macos"
                        >Verify it worked (macOS)</a
                      >
                    </li>
                    <li>
                      <a href="#troubleshooting-macos"
                        >Troubleshooting (macOS)</a
                      >
                    </li>
                  </ul>
                </li>
                <li>
                  <a href="#troubleshooting-general"
                    >Troubleshooting (general)</a
                  >
                </li>
              </ul>
            </li>
            <li><a href="#vscode-zig">vscode-zig</a></li>
          </ul>
          <h2 id="using-bunjs---a-new-javascript-runtime-environment">
            Using bun.js - a new JavaScript runtime environment
          </h2>
          <p>
            bun.js focuses on performance, developer experience and
            compatibility with the JavaScript ecosystem.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-comment">// http.ts</span>
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-attr">port</span>: <span class="hljs-number">3000</span>,
    <span class="hljs-title function_">fetch</span>(<span class="hljs-params">request: Request</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">"Hello World"</span>);
    },
  };
  
  <span class="hljs-comment">// bun ./http.ts</span>
  </code></pre>
          <table>
            <thead>
              <tr>
                <th>Requests per second</th>
                <th>OS</th>
                <th>CPU</th>
                <th>bun version</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <a
                    href="https://twitter.com/jarredsumner/status/1512040623200616449"
                    >260,000</a
                  >
                </td>
                <td>macOS</td>
                <td>Apple Silicon M1 Max</td>
                <td>0.0.76</td>
              </tr>
              <tr>
                <td>
                  <a
                    href="https://twitter.com/jarredsumner/status/1511988933587976192"
                    >160,000</a
                  >
                </td>
                <td>Linux</td>
                <td>AMD Ryzen 5 3600 6-Core 2.2ghz</td>
                <td>0.0.76</td>
              </tr>
            </tbody>
          </table>

          Measured with
          <a
            target="_blank"
            href="https://github.com/uNetworking/uSockets/blob/master/examples/http_load_test.c"
            >http_load_test</a
          >
          by running:

          <pre><code class="hljs language-bash">./http_load_test  20 127.0.0.1 3000
  </code></pre>

          <p>
            bun.js prefers Web API compatibility instead of designing new APIs
            when possible. bun.js also implements some Node.js APIs.
          </p>
          <ul>
            <li>
              TypeScript &amp; JSX support is built-in, powered by Bun's
              JavaScript transpiler
            </li>
            <li>
              ESM &amp; CommonJS modules are supported (internally, bun.js uses
              ESM)
            </li>
            <li>
              Many npm packages "just work" with bun.js (when they use few/no
              node APIs)
            </li>
            <li>
              tsconfig.json <code>"paths"</code> is natively supported, along
              with <code>"exports"</code> in package.json
            </li>
            <li>
              <code>fs</code>, <code>path</code>, and <code>process</code> from
              Node are partially implemented
            </li>
            <li>
              Web APIs like
              <a href="https://developer.mozilla.org/en-US/docs/Web/API/fetch"
                ><code>fetch</code></a
              >,
              <a
                href="https://developer.mozilla.org/en-US/docs/Web/API/Response"
                ><code>Response</code></a
              >,
              <a href="https://developer.mozilla.org/en-US/docs/Web/API/URL"
                ><code>URL</code></a
              >
              and more are built-in
            </li>
            <li>
              <a
                href="https://developers.cloudflare.com/workers/runtime-apis/html-rewriter/"
                ><code>HTMLRewriter</code></a
              >
              makes it easy to transform HTML in bun.js
            </li>
            <li>
              Starts
              <a
                href="https://twitter.com/jarredsumner/status/1499225725492076544"
                >4x faster than Node</a
              >
              (try it yourself)
            </li>
            <li>
              <code>.env</code> files automatically load into
              <code>process.env</code> and <code>Bun.env</code>
            </li>
            <li>top level await</li>
          </ul>
          <p>
            The runtime uses JavaScriptCore, the JavaScript engine powering
            WebKit and Safari. Some web APIs like
            <a href="https://developer.mozilla.org/en-US/docs/Web/API/Headers"
              ><code>Headers</code></a
            >
            and
            <a href="https://developer.mozilla.org/en-US/docs/Web/API/URL"
              ><code>URL</code></a
            >
            directly use
            <a
              href="https://github.com/oven-sh/bun/blob/HEAD/src/bun.js/bindings/webcore/JSFetchHeaders.cpp"
              >Safari's implementation</a
            >.
          </p>
          <p>
            <code>cat</code> clone that runs
            <a
              href="https://twitter.com/jarredsumner/status/1511707890708586496"
              >2x faster than GNU cat</a
            >
            for large files on Linux
          </p>
          <pre><code class="hljs language-js"><span class="hljs-comment">// cat.js</span>
  <span class="hljs-keyword">import</span> { resolve } <span class="hljs-keyword">from</span> <span class="hljs-string">"path"</span>;
  <span class="hljs-keyword">import</span> { write, stdout, file, argv } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun"</span>;
  
  <span class="hljs-keyword">const</span> path = <span class="hljs-title function_">resolve</span>(argv.<span class="hljs-title function_">at</span>(-<span class="hljs-number">1</span>));
  
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">write</span>(
    <span class="hljs-comment">// stdout is a Blob</span>
    stdout,
    <span class="hljs-comment">// file(path) returns a Blob - https://developer.mozilla.org/en-US/docs/Web/API/Blob</span>
    <span class="hljs-title function_">file</span>(path),
  );
  
  <span class="hljs-comment">// bun ./cat.js ./path-to-file</span>
  </code></pre>
          <p>Read lines from standard input:</p>
          <pre><code class="hljs language-ts"><span class="hljs-comment">// As of Bun v0.3.0, console is an AsyncIterable</span>
  <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> line <span class="hljs-keyword">of</span> <span class="hljs-variable language_">console</span>) {
    <span class="hljs-comment">// line of text from stdin</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(line);
  }
  </code></pre>
          <p>Server-side render React:</p>
          <pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { renderToReadableStream } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-dom/server"</span>;
  
  <span class="hljs-keyword">const</span> dt = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">DateTimeFormat</span>();
  
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-attr">port</span>: <span class="hljs-number">3000</span>,
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-params">request: Request</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">renderToReadableStream</span>(
          <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Hello World<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello from React!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>The date is {dt.format(new Date())}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>,
        ),
      );
    },
  };
  </code></pre>
          <p>Write to stdout with <code>console.write</code>:</p>
          <pre><code class="hljs language-js"><span class="hljs-comment">// no trailing newline</span>
  <span class="hljs-comment">// works with strings and typed arrays</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">"Hello World!"</span>);
  </code></pre>
          <p>
            There are some more examples in the
            <a href="./examples">examples</a> folder.
          </p>
          <p>PRs adding more examples are very welcome!</p>
          <h3 id="types-for-bunjs-editor-autocomplete">
            Types for bun.js (editor autocomplete)
          </h3>
          <p>
            The best docs right now are the TypeScript types in the
            <a
              href="https://github.com/oven-sh/bun/tree/main/packages/bun-types"
              ><code>bun-types</code></a
            >
            npm package. A docs site is coming soon.
          </p>
          <p>To get autocomplete for bun.js types in your editor,</p>
          <ol>
            <li>Install the <code>bun-types</code> npm package:</li>
          </ol>
          <pre><code class="hljs language-bash"><span class="hljs-comment"># yarn/npm/pnpm work too, "bun-types" is an ordinary npm package</span>
  bun add bun-types
  </code></pre>
          <ol>
            <li>
              Add this to your <code>tsconfig.json</code> or
              <code>jsconfig.json</code>:
            </li>
          </ol>
          <pre><code class="hljs language-jsonc">{
    "compilerOptions": {
      "lib": ["ESNext"],
      "module": "esnext",
      "target": "esnext",
      "moduleResolution": "node",
      // "bun-types" is the important part
      "types": ["bun-types"]
    }
  }
  </code></pre>
          <p>
            You can also
            <a
              href="https://github.com/oven-sh/bun/tree/main/packages/bun-types"
              >view the types here</a
            >.
          </p>
          <p>
            To contribute to the types, head over to
            <a
              href="https://github.com/oven-sh/bun/tree/main/packages/bun-types"
              >packages/bun-types</a
            >.
          </p>
          <h3 id="fast-paths-for-web-apis">Fast paths for Web APIs</h3>
          <p>
            bun.js has fast paths for common use cases that make Web APIs live
            up to the performance demands of servers and CLIs.
          </p>
          <p>
            <code>Bun.file(path)</code> returns a
            <a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob"
              ><code>Blob</code></a
            >
            that represents a lazily-loaded file.
          </p>
          <p>
            When you pass a file blob to <code>Bun.write</code>, Bun
            automatically uses a faster system call:
          </p>
          <pre><code class="hljs language-js"><span class="hljs-keyword">const</span> blob = <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">file</span>(<span class="hljs-string">"input.txt"</span>);
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">"output.txt"</span>, blob);
  </code></pre>
          <p>
            On Linux, this uses the
            <a
              href="https://man7.org/linux/man-pages/man2/copy_file_range.2.html"
              ><code>copy_file_range</code></a
            >
            syscall and on macOS, this becomes <code>clonefile</code> (or
            <a
              href="https://developer.apple.com/library/archive/documentation/System/Conceptual/ManPages_iPhoneOS/man3/copyfile.3.html"
              ><code>fcopyfile</code></a
            >).
          </p>
          <p>
            <code>Bun.write</code> also supports
            <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response"
              ><code>Response</code></a
            >
            objects. It automatically converts to a
            <a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob"
              ><code>Blob</code></a
            >.
          </p>
          <pre><code class="hljs language-js"><span class="hljs-comment">// Eventually, this will stream the response to disk but today it buffers</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">"index.html"</span>, <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"https://example.com"</span>));
  </code></pre>
          <h2 id="using-bun-as-a-package-manager">
            Using bun as a package manager
          </h2>
          <p>
            On Linux, <code>bun install</code> tends to install packages 20x -
            100x faster than <code>npm install</code>. On macOS, it’s more like
            4x - 80x.
          </p>
          <img
            src="https://user-images.githubusercontent.com/709451/147004342-571b6123-17a9-49a2-8bfd-dcfc5204047e.png"
            height="200"
          />

          <p>To install packages from package.json:</p>
          <pre><code class="hljs language-bash">bun install
  </code></pre>
          <p>To add or remove packages from package.json:</p>
          <pre><code class="hljs language-bash">bun remove react
  bun add preact
  </code></pre>
          <strong>For Linux users</strong>: <code>bun install</code> needs Linux
          Kernel 5.6 or higher to work well

          <p>
            The minimum Linux Kernel version is 5.1. If you're on Linux kernel
            5.1 - 5.5, <code>bun install</code> should still work, but HTTP
            requests will be slow due to a lack of support for io_uring's
            <code>connect()</code> operation.
          </p>
          <p>
            If you're using Ubuntu 20.04, here's how to install a
            <a href="https://wiki.ubuntu.com/Kernel/LTSEnablementStack"
              >newer kernel</a
            >:
          </p>
          <pre><code class="hljs language-bash"><span class="hljs-comment"># If this returns a version &gt;= 5.6, you don't need to do anything</span>
  <span class="hljs-built_in">uname</span> -r
  
  <span class="hljs-comment"># Install the official Ubuntu hardware enablement kernel</span>
  sudo apt install --install-recommends linux-generic-hwe-20.04
  </code></pre>

          <h2 id="using-bun-as-a-task-runner">Using bun as a task runner</h2>
          <p>
            Instead of waiting 170ms for your npm client to start for each task,
            you wait 6ms for bun.
          </p>
          <p>
            To use bun as a task runner, run <code>bun run</code> instead of
            <code>npm run</code>.
          </p>
          <pre><code class="hljs language-bash"><span class="hljs-comment"># Instead of "npm run clean"</span>
  bun run clean
  
  <span class="hljs-comment"># This also works</span>
  bun clean
  </code></pre>
          <p>
            Assuming a package.json with a <code>"clean"</code> command in
            <code>"scripts"</code>:
          </p>
          <pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"myapp"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"clean"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"rm -rf dist out node_modules"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
  </code></pre>
          <h2 id="creating-a-discord-bot-with-bun">
            Creating a Discord bot with Bun
          </h2>
          <h3 id="application-commands">Application Commands</h3>
          <blockquote>
            <p>
              Application commands are native ways to interact with apps in the
              Discord client. There are 3 types of commands accessible in
              different interfaces: the chat input, a message's context menu
              (top-right menu or right-clicking in a message), and a user's
              context menu (right-clicking on a user).
            </p>
          </blockquote>
          <p>To get started you can use the interactions template:</p>
          <pre><code class="hljs language-bash">bun create discord-interactions my-interactions-bot
  <span class="hljs-built_in">cd</span> my-interactions-bot
  </code></pre>
          <p>
            If you don't have a Discord bot/application yet, you can create one
            <a href="https://discord.com/developers/applications/me"
              >here (https://discord.com/developers/applications/me)</a
            >.
          </p>
          <p>
            Invite bot to your server by visiting
            <code
              >https://discord.com/api/oauth2/authorize?client_id=&lt;your_application_id&gt;&amp;scope=bot%20applications.commands</code
            >
          </p>
          <p>
            Afterwards you will need to get your bot's token, public key, and
            application id from the application page and put them into
            <code>.env.example</code> file
          </p>
          <p>
            Then you can run the http server that will handle your interactions:
          </p>
          <pre><code class="hljs language-bash">bun install
  <span class="hljs-built_in">mv</span> .env.example .<span class="hljs-built_in">env</span>
  
  bun run.js <span class="hljs-comment"># listening on port 1337</span>
  </code></pre>
          <p>
            Discord does not accept an insecure HTTP server, so you will need to
            provide an SSL certificate or put the interactions server behind a
            secure reverse proxy. For development, you can use ngrok/cloudflare
            tunnel to expose local ports as secure URL.
          </p>
          <h2 id="using-bun-with-nextjs">Using bun with Next.js</h2>
          <p>To create a new Next.js app with bun:</p>
          <pre><code class="hljs language-bash">bun create next ./app
  <span class="hljs-built_in">cd</span> app
  bun dev <span class="hljs-comment"># start dev server</span>
  </code></pre>
          <p>To use an existing Next.js app with bun:</p>
          <pre><code class="hljs language-bash">bun add bun-framework-next
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"framework = 'next'"</span> &gt; bunfig.toml
  bun bun <span class="hljs-comment"># bundle dependencies</span>
  bun dev <span class="hljs-comment"># start dev server</span>
  </code></pre>
          <p>Many of Next.js’ features are supported, but not all.</p>
          <p>Here’s what doesn’t work yet:</p>
          <ul>
            <li><code>getStaticPaths</code></li>
            <li>
              same-origin <code>fetch</code> inside of
              <code>getStaticProps</code> or <code>getServerSideProps</code>
            </li>
            <li>
              locales, zones, <code>assetPrefix</code> (workaround: change
              <code>--origin \"http://localhost:3000/assetPrefixInhere\"</code>)
            </li>
            <li>
              <code>next/image</code> is polyfilled to a regular
              <code>&lt;img src&gt;</code> tag.
            </li>
            <li>
              <code>proxy</code> and anything else in
              <code>next.config.js</code>
            </li>
            <li>
              API routes, middleware (middleware is easier to support, though!
              Similar SSR API)
            </li>
            <li>
              styled-jsx (technically not Next.js, but often used with it)
            </li>
            <li>React Server Components</li>
          </ul>
          <p>
            When using Next.js, bun automatically reads configuration from
            <code>.env.local</code>, <code>.env.development</code> and
            <code>.env</code> (in that order).
            <code>process.env.NEXT_PUBLIC_</code> and
            <code>process.env.NEXT_</code> automatically are replaced via
            <code>--define</code>.
          </p>
          <p>
            Currently, any time you import new dependencies from
            <code>node_modules</code>, you will need to re-run
            <code>bun bun --use next</code>. This will eventually be automatic.
          </p>
          <h2 id="using-bun-with-single-page-apps">
            Using bun with single-page apps
          </h2>
          <p>
            In your project folder root (where <code>package.json</code> is):
          </p>
          <pre><code class="hljs language-bash">bun bun ./entry-point-1.js ./entry-point-2.jsx
  bun
  </code></pre>
          <p>
            By default, <code>bun</code> will look for any HTML files in the
            <code>public</code> directory and serve that. For browsers
            navigating to the page, the <code>.html</code> file extension is
            optional in the URL, and <code>index.html</code> will automatically
            rewrite for the directory.
          </p>
          <p>
            Here are examples of routing from <code>public/</code> and how
            they’re matched:
          </p>
          <table>
            <thead>
              <tr>
                <th>Dev Server URL</th>
                <th>File Path</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>/dir</td>
                <td>public/dir/index.html</td>
              </tr>
              <tr>
                <td>/</td>
                <td>public/index.html</td>
              </tr>
              <tr>
                <td>/index</td>
                <td>public/index.html</td>
              </tr>
              <tr>
                <td>/hi</td>
                <td>public/hi.html</td>
              </tr>
              <tr>
                <td>/file</td>
                <td>public/file.html</td>
              </tr>
              <tr>
                <td>/font/Inter.woff2</td>
                <td>public/font/Inter.woff2</td>
              </tr>
              <tr>
                <td>/hello</td>
                <td>public/index.html</td>
              </tr>
            </tbody>
          </table>
          <p>
            If <code>public/index.html</code> exists, it becomes the default
            page instead of a 404 page, unless that pathname has a file
            extension.
          </p>
          <h3 id="using-bun-with-create-react-app">
            Using bun with Create React App
          </h3>
          <p>To create a new React app:</p>
          <pre><code class="hljs language-bash">bun create react ./app
  <span class="hljs-built_in">cd</span> app
  bun dev <span class="hljs-comment"># start dev server</span>
  </code></pre>
          <p>To use an existing React app:</p>
          <pre><code class="hljs language-bash"><span class="hljs-comment"># To enable React Fast Refresh, ensure it is installed</span>
  bun add -d react-refresh
  
  <span class="hljs-comment"># Generate a bundle for your entry point(s)</span>
  bun bun ./src/index.js <span class="hljs-comment"># jsx, tsx, ts also work. can be multiple files</span>
  
  <span class="hljs-comment"># Start the dev server</span>
  bun dev
  </code></pre>
          <p>
            From there, bun relies on the filesystem for mapping dev server
            paths to source files. All URL paths are relative to the project
            root (where
            <code>package.json</code> is located).
          </p>
          <p>Here are examples of routing source code file paths:</p>
          <table>
            <thead>
              <tr>
                <th>Dev Server URL</th>
                <th>File Path (relative to cwd)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>/src/components/Button.tsx</td>
                <td>src/components/Button.tsx</td>
              </tr>
              <tr>
                <td>/src/index.tsx</td>
                <td>src/index.tsx</td>
              </tr>
              <tr>
                <td>/pages/index.js</td>
                <td>pages/index.js</td>
              </tr>
            </tbody>
          </table>
          <p>
            You do not need to include file extensions in
            <code>import</code> paths. CommonJS-style import paths without the
            file extension work.
          </p>
          <p>
            You can override the public directory by passing
            <code>--public-dir="path-to-folder"</code>.
          </p>
          <p>
            If no directory is specified and <code>./public/</code> doesn’t
            exist, bun will try <code>./static/</code>. If
            <code>./static/</code> does not exist, but won’t serve from a public
            directory. If you pass <code>--public-dir=./</code> bun will serve
            from the current directory, but it will check the current directory
            last instead of first.
          </p>
          <h2 id="using-bun-with-typescript">Using bun with TypeScript</h2>
          <h3 id="transpiling-typescript-with-bun">
            Transpiling TypeScript with Bun
          </h3>
          <p>
            TypeScript just works. There’s nothing to configure and nothing
            extra to install. If you import a <code>.ts</code> or
            <code>.tsx</code> file, bun will transpile it into JavaScript. bun
            also transpiles <code>node_modules</code> containing
            <code>.ts</code> or <code>.tsx</code> files. This is powered by
            bun’s TypeScript transpiler, so it’s fast.
          </p>
          <p>
            bun also reads <code>tsconfig.json</code>, including
            <code>baseUrl</code> and <code>paths</code>.
          </p>
          <h3 id="adding-type-definitions">Adding Type Definitions</h3>
          <p>
            To get TypeScript working with the global API, add
            <code>bun-types</code> to your project:
          </p>
          <pre><code class="hljs language-sh">bun add -d bun-types
  </code></pre>
          <p>
            And to the <code>types</code> field in your
            <code>tsconfig.json</code>:
          </p>
          <pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"bun-types"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
  </code></pre>
          <h2 id="not-implemented-yet">Not implemented yet</h2>
          <p>
            bun is a project with an incredibly large scope and is still in its
            early days.
          </p>
          <p>
            You can see
            <a href="https://github.com/oven-sh/bun/issues/159">Bun's Roadmap</a
            >, but here are some additional things that are planned:
          </p>
          <table>
            <thead>
              <tr>
                <th>Feature</th>
                <th>In</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Web Streams with Fetch API</td>
                <td>bun.js</td>
              </tr>
              <tr>
                <td>Web Streams with HTMLRewriter</td>
                <td>bun.js</td>
              </tr>
              <tr>
                <td>Package hoisting that matches npm behavior</td>
                <td>bun install</td>
              </tr>
              <tr>
                <td>Source Maps (unbundled is supported)</td>
                <td>JS Bundler</td>
              </tr>
              <tr>
                <td>Source Maps</td>
                <td>CSS</td>
              </tr>
              <tr>
                <td>JavaScript Minifier</td>
                <td>JS Transpiler</td>
              </tr>
              <tr>
                <td>CSS Minifier</td>
                <td>CSS</td>
              </tr>
              <tr>
                <td>CSS Parser (it only bundles)</td>
                <td>CSS</td>
              </tr>
              <tr>
                <td>Tree-shaking</td>
                <td>JavaScript</td>
              </tr>
              <tr>
                <td>Tree-shaking</td>
                <td>CSS</td>
              </tr>
              <tr>
                <td>
                  <a
                    href="https://www.typescriptlang.org/docs/handbook/decorators.html"
                    >TypeScript Decorators</a
                  >
                </td>
                <td>TS Transpiler</td>
              </tr>
              <tr>
                <td><code>@jsxPragma</code> comments</td>
                <td>JS Transpiler</td>
              </tr>
              <tr>
                <td>Sharing <code>.bun</code> files</td>
                <td>bun</td>
              </tr>
              <tr>
                <td>Dates &amp; timestamps</td>
                <td>TOML parser</td>
              </tr>
              <tr>
                <td>
                  <a href="https://github.com/oven-sh/bun/issues/18"
                    >Hash components for Fast Refresh</a
                  >
                </td>
                <td>JSX Transpiler</td>
              </tr>
            </tbody>
          </table>
          <small>
            JS Transpiler == JavaScript Transpiler
            <br />
            TS Transpiler == TypeScript Transpiler
            <br />
            Package manager == <code>bun install</code>
            <br />
            bun.js == bun’s JavaScriptCore integration that executes JavaScript.
            Similar to how Node.js &amp; Deno embed V8.
          </small>

          <h3 id="limitations--intended-usage">
            Limitations &amp; intended usage
          </h3>
          <p>Today, bun is mostly focused on bun.js: the JavaScript runtime.</p>
          <p>
            While you could use bun's bundler &amp; transpiler separately to
            build for browsers or node, bun doesn't have a minifier or support
            tree-shaking yet. For production browser builds, you probably should
            use a tool like esbuild or swc.
          </p>
          <p>
            Longer-term, bun intends to replace Node.js, Webpack, Babel, yarn,
            and PostCSS (in production).
          </p>
          <h3 id="upcoming-breaking-changes">Upcoming breaking changes</h3>
          <ul>
            <li>
              Bun's CLI flags will change to better support bun as a JavaScript
              runtime. They were chosen when bun was just a frontend development
              tool.
            </li>
            <li>
              Bun's bundling format will change to accommodate production
              browser bundles and on-demand production bundling
            </li>
          </ul>
          <h2 id="configuration">Configuration</h2>
          <h3 id="bunfigtoml">bunfig.toml</h3>
          <p>bunfig.toml is bun's configuration file.</p>
          <p>
            It lets you load configuration from a file instead of passing flags
            to the CLI each time. The config file is loaded before CLI arguments
            are parsed, which means CLI arguments can override them.
          </p>
          <p>Here is an example:</p>
          <pre><code class="hljs language-toml"><span class="hljs-comment"># Set a default framework to use</span>
  <span class="hljs-comment"># By default, bun will look for an npm package like `bun-framework-${framework}`, followed by `${framework}`</span>
  <span class="hljs-attr">framework</span> = <span class="hljs-string">"next"</span>
  <span class="hljs-attr">logLevel</span> = <span class="hljs-string">"debug"</span>
  
  <span class="hljs-comment"># publicDir = "public"</span>
  <span class="hljs-comment"># external = ["jquery"]</span>
  
  <span class="hljs-section">[macros]</span>
  <span class="hljs-comment"># Remap any import like this:</span>
  <span class="hljs-comment">#     import {graphql} from 'react-relay';</span>
  <span class="hljs-comment"># To:</span>
  <span class="hljs-comment">#     import {graphql} from 'macro:bun-macro-relay';</span>
  <span class="hljs-attr">react-relay</span> = { <span class="hljs-string">"graphql"</span> = <span class="hljs-string">"bun-macro-relay"</span> }
  
  <span class="hljs-section">[bundle]</span>
  <span class="hljs-attr">saveTo</span> = <span class="hljs-string">"node_modules.bun"</span>
  <span class="hljs-comment"># Don't need this if `framework` is set, but showing it here as an example anyway</span>
  <span class="hljs-attr">entryPoints</span> = [<span class="hljs-string">"./app/index.ts"</span>]
  
  <span class="hljs-section">[bundle.packages]</span>
  <span class="hljs-comment"># If you're bundling packages that do not actually live in a `node_modules` folder or do not have the full package name in the file path, you can pass this to bundle them anyway</span>
  <span class="hljs-attr">"@bigapp/design-system"</span> = <span class="hljs-literal">true</span>
  
  <span class="hljs-section">[dev]</span>
  <span class="hljs-comment"># Change the default port from 3000 to 5000</span>
  <span class="hljs-comment"># Also inherited by Bun.serve</span>
  <span class="hljs-attr">port</span> = <span class="hljs-number">5000</span>
  
  <span class="hljs-section">[define]</span>
  <span class="hljs-comment"># Replace any usage of "process.env.bagel" with the string `lox`.</span>
  <span class="hljs-comment"># The values are parsed as JSON, except single-quoted strings are supported and `'undefined'` becomes `undefined` in JS.</span>
  <span class="hljs-comment"># This will probably change in a future release to be just regular TOML instead. It is a holdover from the CLI argument parsing.</span>
  <span class="hljs-attr">"process.env.bagel"</span> = <span class="hljs-string">"'lox'"</span>
  
  <span class="hljs-section">[loaders]</span>
  <span class="hljs-comment"># When loading a .bagel file, run the JS parser</span>
  <span class="hljs-attr">".bagel"</span> = <span class="hljs-string">"js"</span>
  
  <span class="hljs-section">[debug]</span>
  <span class="hljs-comment"># When navigating to a blob: or src: link, open the file in your editor</span>
  <span class="hljs-comment"># If not, it tries $EDITOR or $VISUAL</span>
  <span class="hljs-comment"># If that still fails, it will try Visual Studio Code, then Sublime Text, then a few others</span>
  <span class="hljs-comment"># This is used by Bun.openInEditor()</span>
  <span class="hljs-attr">editor</span> = <span class="hljs-string">"code"</span>
  
  <span class="hljs-comment"># List of editors:</span>
  <span class="hljs-comment"># - "subl", "sublime"</span>
  <span class="hljs-comment"># - "vscode", "code"</span>
  <span class="hljs-comment"># - "textmate", "mate"</span>
  <span class="hljs-comment"># - "idea"</span>
  <span class="hljs-comment"># - "webstorm"</span>
  <span class="hljs-comment"># - "nvim", "neovim"</span>
  <span class="hljs-comment"># - "vim","vi"</span>
  <span class="hljs-comment"># - "emacs"</span>
  <span class="hljs-comment"># - "atom"</span>
  <span class="hljs-comment"># If you pass it a file path, it will open with the file path instead</span>
  <span class="hljs-comment"># It will recognize non-GUI editors, but I don't think it will work yet</span>
  </code></pre>
          <p>TODO: list each property name</p>
          <h2 id="loaders">Loaders</h2>
          <p>
            A loader determines how to map imports &amp; file extensions to
            transforms and output.
          </p>
          <p>Currently, bun implements the following loaders:</p>
          <table>
            <thead>
              <tr>
                <th>Input</th>
                <th>Loader</th>
                <th>Output</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>.js</td>
                <td>JSX + JavaScript</td>
                <td>.js</td>
              </tr>
              <tr>
                <td>.jsx</td>
                <td>JSX + JavaScript</td>
                <td>.js</td>
              </tr>
              <tr>
                <td>.ts</td>
                <td>TypeScript + JavaScript</td>
                <td>.js</td>
              </tr>
              <tr>
                <td>.tsx</td>
                <td>TypeScript + JSX + JavaScript</td>
                <td>.js</td>
              </tr>
              <tr>
                <td>.mjs</td>
                <td>JavaScript</td>
                <td>.js</td>
              </tr>
              <tr>
                <td>.cjs</td>
                <td>JavaScript</td>
                <td>.js</td>
              </tr>
              <tr>
                <td>.mts</td>
                <td>TypeScript</td>
                <td>.js</td>
              </tr>
              <tr>
                <td>.cts</td>
                <td>TypeScript</td>
                <td>.js</td>
              </tr>
              <tr>
                <td>.toml</td>
                <td>TOML</td>
                <td>.js</td>
              </tr>
              <tr>
                <td>.css</td>
                <td>CSS</td>
                <td>.css</td>
              </tr>
              <tr>
                <td>.env</td>
                <td>Env</td>
                <td>N/A</td>
              </tr>
              <tr>
                <td>.*</td>
                <td>file</td>
                <td>string</td>
              </tr>
            </tbody>
          </table>
          <p>
            Everything else is treated as <code>file</code>.
            <code>file</code> replaces the import with a URL (or a path).
          </p>
          <p>
            You can configure which loaders map to which extensions by passing
            <code>--loaders</code> to <code>bun</code>. For example:
          </p>
          <pre><code class="hljs language-sh">bun --loader=.js:js
  </code></pre>
          <p>This will disable JSX transforms for <code>.js</code> files.</p>
          <h4 id="css-in-js-bun-dev-only">CSS in JS (bun dev only)</h4>
          <p>
            When importing CSS in JavaScript-like loaders, CSS is treated
            special.
          </p>
          <p>By default, bun will transform a statement like this:</p>
          <pre><code class="hljs language-js"><span class="hljs-keyword">import</span> <span class="hljs-string">"../styles/global.css"</span>;
  </code></pre>
          <h5 id="when-platform-is-browser">
            When <code>platform</code> is <code>browser</code>
          </h5>
          <pre><code class="hljs language-js">globalThis.<span class="hljs-property">document</span>?.<span class="hljs-title function_">dispatchEvent</span>(
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">"onimportcss"</span>, {
      <span class="hljs-attr">detail</span>: <span class="hljs-string">"http://localhost:3000/styles/globals.css"</span>,
    }),
  );
  </code></pre>
          <p>
            An event handler for turning that into a
            <code>&lt;link&gt;</code> is automatically registered when HMR is
            enabled. That event handler can be turned off either in a
            framework’s <code>package.json</code> or by setting
            <code>globalThis["Bun_disableCSSImports"] = true;</code> in
            client-side code. Additionally, you can get a list of every .css
            file imported this way via
            <code>globalThis["__BUN"].allImportedStyles</code>.
          </p>
          <h5 id="when-platform-is-bun">
            When <code>platform</code> is <code>bun</code>
          </h5>
          <pre><code class="hljs language-js"><span class="hljs-comment">//@import url("http://localhost:3000/styles/globals.css");</span>
  </code></pre>
          <p>
            Additionally, bun exposes an API for SSR/SSG that returns a flat
            list of URLs to css files imported. That function is
            <code>Bun.getImportedStyles()</code>.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-comment">// This specifically is for "framework" in package.json when loaded via `bun dev`</span>
  <span class="hljs-comment">// This API needs to be changed somewhat to work more generally with Bun.js</span>
  <span class="hljs-comment">// Initially, you could only use bun.js through `bun dev`</span>
  <span class="hljs-comment">// and this API was created at that time</span>
  <span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"fetch"</span>, <span class="hljs-keyword">async</span> (<span class="hljs-attr">event</span>: <span class="hljs-title class_">FetchEvent</span>) =&gt; {
    <span class="hljs-keyword">let</span> route = <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">match</span>(event);
    <span class="hljs-keyword">const</span> <span class="hljs-title class_">App</span> = <span class="hljs-keyword">await</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">"pages/_app"</span>);
  
    <span class="hljs-comment">// This returns all .css files that were imported in the line above.</span>
    <span class="hljs-comment">// It’s recursive, so any file that imports a CSS file will be included.</span>
    <span class="hljs-keyword">const</span> appStylesheets = bun.<span class="hljs-title function_">getImportedStyles</span>();
  
    <span class="hljs-comment">// ...rest of code</span>
  });
  </code></pre>
          <p>This is useful for preventing flash of unstyled content.</p>
          <h3 id="css-loader">CSS Loader</h3>
          <p>
            bun bundles <code>.css</code> files imported via
            <code>@import</code> into a single file. It doesn’t autoprefix or
            minify CSS today. Multiple <code>.css</code> files imported in one
            JavaScript file will <em>not</em> be bundled into one file. You’ll
            have to import those from a <code>.css</code> file.
          </p>
          <p>This input:</p>
          <pre><code class="hljs language-css"><span class="hljs-keyword">@import</span> url(<span class="hljs-string">"./hi.css"</span>);
  <span class="hljs-keyword">@import</span> url(<span class="hljs-string">"./hello.css"</span>);
  <span class="hljs-keyword">@import</span> url(<span class="hljs-string">"./yo.css"</span>);
  </code></pre>
          <p>Becomes:</p>
          <pre><code class="hljs language-css"><span class="hljs-comment">/* hi.css */</span>
  <span class="hljs-comment">/* ...contents of hi.css */</span>
  <span class="hljs-comment">/* hello.css */</span>
  <span class="hljs-comment">/* ...contents of hello.css */</span>
  <span class="hljs-comment">/* yo.css */</span>
  <span class="hljs-comment">/* ...contents of yo.css */</span>
  </code></pre>
          <h3 id="css-runtime">CSS runtime</h3>
          <p>
            To support hot CSS reloading, bun inserts
            <code>@supports</code> annotations into CSS that tag which files a
            stylesheet is composed of. Browsers ignore this, so it doesn’t
            impact styles.
          </p>
          <p>
            By default, bun’s runtime code automatically listens to
            <code>onimportcss</code> and will insert the
            <code>event.detail</code> into a
            <code>&lt;link rel="stylesheet" href={${event.detail}}&gt;</code> if
            there is no existing <code>link</code> tag with that stylesheet.
            That’s how bun’s equivalent of <code>style-loader</code> works.
          </p>
          <h3 id="frameworks">Frameworks</h3>
          <blockquote>
            <p>
              <strong>Warning</strong> This will soon have breaking changes. It
              was designed when Bun was mostly a dev server and not a JavaScript
              runtime.
            </p>
          </blockquote>
          <p>
            Frameworks preconfigure bun to enable developers to use bun with
            their existing tooling.
          </p>
          <p>
            Frameworks are configured via the <code>framework</code> object in
            the <code>package.json</code> of the framework (not in the
            application’s <code>package.json</code>):
          </p>
          <p>Here is an example:</p>
          <pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bun-framework-next"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.0-18"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"framework"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"displayName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Next.js"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"static"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"public"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"assetPrefix"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"_next/"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"router"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"dir"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"pages"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"src/pages"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"extensions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">".js"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">".ts"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">".tsx"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">".jsx"</span><span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"css"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"onimportcss"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"development"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"client"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"client.development.tsx"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"fallback"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fallback.development.tsx"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"server"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"server.development.tsx"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"css"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"onimportcss"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"define"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"client"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">".env"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"NEXT_PUBLIC_"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"defaults"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"process.env.__NEXT_TRAILING_SLASH"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"false"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"process.env.NODE_ENV"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"\"development\""</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"process.env.__NEXT_ROUTER_BASEPATH"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"''"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"process.env.__NEXT_SCROLL_RESTORATION"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"false"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"process.env.__NEXT_I18N_SUPPORT"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"false"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"process.env.__NEXT_HAS_REWRITES"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"false"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"process.env.__NEXT_ANALYTICS_ID"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"null"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"process.env.__NEXT_OPTIMIZE_CSS"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"false"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"process.env.__NEXT_CROSS_ORIGIN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"''"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"process.env.__NEXT_STRICT_MODE"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"false"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"process.env.__NEXT_IMAGE_OPTS"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"null"</span>
            <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"server"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">".env"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"NEXT_"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"defaults"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"process.env.__NEXT_TRAILING_SLASH"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"false"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"process.env.__NEXT_OPTIMIZE_FONTS"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"false"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"process.env.NODE_ENV"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"\"development\""</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"process.env.__NEXT_OPTIMIZE_IMAGES"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"false"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"process.env.__NEXT_OPTIMIZE_CSS"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"false"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"process.env.__NEXT_ROUTER_BASEPATH"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"''"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"process.env.__NEXT_SCROLL_RESTORATION"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"false"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"process.env.__NEXT_I18N_SUPPORT"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"false"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"process.env.__NEXT_HAS_REWRITES"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"false"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"process.env.__NEXT_ANALYTICS_ID"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"null"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"process.env.__NEXT_CROSS_ORIGIN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"''"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"process.env.__NEXT_STRICT_MODE"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"false"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"process.env.__NEXT_IMAGE_OPTS"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"null"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"global"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"globalThis"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"window"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"undefined"</span>
            <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
  </code></pre>
          <p>Here are type definitions:</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Framework</span> = <span class="hljs-title class_">Environment</span> &amp; {
    <span class="hljs-comment">// This changes what’s printed in the console on load</span>
    displayName?: <span class="hljs-built_in">string</span>;
  
    <span class="hljs-comment">// This allows a prefix to be added (and ignored) to requests.</span>
    <span class="hljs-comment">// Useful for integrating an existing framework that expects internal routes to have a prefix</span>
    <span class="hljs-comment">// e.g. "_next"</span>
    assetPrefix?: <span class="hljs-built_in">string</span>;
  
    development?: <span class="hljs-title class_">Environment</span>;
    production?: <span class="hljs-title class_">Environment</span>;
  
    <span class="hljs-comment">// The directory used for serving unmodified assets like fonts and images</span>
    <span class="hljs-comment">// Defaults to "public" if exists, else "static", else disabled.</span>
    <span class="hljs-keyword">static</span>?: <span class="hljs-built_in">string</span>;
  
    <span class="hljs-comment">// "onimportcss" disables the automatic "onimportcss" feature</span>
    <span class="hljs-comment">// If the framework does routing, you may want to handle CSS manually</span>
    <span class="hljs-comment">// "facade" removes CSS imports from JavaScript files,</span>
    <span class="hljs-comment">//    and replaces an imported object with a proxy that mimics CSS module support without doing any class renaming.</span>
    css?: <span class="hljs-string">"onimportcss"</span> | <span class="hljs-string">"facade"</span>;
  
    <span class="hljs-comment">// bun’s filesystem router</span>
    router?: <span class="hljs-title class_">Router</span>;
  };
  
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">Define</span> = {
    <span class="hljs-comment">// By passing ".env", bun will automatically load .env.local, .env.development, and .env if exists in the project root</span>
    <span class="hljs-comment">//    (in addition to the processes’ environment variables)</span>
    <span class="hljs-comment">// When "*", all environment variables will be automatically injected into the JavaScript loader</span>
    <span class="hljs-comment">// When a string like "NEXT_PUBLIC_", only environment variables starting with that prefix will be injected</span>
  
    <span class="hljs-string">".env"</span>: <span class="hljs-built_in">string</span> | <span class="hljs-string">"*"</span>;
  
    <span class="hljs-comment">// These environment variables will be injected into the JavaScript loader</span>
    <span class="hljs-comment">// These are the equivalent of Webpack’s resolve.alias and esbuild’s --define.</span>
    <span class="hljs-comment">// Values are parsed as JSON, so they must be valid JSON. The only exception is '' is a valid string, to simplify writing stringified JSON in JSON.</span>
    <span class="hljs-comment">// If not set, `process.env.NODE_ENV` will be transformed into "development".</span>
    <span class="hljs-attr">defaults</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;;
  };
  
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">Environment</span> = {
    <span class="hljs-comment">// This is a wrapper for the client-side entry point for a route.</span>
    <span class="hljs-comment">// This allows frameworks to run initialization code on pages.</span>
    <span class="hljs-attr">client</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-comment">// This is a wrapper for the server-side entry point for a route.</span>
    <span class="hljs-comment">// This allows frameworks to run initialization code on pages.</span>
    <span class="hljs-attr">server</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-comment">// This runs when "server" code fails to load due to an exception.</span>
    <span class="hljs-attr">fallback</span>: <span class="hljs-built_in">string</span>;
  
    <span class="hljs-comment">// This is how environment variables and .env is configured.</span>
    define?: <span class="hljs-title class_">Define</span>;
  };
  
  <span class="hljs-comment">// bun’s filesystem router</span>
  <span class="hljs-comment">// Currently, bun supports pages by either an absolute match or a parameter match.</span>
  <span class="hljs-comment">// pages/index.tsx will be executed on navigation to "/" and "/index"</span>
  <span class="hljs-comment">// pages/posts/[id].tsx will be executed on navigation to "/posts/123"</span>
  <span class="hljs-comment">// Routes &amp; parameters are automatically passed to `fallback` and `server`.</span>
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">Router</span> = {
    <span class="hljs-comment">// This determines the folder to look for pages</span>
    <span class="hljs-attr">dir</span>: <span class="hljs-built_in">string</span>[];
  
    <span class="hljs-comment">// These are the allowed file extensions for pages.</span>
    extensions?: <span class="hljs-built_in">string</span>[];
  };
  </code></pre>
          <p>
            To use a framework, you pass
            <code>bun bun --use package-name</code>.
          </p>
          <p>
            Your framework’s <code>package.json</code> <code>name</code> should
            start with <code>bun-framework-</code>. This is so that people can
            type something like <code>bun bun --use next</code> and it will
            check <code>bun-framework-next</code> first. This is similar to how
            Babel plugins tend to start with <code>babel-plugin-</code>.
          </p>
          <p>
            For developing frameworks, you can also do
            <code>bun bun --use ./relative-path-to-framework</code>.
          </p>
          <p>
            If you’re interested in adding a framework integration, please reach
            out. There’s a lot here, and it’s not entirely documented yet.
          </p>
          <h2 id="troubleshooting">Troubleshooting</h2>
          <h3 id="bun-not-running-on-an-m1-or-apple-silicon">
            bun not running on an M1 (or Apple Silicon)
          </h3>
          <p>If you see a message like this</p>
          <blockquote>
            <p>[1] 28447 killed bun create next ./test</p>
          </blockquote>
          <p>
            It most likely means you’re running bun’s x64 version on Apple
            Silicon. This happens if bun is running via Rosetta. Rosetta is
            unable to emulate AVX2 instructions, which bun indirectly uses.
          </p>
          <p>
            The fix is to ensure you installed a version of bun built for Apple
            Silicon.
          </p>
          <h3 id="error-unexpected">error: Unexpected</h3>
          <p>If you see an error like this:</p>
          <p>
            <img
              src="https://user-images.githubusercontent.com/709451/141210854-89434678-d21b-42f4-b65a-7df3b785f7b9.png"
              alt="image"
            />
          </p>
          <p>
            It usually means the max number of open file descriptors is being
            explicitly set to a low number. By default, bun requests the max
            number of file descriptors available (which on macOS, is something
            like 32,000). But, if you previously ran into ulimit issues with,
            e.g., Chokidar, someone on The Internet may have advised you to run
            <code>ulimit -n 8096</code>.
          </p>
          <p>
            That advice unfortunately <strong>lowers</strong> the hard limit to
            <code>8096</code>. This can be a problem in large repositories or
            projects with lots of dependencies. Chokidar (and other watchers)
            don’t seem to call <code>setrlimit</code>, which means they’re
            reliant on the (much lower) soft limit.
          </p>
          <p>To fix this issue:</p>
          <ol>
            <li>
              Remove any scripts that call <code>ulimit -n</code> and restart
              your shell.
            </li>
            <li>
              Try again, and if the error still occurs, try setting
              <code>ulimit -n</code> to an absurdly high number, such as
              <code>ulimit -n 2147483646</code>
            </li>
            <li>Try again, and if that still doesn’t fix it, open an issue</li>
          </ol>
          <h3 id="unzip-is-required">Unzip is required</h3>
          <p>
            Unzip is required to install bun on Linux. You can use one of the
            following commands to install <code>unzip</code>:
          </p>
          <h4 id="debian--ubuntu--mint">Debian / Ubuntu / Mint</h4>
          <pre><code class="hljs language-sh">sudo apt install unzip
  </code></pre>
          <h4 id="redhat--centos--fedora">RedHat / CentOS / Fedora</h4>
          <pre><code class="hljs language-sh">sudo dnf install unzip
  </code></pre>
          <h4 id="arch--manjaro">Arch / Manjaro</h4>
          <pre><code class="hljs language-sh">sudo pacman -S unzip
  </code></pre>
          <h4 id="opensuse">OpenSUSE</h4>
          <pre><code class="hljs language-sh">sudo zypper install unzip
  </code></pre>
          <h3 id="bun-install-is-stuck">bun install is stuck</h3>
          <p>
            Please run <code>bun install --verbose 2&gt; logs.txt</code> and
            send them to me in bun's discord. If you're on Linux, it would also
            be helpful if you run
            <code>sudo perf trace bun install --silent</code> and attach the
            logs.
          </p>
          <h2 id="reference">Reference</h2>
          <h3 id="bun-install"><code>bun install</code></h3>
          <p>bun install is a fast package manager &amp; npm client.</p>
          <p>
            bun install can be configured via <code>bunfig.toml</code>,
            environment variables, and CLI flags.
          </p>
          <h4 id="configuring-bun-install-with-bunfigtoml">
            Configuring bun install with <code>bunfig.toml</code>
          </h4>
          <p>
            <code>bunfig.toml</code> is searched for in the following paths on
            <code>bun install</code>, <code>bun remove</code>, and
            <code>bun add</code>:
          </p>
          <ol>
            <li>
              <code>$XDG_CONFIG_HOME/.bunfig.toml</code> or
              <code>$HOME/.bunfig.toml</code>
            </li>
            <li><code>./bunfig.toml</code></li>
          </ol>
          <p><sup>If both are found, the results are merged together.</sup></p>
          <p>
            Configuring with <code>bunfig.toml</code> is optional. bun tries to
            be zero configuration in general, but that's not always possible.
          </p>
          <pre><code class="hljs language-toml"><span class="hljs-comment"># Using scoped packages with bun install</span>
  <span class="hljs-section">[install.scopes]</span>
  
  <span class="hljs-comment"># Scope name      The value can be a URL string or an object</span>
  <span class="hljs-attr">"@mybigcompany"</span> = { token = <span class="hljs-string">"123456"</span>, url = <span class="hljs-string">"https://registry.mybigcompany.com"</span> }
  <span class="hljs-comment"># URL is optional and fallsback to the default registry</span>
  
  <span class="hljs-comment"># The "@" in the scope is optional</span>
  <span class="hljs-attr">mybigcompany2</span> = { token = <span class="hljs-string">"123456"</span> }
  
  <span class="hljs-comment"># Environment variables can be referenced as a string that starts with $ and it will be replaced</span>
  <span class="hljs-attr">mybigcompany3</span> = { token = <span class="hljs-string">"$npm_config_token"</span> }
  
  <span class="hljs-comment"># Setting username and password turns it into a Basic Auth header by taking base64("username:password")</span>
  <span class="hljs-attr">mybigcompany4</span> = { username = <span class="hljs-string">"myusername"</span>, password = <span class="hljs-string">"$npm_config_password"</span>, url = <span class="hljs-string">"https://registry.yarnpkg.com/"</span> }
  <span class="hljs-comment"># You can set username and password in the registry URL. This is the same as above.</span>
  <span class="hljs-attr">mybigcompany5</span> = <span class="hljs-string">"https://username:password@registry.yarnpkg.com/"</span>
  
  <span class="hljs-comment"># You can set a token for a registry URL:</span>
  <span class="hljs-attr">mybigcompany6</span> = <span class="hljs-string">"https://:$NPM_CONFIG_TOKEN@registry.yarnpkg.com/"</span>
  
  <span class="hljs-section">[install]</span>
  <span class="hljs-comment"># Default registry</span>
  <span class="hljs-comment"># can be a URL string or an object</span>
  <span class="hljs-attr">registry</span> = <span class="hljs-string">"https://registry.yarnpkg.com/"</span>
  <span class="hljs-comment"># as an object</span>
  <span class="hljs-comment">#registry = { url = "https://registry.yarnpkg.com/", token = "123456" }</span>
  
  <span class="hljs-comment"># Install for production? This is the equivalent to the "--production" CLI argument</span>
  <span class="hljs-attr">production</span> = <span class="hljs-literal">false</span>
  
  <span class="hljs-comment"># Don't actually install</span>
  <span class="hljs-attr">dryRun</span> = <span class="hljs-literal">true</span>
  
  <span class="hljs-comment"># Install optionalDependencies (default: true)</span>
  <span class="hljs-attr">optional</span> = <span class="hljs-literal">true</span>
  
  <span class="hljs-comment"># Install local devDependencies (default: true)</span>
  <span class="hljs-attr">dev</span> = <span class="hljs-literal">true</span>
  
  <span class="hljs-comment"># Install peerDependencies (default: false)</span>
  <span class="hljs-attr">peer</span> = <span class="hljs-literal">false</span>
  
  <span class="hljs-comment"># When using `bun install -g`, install packages here</span>
  <span class="hljs-attr">globalDir</span> = <span class="hljs-string">"~/.bun/install/global"</span>
  
  <span class="hljs-comment"># When using `bun install -g`, link package bins here</span>
  <span class="hljs-attr">globalBinDir</span> = <span class="hljs-string">"~/.bun/bin"</span>
  
  <span class="hljs-comment"># cache-related configuration</span>
  <span class="hljs-section">[install.cache]</span>
  <span class="hljs-comment"># The directory to use for the cache</span>
  <span class="hljs-attr">dir</span> = <span class="hljs-string">"~/.bun/install/cache"</span>
  
  <span class="hljs-comment"># Don't load from the global cache.</span>
  <span class="hljs-comment"># <span class="hljs-doctag">Note:</span> bun may still write to node_modules/.cache</span>
  <span class="hljs-attr">disable</span> = <span class="hljs-literal">false</span>
  
  <span class="hljs-comment"># Always resolve the latest versions from the registry</span>
  <span class="hljs-attr">disableManifest</span> = <span class="hljs-literal">false</span>
  
  
  <span class="hljs-comment"># Lockfile-related configuration</span>
  <span class="hljs-section">[install.lockfile]</span>
  
  <span class="hljs-comment"># Print a yarn v1 lockfile</span>
  <span class="hljs-comment"># <span class="hljs-doctag">Note:</span> it does not load the lockfile, it just converts bun.lockb into a yarn.lock</span>
  <span class="hljs-attr">print</span> = <span class="hljs-string">"yarn"</span>
  
  <span class="hljs-comment"># Path to read bun.lockb from</span>
  <span class="hljs-attr">path</span> = <span class="hljs-string">"bun.lockb"</span>
  
  <span class="hljs-comment"># Path to save bun.lockb to</span>
  <span class="hljs-attr">savePath</span> = <span class="hljs-string">"bun.lockb"</span>
  
  <span class="hljs-comment"># Save the lockfile to disk</span>
  <span class="hljs-attr">save</span> = <span class="hljs-literal">true</span>
  </code></pre>
          <p>If it's easier to read as TypeScript types:</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Root</span> {
    <span class="hljs-attr">install</span>: <span class="hljs-title class_">Install</span>;
  }
  
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Install</span> {
    <span class="hljs-attr">scopes</span>: <span class="hljs-title class_">Scopes</span>;
    <span class="hljs-attr">registry</span>: <span class="hljs-title class_">Registry</span>;
    <span class="hljs-attr">production</span>: <span class="hljs-built_in">boolean</span>;
    <span class="hljs-attr">dryRun</span>: <span class="hljs-built_in">boolean</span>;
    <span class="hljs-attr">optional</span>: <span class="hljs-built_in">boolean</span>;
    <span class="hljs-attr">dev</span>: <span class="hljs-built_in">boolean</span>;
    <span class="hljs-attr">peer</span>: <span class="hljs-built_in">boolean</span>;
    <span class="hljs-attr">globalDir</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">globalBinDir</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">cache</span>: <span class="hljs-title class_">Cache</span>;
    <span class="hljs-attr">lockfile</span>: <span class="hljs-title class_">Lockfile</span>;
    <span class="hljs-attr">logLevel</span>: <span class="hljs-string">"debug"</span> | <span class="hljs-string">"error"</span> | <span class="hljs-string">"warn"</span>;
  }
  
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">Registry</span> =
    | <span class="hljs-built_in">string</span>
    | {
        url?: <span class="hljs-built_in">string</span>;
        token?: <span class="hljs-built_in">string</span>;
        username?: <span class="hljs-built_in">string</span>;
        password?: <span class="hljs-built_in">string</span>;
      };
  
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">Scopes</span> = <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Registry</span>&gt;;
  
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Cache</span> {
    <span class="hljs-attr">dir</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">disable</span>: <span class="hljs-built_in">boolean</span>;
    <span class="hljs-attr">disableManifest</span>: <span class="hljs-built_in">boolean</span>;
  }
  
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Lockfile</span> {
    print?: <span class="hljs-string">"yarn"</span>;
    <span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">savePath</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">save</span>: <span class="hljs-built_in">boolean</span>;
  }
  </code></pre>
          <h4 id="configuring-with-environment-variables">
            Configuring with environment variables
          </h4>
          <p>
            Environment variables have a higher priority than
            <code>bunfig.toml</code>.
          </p>
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>BUN_CONFIG_REGISTRY</td>
                <td>
                  Set an npm registry (default:
                  <a href="https://registry.npmjs.org"
                    >https://registry.npmjs.org</a
                  >)
                </td>
              </tr>
              <tr>
                <td>BUN_CONFIG_TOKEN</td>
                <td>Set an auth token (currently does nothing)</td>
              </tr>
              <tr>
                <td>BUN_CONFIG_LOCKFILE_SAVE_PATH</td>
                <td>File path to save the lockfile to (default: bun.lockb)</td>
              </tr>
              <tr>
                <td>BUN_CONFIG_YARN_LOCKFILE</td>
                <td>Save a Yarn v1-style yarn.lock</td>
              </tr>
              <tr>
                <td>BUN_CONFIG_LINK_NATIVE_BINS</td>
                <td>
                  Point <code>bin</code> in package.json to a platform-specific
                  dependency
                </td>
              </tr>
              <tr>
                <td>BUN_CONFIG_SKIP_SAVE_LOCKFILE</td>
                <td>Don’t save a lockfile</td>
              </tr>
              <tr>
                <td>BUN_CONFIG_SKIP_LOAD_LOCKFILE</td>
                <td>Don’t load a lockfile</td>
              </tr>
              <tr>
                <td>BUN_CONFIG_SKIP_INSTALL_PACKAGES</td>
                <td>Don’t install any packages</td>
              </tr>
            </tbody>
          </table>
          <p>
            bun always tries to use the fastest available installation method
            for the target platform. On macOS, that’s <code>clonefile</code> and
            on Linux, that’s <code>hardlink</code>. You can change which
            installation method is used with the <code>--backend</code> flag.
            When unavailable or on error, <code>clonefile</code> and
            <code>hardlink</code> fallsback to a platform-specific
            implementation of copying files.
          </p>
          <p>
            bun stores installed packages from npm in
            <code>~/.bun/install/cache/${name}@${version}</code>. Note that if
            the semver version has a <code>build</code> or a
            <code>pre</code> tag, it is replaced with a hash of that value
            instead. This is to reduce the chances of errors from long file
            paths, but unfortunately complicates figuring out where a package
            was installed on disk.
          </p>
          <p>
            When the <code>node_modules</code> folder exists, before installing,
            bun checks if the <code>"name"</code> and <code>"version"</code> in
            <code>package/package.json</code> in the expected node_modules
            folder matches the expected <code>name</code> and
            <code>version</code>. This is how it determines whether it should
            install. It uses a custom JSON parser which stops parsing as soon as
            it finds <code>"name"</code> and <code>"version"</code>.
          </p>
          <p>
            When a <code>bun.lockb</code> doesn’t exist or
            <code>package.json</code> has changed dependencies, tarballs are
            downloaded &amp; extracted eagerly while resolving.
          </p>
          <p>
            When a <code>bun.lockb</code> exists and
            <code>package.json</code> hasn’t changed, bun downloads missing
            dependencies lazily. If the package with a matching
            <code>name</code> &amp; <code>version</code> already exists in the
            expected location within <code>node_modules</code>, bun won’t
            attempt to download the tarball.
          </p>
          <h4 id="platform-specific-dependencies">
            Platform-specific dependencies?
          </h4>
          <p>
            bun stores normalized <code>cpu</code> and <code>os</code> values
            from npm in the lockfile, along with the resolved packages. It skips
            downloading, extracting, and installing packages disabled for the
            current target at runtime. This means the lockfile won’t change
            between platforms/architectures even if the packages ultimately
            installed do change.
          </p>
          <h4 id="peer-dependencies">Peer dependencies?</h4>
          <p>
            Peer dependencies are handled similarly to yarn.
            <code>bun install</code> does not automatically install peer
            dependencies and will try to choose an existing dependency.
          </p>
          <h4 id="lockfile">Lockfile</h4>
          <p><code>bun.lockb</code> is bun’s binary lockfile format.</p>
          <h4 id="why-is-it-binary">Why is it binary?</h4>
          <p>
            In a word: Performance. bun’s lockfile saves &amp; loads incredibly
            quickly, and saves a lot more data than what is typically inside
            lockfiles.
          </p>
          <h4 id="how-do-i-inspect-it">How do I inspect it?</h4>
          <p>
            For now, the easiest thing is to run <code>bun install -y</code>.
            That prints a Yarn v1-style yarn.lock file.
          </p>
          <h4 id="what-does-the-lockfile-store">
            What does the lockfile store?
          </h4>
          <p>
            Packages, metadata for those packages, the hoisted install order,
            dependencies for each package, what packages those dependencies
            resolved to, an integrity hash (if available), what each package was
            resolved to and which version (or equivalent).
          </p>
          <h4 id="why-is-it-fast">Why is it fast?</h4>
          <p>
            It uses linear arrays for all data.
            <a
              href="https://github.com/oven-sh/bun/blob/be03fc273a487ac402f19ad897778d74b6d72963/src/install/install.zig#L1825"
              >Packages</a
            >
            are referenced by an auto-incrementing integer ID or a hash of the
            package name. Strings longer than 8 characters are de-duplicated.
            Prior to saving on disk, the lockfile is garbage-collected &amp;
            made deterministic by walking the package tree and cloning the
            packages in dependency order.
          </p>
          <h4 id="cache">Cache</h4>
          <p>To delete the cache:</p>
          <pre><code class="hljs language-bash"><span class="hljs-built_in">rm</span> -rf ~/.bun/install/cache
  </code></pre>
          <h4 id="platform-specific-backends">Platform-specific backends</h4>
          <p>
            <code>bun install</code> uses different system calls to install
            dependencies depending on the platform. This is a performance
            optimization. You can force a specific backend with the
            <code>--backend</code> flag.
          </p>
          <p>
            <strong><code>hardlink</code></strong> is the default backend on
            Linux. Benchmarking showed it to be the fastest on Linux.
          </p>
          <pre><code class="hljs language-bash"><span class="hljs-built_in">rm</span> -rf node_modules
  bun install --backend hardlink
  </code></pre>
          <p>
            <strong><code>clonefile</code></strong> is the default backend on
            macOS. Benchmarking showed it to be the fastest on macOS. It is only
            available on macOS.
          </p>
          <pre><code class="hljs language-bash"><span class="hljs-built_in">rm</span> -rf node_modules
  bun install --backend clonefile
  </code></pre>
          <p>
            <strong><code>clonefile_each_dir</code></strong> is similar to
            <code>clonefile</code>, except it clones each file individually per
            directory. It is only available on macOS and tends to perform slower
            than <code>clonefile</code>. Unlike <code>clonefile</code>, this
            does not recursively clone subdirectories in one system call.
          </p>
          <pre><code class="hljs language-bash"><span class="hljs-built_in">rm</span> -rf node_modules
  bun install --backend clonefile_each_dir
  </code></pre>
          <p>
            <strong><code>copyfile</code></strong> is the fallback used when any
            of the above fail, and is the slowest. on macOS, it uses
            <code>fcopyfile()</code> and on linux it uses
            <code>copy_file_range()</code>.
          </p>
          <pre><code class="hljs language-bash"><span class="hljs-built_in">rm</span> -rf node_modules
  bun install --backend copyfile
  </code></pre>
          <p>
            <strong><code>symlink</code></strong> is typically only used for
            <code>file:</code> dependencies (and eventually <code>link:</code>)
            internally. To prevent infinite loops, it skips symlinking the
            <code>node_modules</code> folder.
          </p>
          <p>
            If you install with <code>--backend=symlink</code>, Node.js won't
            resolve node_modules of dependencies unless each dependency has it's
            own node_modules folder or you pass
            <code>--preserve-symlinks</code> to <code>node</code>. See
            <a href="https://nodejs.org/api/cli.html#--preserve-symlinks"
              >Node.js documentation on <code>--preserve-symlinks</code></a
            >.
          </p>
          <pre><code class="hljs language-bash"><span class="hljs-built_in">rm</span> -rf node_modules
  bun install --backend symlink
  
  <span class="hljs-comment"># https://nodejs.org/api/cli.html#--preserve-symlinks</span>
  node --preserve-symlinks ./my-file.js
  </code></pre>
          <p>
            bun's runtime does not currently expose an equivalent of
            <code>--preserve-symlinks</code>, though the code for it does exist.
          </p>
          <h4 id="npm-registry-metadata">npm registry metadata</h4>
          <p>
            bun uses a binary format for caching NPM registry responses. This
            loads much faster than JSON and tends to be smaller on disk. You
            will see these files in <code>~/.bun/install/cache/*.npm</code>. The
            filename pattern is <code>${hash(packageName)}.npm</code>. It’s a
            hash so that extra directories don’t need to be created for scoped
            packages.
          </p>
          <p>
            bun’s usage of <code>Cache-Control</code> ignores <code>Age</code>.
            This improves performance, but means bun may be about 5 minutes out
            of date to receive the latest package version metadata from npm.
          </p>
          <h3 id="bun-run"><code>bun run</code></h3>
          <p>
            <code>bun run</code> is a fast <code>package.json</code> script
            runner. Instead of waiting 170ms for your npm client to start every
            time, you wait 6ms for bun.
          </p>
          <p>
            By default, <code>bun run</code> prints the script that will be
            invoked:
          </p>
          <pre><code class="hljs language-bash">bun run clean
  $ <span class="hljs-built_in">rm</span> -rf node_modules/.cache dist
  </code></pre>
          <p>You can disable that with <code>--silent</code></p>
          <pre><code class="hljs language-bash">bun run --silent clean
  </code></pre>
          <p>
            <code>bun run ${script-name}</code> runs the equivalent of
            <code>npm run script-name</code>. For example,
            <code>bun run dev</code> runs the <code>dev</code> script in
            <code>package.json</code>, which may sometimes spin up non-bun
            processes.
          </p>
          <p>
            <code>bun run ${javascript-file.js}</code> will run it with bun, as
            long as the file doesn't have a node shebang.
          </p>
          <p>
            To print a list of <code>scripts</code>,
            <code>bun run</code> without additional args:
          </p>
          <pre><code class="hljs language-bash"><span class="hljs-comment"># This command</span>
  bun run
  
  <span class="hljs-comment"># Prints this</span>
  hello-create-react-app scripts:
  
  bun run start
  react-scripts start
  
  bun run build
  react-scripts build
  
  bun run <span class="hljs-built_in">test</span>
  react-scripts <span class="hljs-built_in">test</span>
  
  bun run eject
  react-scripts eject
  
  4 scripts
  </code></pre>
          <p>
            <code>bun run</code> automatically loads environment variables from
            <code>.env</code> into the shell/task. <code>.env</code> files are
            loaded with the same priority as the rest of bun, so that means:
          </p>
          <ol>
            <li><code>.env.local</code> is first</li>
            <li>
              if (<code>$NODE_ENV</code> === <code>"production"</code>)
              <code>.env.production</code> else <code>.env.development</code>
            </li>
            <li><code>.env</code></li>
          </ol>
          <p>
            If something is unexpected there, you can run
            <code>bun run env</code> to get a list of environment variables.
          </p>
          <p>
            The default shell it uses is <code>bash</code>, but if that’s not
            found, it tries <code>sh</code> and if still not found, it tries
            <code>zsh</code>. This is not configurable right now, but if you
            care, file an issue.
          </p>
          <p>
            <code>bun run</code> automatically adds any parent
            <code>node_modules/.bin</code> to <code>$PATH</code> and if no
            scripts match, it will load that binary instead. That means you can
            run executables from packages, too.
          </p>
          <pre><code class="hljs language-bash"><span class="hljs-comment"># If you use Relay</span>
  bun run relay-compiler
  
  <span class="hljs-comment"># You can also do this, but:</span>
  <span class="hljs-comment"># - It will only lookup packages in `node_modules/.bin` instead of `$PATH`</span>
  <span class="hljs-comment"># - It will start bun’s dev server if the script name doesn’t exist (`bun` starts the dev server by default)</span>
  bun relay-compiler
  </code></pre>
          <p>
            To pass additional flags through to the task or executable, there
            are two ways:
          </p>
          <pre><code class="hljs language-bash"><span class="hljs-comment"># Explicit: include "--" and anything after will be added. This is the recommended way because it is more reliable.</span>
  bun run relay-compiler -- -–<span class="hljs-built_in">help</span>
  
  <span class="hljs-comment"># Implicit: if you do not include "--", anything *after* the script name will be passed through</span>
  <span class="hljs-comment"># bun flags are parsed first, which means e.g. `bun run relay-compiler --help` will print bun’s help instead of relay-compiler’s help.</span>
  bun run relay-compiler --schema foo.graphql
  </code></pre>
          <p>
            <code>bun run</code> supports lifecycle hooks like
            <code>post${task}</code> and <code>pre{task}</code>. If they exist,
            they will run, matching the behavior of npm clients. If the
            <code>pre${task}</code> fails, the next task will not be run. There
            is currently no flag to skip these lifecycle tasks if they exist, if
            you want that file an issue.
          </p>
          <h4 id="run-in-buns-javascript-runtime">
            Run in Bun's JavaScript runtime
          </h4>
          <p>
            When given a JavaScript/TypeScript-like file, by default
            <code>bun run</code> will run it in Bun's JavaScript runtime.
          </p>
          <p>
            With one caveat: if there's a
            <code>#!/usr/bin/env node</code> shebang, it will run it with
            Node.js instead by default.
          </p>
          <p>To always run in Bun, use <code>--bun</code>:</p>
          <pre><code class="hljs language-bash">bun run --bun my-script
  </code></pre>
          <p>
            This remaps <code>node</code> in <code>$PATH</code> for the duration
            of the task to <code>bun</code> so that anything trying to execute
            <code>node</code> will runs in Bun's JavaScript runtime instead.
          </p>
          <h3 id="bun---hot"><code>bun --hot</code></h3>
          <p>
            <code>bun --hot</code> enables hot reloading of code in Bun's
            JavaScript runtime. This is a very experimental feature available in
            Bun v0.2.0.
          </p>
          <p>
            Unlike file watchers like <code>nodemon</code>,
            <code>bun --hot</code> can keep stateful objects like the HTTP
            server running.
          </p>
          <table>
            <tr>
              <th>Bun v0.2.0</th>
              <th>Nodemon</th>
            </tr>
          </table>

          <p>
            <img
              src="https://user-images.githubusercontent.com/709451/195477632-5fd8a73e-014d-4589-9ba2-e075ad9eb040.gif"
              alt="Screen Recording 2022-10-06 at 2 36 06 AM"
            />
          </p>
          <p>To use it with Bun's HTTP server (automatic):</p>
          <p><code>server.ts</code>:</p>
          <pre><code class="hljs language-ts"><span class="hljs-comment">// The global object is preserved across code reloads</span>
  <span class="hljs-comment">// You can use it to store state, for now until Bun implements import.meta.hot.</span>
  <span class="hljs-keyword">const</span> reloadCount = globalThis.<span class="hljs-property">reloadCount</span> || <span class="hljs-number">0</span>;
  globalThis.<span class="hljs-property">reloadCount</span> = reloadCount + <span class="hljs-number">1</span>;
  
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-title function_">fetch</span>(<span class="hljs-params">req: Request</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">`Code reloaded <span class="hljs-subst">${reloadCount}</span> times`</span>, {
        <span class="hljs-attr">headers</span>: { <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"text/plain"</span> },
      });
    },
  };
  </code></pre>
          <p>Then, run:</p>
          <pre><code class="hljs language-bash">bun --hot server.ts
  </code></pre>
          <p>You can also use <code>bun run</code>:</p>
          <pre><code class="hljs language-bash">bun run --hot server.ts
  </code></pre>
          <p>To use it manually:</p>
          <pre><code class="hljs language-ts"><span class="hljs-comment">// The global object is preserved across code reloads</span>
  <span class="hljs-comment">// You can use it to store state, for now until Bun implements import.meta.hot.</span>
  <span class="hljs-keyword">const</span> reloadCount = globalThis.<span class="hljs-property">reloadCount</span> || <span class="hljs-number">0</span>;
  globalThis.<span class="hljs-property">reloadCount</span> = reloadCount + <span class="hljs-number">1</span>;
  
  <span class="hljs-keyword">const</span> reloadServer = (globalThis.<span class="hljs-property">reloadServer</span> ||= (<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">let</span> server;
    <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">handler</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (server) {
        <span class="hljs-comment">// call `server.reload` to reload the server</span>
        server.<span class="hljs-title function_">reload</span>(handler);
      } <span class="hljs-keyword">else</span> {
        server = <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">serve</span>(handler);
      }
      <span class="hljs-keyword">return</span> server;
    };
  })());
  
  <span class="hljs-keyword">const</span> handler = {
    <span class="hljs-title function_">fetch</span>(<span class="hljs-params">req: Request</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">`Code reloaded <span class="hljs-subst">${reloadCount}</span> times`</span>, {
        <span class="hljs-attr">headers</span>: { <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"text/plain"</span> },
      });
    },
  };
  
  <span class="hljs-title function_">reloadServer</span>(handler);
  </code></pre>
          <p>
            In a future version of Bun, support for Vite's
            <code>import.meta.hot</code> is planned to enable better lifecycle
            management for hot reloading and to align with the ecosystem.
          </p>
          <h4 id="how-bun---hot-works">How <code>bun --hot</code> works</h4>
          <p>
            <code>bun --hot</code> monitors imported files for changes and
            reloads them. It does not monitor files that are not imported and it
            does not monitor <code>node_modules</code>.
          </p>
          <p>
            On reload, it resets the internal <code>require</code> cache and ES
            module registry (<code>Loader.registry</code>).
          </p>
          <p>Then:</p>
          <ul>
            <li>
              It runs the garbage collector synchronously (to minimize memory
              leaks, at the cost of runtime performance)
            </li>
            <li>
              Bun re-transpiles all of your code from scratch (including
              sourcemaps)
            </li>
            <li>JavaScriptCore (the engine) re-evaluates the code.</li>
          </ul>
          <p>
            Traditional file watchers restart the entire process which means
            that HTTP servers and other stateful objects are lost.
            <code>bun --hot</code> does not restart the process, so it preserves
            <em>some</em> state across reloads to be less intrusive.
          </p>
          <p>
            This implementation isn't particularly optimized. It re-transpiles
            files that haven't changed. It makes no attempt at incremental
            compilation. It's a starting point.
          </p>
          <h3 id="bun-create"><code>bun create</code></h3>
          <p>
            <code>bun create</code> is a fast way to create a new project from a
            template.
          </p>
          <p>
            At the time of writing, <code>bun create react app</code> runs ~11x
            faster on my local computer than
            <code>yarn create react-app app</code>.
            <code>bun create</code> currently does no caching (though your npm
            client does)
          </p>
          <h4 id="usage">Usage</h4>
          <p>Create a new Next.js project:</p>
          <pre><code class="hljs language-bash">bun create next ./app
  </code></pre>
          <p>Create a new React project:</p>
          <pre><code class="hljs language-bash">bun create react ./app
  </code></pre>
          <p>Create from a GitHub repo:</p>
          <pre><code class="hljs language-bash">bun create ahfarmer/calculator ./app
  </code></pre>
          <p>To see a list of templates, run:</p>
          <pre><code class="hljs language-bash">bun create
  </code></pre>
          <p>Format:</p>
          <pre><code class="hljs language-bash">bun create github-user/repo-name destination
  bun create local-example-or-remote-example destination
  bun create /absolute/path/to-template-folder destination
  bun create https://github.com/github-user/repo-name destination
  bun create github.com/github-user/repo-name destination
  </code></pre>
          <p>
            Note: you don’t need <code>bun create</code> to use bun. You don’t
            need any configuration at all. This command exists to make it a
            little easier.
          </p>
          <h4 id="local-templates">Local templates</h4>
          <p>
            If you have your own boilerplate you prefer using, copy it into
            <code>$HOME/.bun-create/my-boilerplate-name</code>.
          </p>
          <p>
            Before checking bun’s templates on npmjs,
            <code>bun create</code> checks for a local folder matching the input
            in:
          </p>
          <ul>
            <li><code>$BUN_CREATE_DIR/</code></li>
            <li><code>$HOME/.bun-create/</code></li>
            <li><code>$(pwd)/.bun-create/</code></li>
          </ul>
          <p>
            If a folder exists in any of those folders with the input, bun will
            use that instead of a remote template.
          </p>
          <p>To create a local template, run:</p>
          <pre><code class="hljs language-bash"><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$HOME</span>/.bun-create/new-template-name
  <span class="hljs-built_in">echo</span> <span class="hljs-string">'{"name":"new-template-name"}'</span> &gt; <span class="hljs-variable">$HOME</span>/.bun-create/new-template-name/package.json
  </code></pre>
          <p>This lets you run:</p>
          <pre><code class="hljs language-bash">bun create new-template-name ./app
  </code></pre>
          <p>Now your new template should appear when you run:</p>
          <pre><code class="hljs language-bash">bun create
  </code></pre>
          <p>
            Warning: unlike with remote templates,
            <strong
              >bun will delete the entire destination folder if it already
              exists.</strong
            >
          </p>
          <h4 id="flags">Flags</h4>
          <table>
            <thead>
              <tr>
                <th>Flag</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>--npm</td>
                <td>Use <code>npm</code> for tasks &amp; install</td>
              </tr>
              <tr>
                <td>--yarn</td>
                <td>Use <code>yarn</code> for tasks &amp; install</td>
              </tr>
              <tr>
                <td>--pnpm</td>
                <td>Use <code>pnpm</code> for tasks &amp; install</td>
              </tr>
              <tr>
                <td>--force</td>
                <td>Overwrite existing files</td>
              </tr>
              <tr>
                <td>--no-install</td>
                <td>Skip installing <code>node_modules</code> &amp; tasks</td>
              </tr>
              <tr>
                <td>--no-git</td>
                <td>Don’t initialize a git repository</td>
              </tr>
              <tr>
                <td>--open</td>
                <td>Start &amp; open in-browser after finish</td>
              </tr>
            </tbody>
          </table>
          <table>
            <thead>
              <tr>
                <th>Environment Variables</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>GITHUB_API_DOMAIN</td>
                <td>
                  If you’re using a GitHub enterprise or a proxy, you can change
                  what the endpoint requests to GitHub go
                </td>
              </tr>
              <tr>
                <td>GITHUB_API_TOKEN</td>
                <td>
                  This lets <code>bun create</code> work with private
                  repositories or if you get rate-limited
                </td>
              </tr>
            </tbody>
          </table>
          <p>
            By default, <code>bun create</code> will cancel if there are
            existing files it would overwrite and it's a remote template. You
            can pass <code>--force</code> to disable this behavior.
          </p>
          <h4 id="publishing-a-new-template">Publishing a new template</h4>
          <p>
            Clone
            <a href="https://github.com/bun-community/create-templates/"
              >https://github.com/bun-community/create-templates/</a
            >
            and create a new folder in root directory with your new template.
            The
            <code>package.json</code> must have a <code>name</code> that starts
            with <code>@bun-examples/</code>. Do not worry about publishing it,
            that will happen automatically after the PR is merged.
          </p>
          <p>
            Make sure to include a <code>.gitignore</code> that includes
            <code>node_modules</code> so that <code>node_modules</code> aren’t
            checked in to git when people download the template.
          </p>
          <h4 id="testing-your-new-template">Testing your new template</h4>
          <p>
            To test your new template, add it as a local template or pass the
            absolute path.
          </p>
          <pre><code class="hljs language-bash">bun create /path/to/my/new/template destination-dir
  </code></pre>
          <p>
            Warning:
            <strong
              >This will always delete everything in destination-dir</strong
            >.
          </p>
          <h4 id="config">Config</h4>
          <p>
            The <code>bun-create</code> section of <code>package.json</code> is
            automatically removed from the <code>package.json</code> on disk.
            This lets you add create-only steps without waiting for an extra
            package to install.
          </p>
          <p>There are currently three options:</p>
          <ul>
            <li><code>postinstall</code></li>
            <li><code>preinstall</code></li>
            <li><code>start</code> (customize the displayed start command)</li>
          </ul>
          <p>
            They can be an array of strings or one string. An array of steps
            will be executed in order.
          </p>
          <p>Here is an example:</p>
          <pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@bun-examples/next"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.31"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"index.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"next"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"11.1.2"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^17.0.2"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"react-dom"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^17.0.2"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"react-is"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^17.0.2"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"@types/react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^17.0.19"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"bun-framework-next"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^0.0.0-21"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"typescript"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.3.5"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"bun-create"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"postinstall"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"bun bun --use next"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bun run echo 'Hello world!'"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
  </code></pre>
          <p>
            By default, all commands run inside the environment exposed by the
            auto-detected npm client. This incurs a significant performance
            penalty, something like 150ms spent waiting for the npm client to
            start on each invocation.
          </p>
          <p>
            Any command that starts with <code>"bun "</code> will be run without
            npm, relying on the first <code>bun</code> binary in
            <code>$PATH</code>.
          </p>
          <h4 id="how-bun-create-works">How <code>bun create</code> works</h4>
          <p>
            When you run <code>bun create ${template} ${destination}</code>,
            here’s what happens:
          </p>
          <p>IF remote template</p>
          <ol>
            <li>
              <p>
                GET
                <code>registry.npmjs.org/@bun-examples/${template}/latest</code>
                and parse it
              </p>
            </li>
            <li>
              <p>
                GET
                <code
                  >registry.npmjs.org/@bun-examples/${template}/-/${template}-${latestVersion}.tgz</code
                >
              </p>
            </li>
            <li>
              <p>
                Decompress &amp; extract
                <code>${template}-${latestVersion}.tgz</code> into
                <code>${destination}</code>
              </p>
              <ul>
                <li>
                  If there are files that would overwrite, warn and exit unless
                  <code>--force</code> is passed
                </li>
              </ul>
            </li>
          </ol>
          <p>IF GitHub repo</p>
          <ol>
            <li><p>Download the tarball from GitHub’s API</p></li>
            <li>
              <p>Decompress &amp; extract into <code>${destination}</code></p>
              <ul>
                <li>
                  If there are files that would overwrite, warn and exit unless
                  <code>--force</code> is passed
                </li>
              </ul>
            </li>
          </ol>
          <p>ELSE IF local template</p>
          <ol>
            <li><p>Open local template folder</p></li>
            <li><p>Delete destination directory recursively</p></li>
            <li>
              <p>
                Copy files recursively using the fastest system calls available
                (on macOS <code>fcopyfile</code> and Linux,
                <code>copy_file_range</code>). Do not copy or traverse into
                <code>node_modules</code> folder if exists (this alone makes it
                faster than <code>cp</code>)
              </p>
            </li>
            <li>
              <p>
                Parse the <code>package.json</code> (again!), update
                <code>name</code> to be <code>${basename(destination)}</code>,
                remove the <code>bun-create</code> section from the
                <code>package.json</code> and save the updated
                <code>package.json</code> to disk.
              </p>
              <ul>
                <li>
                  IF Next.js is detected, add <code>bun-framework-next</code> to
                  the list of dependencies
                </li>
                <li>
                  IF Create React App is detected, add the entry point in
                  /src/index.{js,jsx,ts,tsx} to <code>public/index.html</code>
                </li>
                <li>
                  IF Relay is detected, add <code>bun-macro-relay</code> so that
                  Relay works
                </li>
              </ul>
            </li>
            <li>
              <p>
                Auto-detect the npm client, preferring <code>pnpm</code>,
                <code>yarn</code> (v1), and lastly <code>npm</code>
              </p>
            </li>
            <li>
              <p>
                Run any tasks defined in
                <code>"bun-create": { "preinstall" }</code> with the npm client
              </p>
            </li>
            <li>
              <p>
                Run <code>${npmClient} install</code> unless
                <code>--no-install</code> is passed OR no dependencies are in
                package.json
              </p>
            </li>
            <li>
              <p>
                Run any tasks defined in
                <code>"bun-create": { "preinstall" }</code> with the npm client
              </p>
            </li>
            <li>
              <p>
                Run
                <code
                  >git init; git add -A .; git commit -am "Initial
                  Commit";</code
                >
              </p>
              <ul>
                <li>
                  Rename <code>gitignore</code> to <code>.gitignore</code>. NPM
                  automatically removes <code>.gitignore</code> files from
                  appearing in packages.
                </li>
                <li>
                  If there are dependencies, this runs in a separate thread
                  concurrently while node_modules are being installed
                </li>
                <li>
                  Using libgit2 if available was tested and performed 3x slower
                  in microbenchmarks
                </li>
              </ul>
            </li>
            <li><p>Done</p></li>
          </ol>
          <p>
            <code>misctools/publish-examples.js</code> publishes all examples to
            npm.
          </p>
          <h3 id="bun-bun"><code>bun bun</code></h3>
          <p>
            Run <code>bun bun ./path-to.js</code> to generate a
            <code>node_modules.bun</code> file containing all imported
            dependencies (recursively).
          </p>
          <h4 id="why-bundle">Why bundle?</h4>
          <ul>
            <li>
              For browsers, loading entire apps without bundling dependencies is
              typically slow. With a fast bundler &amp; transpiler, the
              bottleneck eventually becomes the web browser’s ability to run
              many network requests concurrently. There are many workarounds for
              this.
              <code>&lt;link rel="modulepreload"&gt;</code>, HTTP/3, etc., but
              none are more effective than bundling. If you have reproducible
              evidence to the contrary, feel free to submit an issue. It would
              be better if bundling wasn’t necessary.
            </li>
            <li>
              On the server, bundling reduces the number of filesystem lookups
              to load JavaScript. While filesystem lookups are faster than HTTP
              requests, there’s still overhead.
            </li>
          </ul>
          <h4 id="what-is-bun">What is <code>.bun</code>?</h4>
          <p>
            Note:
            <a href="https://github.com/oven-sh/bun/issues/121"
              >This format may change soon</a
            >
          </p>
          <p>The <code>.bun</code> file contains:</p>
          <ul>
            <li>all the bundled source code</li>
            <li>all the bundled source code metadata</li>
            <li>project metadata &amp; configuration</li>
          </ul>
          <p>Here are some of the questions <code>.bun</code> files answer:</p>
          <ul>
            <li>
              when I import <code>react/index.js</code>, where in the
              <code>.bun</code> is the code for that? (not resolving, just the
              code)
            </li>
            <li>what modules of a package are used?</li>
            <li>what framework is used? (e.g., Next.js)</li>
            <li>where is the routes directory?</li>
            <li>how big is each imported dependency?</li>
            <li>what is the hash of the bundle’s contents? (for etags)</li>
            <li>
              what is the name &amp; version of every npm package exported in
              this bundle?
            </li>
            <li>
              what modules from which packages are used in this project?
              ("project" is defined as all the entry points used to generate the
              .bun)
            </li>
          </ul>
          <p>All in one file.</p>
          <p>
            It’s a little like a build cache, but designed for reuse across
            builds.
          </p>
          <h4 id="position-independent-code">Position-independent code</h4>
          <p>
            From a design perspective, the most important part of the
            <code>.bun</code> format is how code is organized. Each module is
            exported by a hash like this:
          </p>
          <pre><code class="hljs language-js"><span class="hljs-comment">// preact/dist/preact.module.js</span>
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">var</span> $eb6819b = $$m({
    <span class="hljs-string">"preact/dist/preact.module.js"</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-variable language_">module</span>, <span class="hljs-built_in">exports</span></span>) =&gt;</span> {
      <span class="hljs-keyword">let</span> n, l, u, i, t, o, r, f, e = {}, c = [], s = <span class="hljs-regexp">/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i</span>;
      <span class="hljs-comment">// ... rest of code</span>
  </code></pre>
          <p>
            This makes bundled modules
            <a href="https://en.wikipedia.org/wiki/Position-independent_code"
              >position-independent</a
            >. In theory, one could import only the exact modules in-use without
            reparsing code and without generating a new bundle. One bundle can
            dynamically become many bundles comprising only the modules in use
            on the webpage. Thanks to the metadata with the byte offsets, a web
            server can send each module to browsers
            <a href="https://en.wikipedia.org/wiki/Zero-copy">zero-copy</a>
            using
            <a href="https://man7.org/linux/man-pages/man2/sendfile.2.html"
              >sendfile</a
            >. bun itself is not quite this smart yet, but these optimizations
            would be useful in production and potentially very useful for React
            Server Components.
          </p>
          <p>
            To see the schema inside, have a look at
            <a
              href="./src/api/schema.d.ts#:~:text=export%20interface-,JavascriptBundleContainer,-%7B"
              ><code>JavascriptBundleContainer</code></a
            >. You can find JavaScript bindings to read the metadata in
            <a href="./src/api/schema.js">src/api/schema.js</a>. This is not
            really an API yet. It’s missing the part where it gets the binary
            data from the bottom of the file. Someday, I want this to be usable
            by other tools too.
          </p>
          <h4 id="where-is-the-code">Where is the code?</h4>
          <p><code>.bun</code> files are marked as executable.</p>
          <p>
            To print out the code, run <code>./node_modules.bun</code> in your
            terminal or run <code>bun ./path-to-node_modules.bun</code>.
          </p>
          <p>Here is a copy-pastable example:</p>
          <pre><code class="hljs language-bash">./node_modules.bun &gt; node_modules.js
  </code></pre>
          <p>
            This works because every <code>.bun</code> file starts with this:
          </p>
          <pre><code class="hljs language-bash"><span class="hljs-meta">#!/usr/bin/env bun</span>
  </code></pre>
          <p>
            To deploy to production with bun, you’ll want to get the code from
            the
            <code>.bun</code> file and stick that somewhere your web server can
            find it (or if you’re using Vercel or a Rails app, in a
            <code>public</code> folder).
          </p>
          <p>
            Note that <code>.bun</code> is a binary file format, so just opening
            it in VSCode or vim might render strangely.
          </p>
          <h4 id="advanced">Advanced</h4>
          <p>
            By default, <code>bun bun</code> only bundles external dependencies
            that are <code>import</code>ed or <code>require</code>d in either
            app code or another external dependency. An "external dependency" is
            defined as, "A JavaScript-like file that has
            <code>/node_modules/</code> in the resolved file path and a
            corresponding <code>package.json</code>".
          </p>
          <p>
            To force bun to bundle packages which are not located in a
            <code>node_modules</code> folder (i.e., the final, resolved path
            following all symlinks), add a <code>bun</code> section to the root
            project’s <code>package.json</code> with
            <code>alwaysBundle</code> set to an array of package names to always
            bundle. Here’s an example:
          </p>
          <pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-package-name-in-here"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"bun"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"alwaysBundle"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"@mybigcompany/my-workspace-package"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
  </code></pre>
          <p>
            Bundled dependencies are not eligible for Hot Module Reloading. The
            code is served to browsers &amp; bun.js verbatim. But, in the
            future, it may be sectioned off into only parts of the bundle being
            used. That’s possible in the current version of the
            <code>.bun</code> file (so long as you know which files are
            necessary), but it’s not implemented yet. Longer-term, it will
            include all <code>import</code> and <code>export</code> of each
            module inside.
          </p>
          <h4 id="what-is-the-module-id-hash">What is the module ID hash?</h4>
          <p>The <code>$eb6819b</code> hash used here:</p>
          <pre><code class="hljs language-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">var</span> $eb6819b = $$m({
  </code></pre>
          <p>Is generated like this:</p>
          <ol>
            <li>
              Murmur3 32-bit hash of <code>package.name@package.version</code>.
              This is the hash uniquely identifying the npm package.
            </li>
            <li>
              Wyhash 64 of the <code>package.hash</code> +
              <code>package_path</code>. <code>package_path</code> means
              "relative to the root of the npm package, where is the module
              imported?". For example, if you imported
              <code>react/jsx-dev-runtime.js</code>, the
              <code>package_path</code> is <code>jsx-dev-runtime.js</code>.
              <code>react-dom/cjs/react-dom.development.js</code> would be
              <code>cjs/react-dom.development.js</code>
            </li>
            <li>Truncate the hash generated above to a <code>u32</code></li>
          </ol>
          <p>
            The implementation details of this module ID hash will vary between
            versions of bun. The important part is the metadata contains the
            module IDs, the package paths, and the package hashes, so it
            shouldn’t really matter in practice if other tooling wants to make
            use of any of this.
          </p>
          <h3 id="bun-upgrade"><code>bun upgrade</code></h3>
          <p>To upgrade bun, run <code>bun upgrade</code>.</p>
          <p>
            It automatically downloads the latest version of bun and overwrites
            the currently-running version.
          </p>
          <p>
            This works by checking the latest version of bun in
            <a
              href="https://github.com/Jarred-Sumner/bun-releases-for-updater/releases"
              >bun-releases-for-updater</a
            >
            and unzipping it using the system-provided
            <code>unzip</code> library (so that Gatekeeper works on macOS)
          </p>
          <p>
            If for any reason you run into issues, you can also use the curl
            install script:
          </p>
          <pre><code class="hljs language-bash">curl https://bun.sh/install | bash
  </code></pre>
          <p>It will still work when bun is already installed.</p>
          <p>
            bun is distributed as a single binary file, so you can also do this
            manually:
          </p>
          <ul>
            <li>
              Download the latest version of bun for your platform in
              <a
                href="https://github.com/Jarred-Sumner/bun-releases-for-updater/releases/latest"
                >bun-releases-for-updater</a
              >
              (<code>darwin</code> == macOS)
            </li>
            <li>Unzip the folder</li>
            <li>
              Move the <code>bun</code> binary to <code>~/.bun/bin</code> (or
              anywhere)
            </li>
          </ul>
          <h3 id="canary-builds">Canary builds</h3>
          <p>
            <a href="https://github.com/oven-sh/bun/releases/tag/canary"
              >Canary</a
            >
            builds are generated on every commit.
          </p>
          <p>
            To install a
            <a href="https://github.com/oven-sh/bun/releases/tag/canary"
              >canary</a
            >
            build of bun, run:
          </p>
          <pre><code class="hljs language-bash">bun upgrade --canary
  </code></pre>
          <p>
            This flag is not persistent (though that might change in the
            future). If you want to always run the canary build of bun, set the
            <code>BUN_CANARY</code> environment variable to <code>1</code> in
            your shell's startup script.
          </p>
          <p>
            This will download the release zip from
            <a href="https://github.com/oven-sh/bun/releases/tag/canary"
              >https://github.com/oven-sh/bun/releases/tag/canary</a
            >.
          </p>
          <p>To revert to the latest published version of bun, run:</p>
          <pre><code class="hljs language-bash">bun upgrade
  </code></pre>
          <h3 id="bun-init"><code>bun init</code></h3>
          <p>
            <code>bun init</code> is a quick way to start a blank project with
            Bun. It guesses with sane defaults and is non-destructive when run
            multiple times.
          </p>
          <p>
            <img
              src="https://user-images.githubusercontent.com/709451/183006613-271960a3-ff22-4f7c-83f5-5e18f684c836.gif"
              alt="Demo"
            />
          </p>
          <p>It creates:</p>
          <ul>
            <li>
              a <code>package.json</code> file with a name that defaults to the
              current directory name
            </li>
            <li>
              a <code>tsconfig.json</code> file or a
              <code>jsconfig.json</code> file, depending if the entry point is a
              TypeScript file or not
            </li>
            <li>
              an entry point which defaults to <code>index.ts</code> unless any
              of <code>index.{tsx, jsx, js, mts, mjs}</code> exist or the
              <code>package.json</code> specifies a <code>module</code> or
              <code>main</code> field
            </li>
            <li>a <code>README.md</code> file</li>
          </ul>
          <p>
            If you pass <code>-y</code> or <code>--yes</code>, it will assume
            you want to continue without asking questions.
          </p>
          <p>
            At the end, it runs <code>bun install</code> to install
            <code>bun-types</code>.
          </p>
          <p>Added in Bun v0.1.7.</p>
          <h4 id="how-is-bun-init-different-than-bun-create">
            How is <code>bun init</code> different than <code>bun create</code>?
          </h4>
          <p>
            <code>bun init</code> is for blank projects.
            <code>bun create</code> applies templates.
          </p>
          <h3 id="bun-completions"><code>bun completions</code></h3>
          <p>
            This command installs completions for <code>zsh</code> and/or
            <code>fish</code>. It runs automatically on every
            <code>bun upgrade</code> and on install. It reads from
            <code>$SHELL</code> to determine which shell to install for. It
            tries several common shell completion directories for your shell and
            OS.
          </p>
          <p>
            If you want to copy the completions manually, run
            <code>bun completions &gt; path-to-file</code>. If you know the
            completions directory to install them to, run
            <code>bun completions /path/to/directory</code>.
          </p>
          <h2 id="loader-api">Loader API</h2>
          <p>Bun v0.1.11 introduces custom loaders.</p>
          <ul>
            <li>
              import and require <code>.svelte</code>, <code>.vue</code>,
              <code>.yaml</code>, <code>.scss</code>, <code>.less</code> and
              other file extensions that Bun doesn't implement a builtin loader
              for
            </li>
            <li>Dynamically generate ESM &amp; CJS modules</li>
          </ul>
          <p>
            <strong>YAML loader via <code>js-yaml</code></strong>
          </p>
          <p>
            This is an <code>"object"</code> loader. <code>object</code> loaders
            let you return a JS object that Bun converts to an ESM &amp; CJS
            module.
          </p>
          <p>Plugin implementation (<code>my-yaml-plugin.js</code>)</p>
          <pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { plugin } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun"</span>;
  
  <span class="hljs-title function_">plugin</span>({
    <span class="hljs-attr">name</span>: <span class="hljs-string">"YAML"</span>,
  
    <span class="hljs-title function_">setup</span>(<span class="hljs-params">builder</span>) {
      <span class="hljs-keyword">const</span> { load } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"js-yaml"</span>);
      <span class="hljs-keyword">const</span> { readFileSync } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);
      <span class="hljs-comment">// Run this function on any import that ends with .yaml or .yml</span>
      builder.<span class="hljs-title function_">onLoad</span>({ <span class="hljs-attr">filter</span>: <span class="hljs-regexp">/\.(yaml|yml)$/</span> }, <span class="hljs-function">(<span class="hljs-params">args</span>) =&gt;</span> {
        <span class="hljs-comment">// Read the YAML file from disk</span>
        <span class="hljs-keyword">const</span> text = <span class="hljs-title function_">readFileSync</span>(args.<span class="hljs-property">path</span>, <span class="hljs-string">"utf8"</span>);
  
        <span class="hljs-comment">// parse the YAML file with js-yaml</span>
        <span class="hljs-keyword">const</span> <span class="hljs-built_in">exports</span> = <span class="hljs-title function_">load</span>(text);
  
        <span class="hljs-keyword">return</span> {
          <span class="hljs-comment">// Copy the keys and values from the parsed YAML file into the ESM module namespace object</span>
          <span class="hljs-built_in">exports</span>,
  
          <span class="hljs-comment">// we're returning an object</span>
          <span class="hljs-attr">loader</span>: <span class="hljs-string">"object"</span>,
        };
      });
    },
  });
  </code></pre>
          <p>Plugin usage:</p>
          <pre><code class="hljs language-js"><span class="hljs-keyword">import</span> <span class="hljs-string">"./my-yaml-plugin.js"</span>;
  <span class="hljs-keyword">import</span> { hello } <span class="hljs-keyword">from</span> <span class="hljs-string">"./myfile.yaml"</span>;
  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(hello); <span class="hljs-comment">// "world"</span>
  </code></pre>
          <p>
            <strong>Svelte loader using <code>svelte/compiler</code></strong>
          </p>
          <p>
            This is a <code>"js"</code> loader, which lets you return a JS
            string or <code>ArrayBufferView</code> that Bun converts to an ESM
            &amp; CJS module.
          </p>
          <p>Plugin implementation (<code>myplugin.js</code>)</p>
          <pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { plugin } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun"</span>;
  
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">plugin</span>({
    <span class="hljs-attr">name</span>: <span class="hljs-string">"svelte loader"</span>,
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params">builder</span>) {
      <span class="hljs-keyword">const</span> { compile } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">"svelte/compiler"</span>);
      <span class="hljs-keyword">const</span> { readFileSync } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">import</span>(<span class="hljs-string">"fs"</span>);
  
      <span class="hljs-comment">// Register a loader for .svelte files</span>
      builder.<span class="hljs-title function_">onLoad</span>({ <span class="hljs-attr">filter</span>: <span class="hljs-regexp">/\.svelte$/</span> }, <span class="hljs-function">(<span class="hljs-params">{ path }</span>) =&gt;</span> ({
        <span class="hljs-comment">// Run the Svelte compiler on the import path</span>
        <span class="hljs-attr">contents</span>: <span class="hljs-title function_">compile</span>(<span class="hljs-title function_">readFileSync</span>(path, <span class="hljs-string">"utf8"</span>), {
          <span class="hljs-attr">filename</span>: path,
          <span class="hljs-attr">generate</span>: <span class="hljs-string">"ssr"</span>,
        }).<span class="hljs-property">js</span>.<span class="hljs-property">code</span>,
  
        <span class="hljs-comment">// Set the loader to "js"</span>
        <span class="hljs-comment">// This runs it through Bun's transpiler</span>
        <span class="hljs-attr">loader</span>: <span class="hljs-string">"js"</span>,
      }));
    },
  });
  </code></pre>
          <p>
            Note: in a production implementation, you'd want to cache the
            compiled output and include additional error handling.
          </p>
          <p>Plugin usage:</p>
          <pre><code class="hljs language-js"><span class="hljs-keyword">import</span> <span class="hljs-string">"./myplugin.js"</span>;
  <span class="hljs-keyword">import</span> <span class="hljs-title class_">MySvelteComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./component.svelte"</span>;
  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mySvelteComponent.<span class="hljs-title function_">render</span>());
  </code></pre>
          <h3 id="loader-api-reference">Loader API Reference</h3>
          <p>
            Bun's loader API interface is loosely based on
            <a href="https://esbuild.github.io/plugins">esbuild</a>. Some
            esbuild plugins "just work" in Bun.
          </p>
          <p>MDX:</p>
          <pre><code class="hljs language-jsx"><span class="hljs-keyword">import</span> { plugin } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun"</span>;
  <span class="hljs-keyword">import</span> { renderToStaticMarkup } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-dom/server"</span>;
  
  <span class="hljs-comment">// it's the esbuild plugin, but it works using Bun's transpiler.</span>
  <span class="hljs-keyword">import</span> mdx <span class="hljs-keyword">from</span> <span class="hljs-string">"@mdx-js/esbuild"</span>;
  
  <span class="hljs-title function_">plugin</span>(<span class="hljs-title function_">mdx</span>());
  
  <span class="hljs-keyword">import</span> <span class="hljs-title class_">Foo</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./bar.mdx"</span>;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">renderToStaticMarkup</span>(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Foo</span> /&gt;</span></span>));
  </code></pre>
          <p>
            At the core of the loader API are <code>filter</code> and
            <code>namespace</code>. <code>filter</code> is a RegExp matched
            against import paths. <code>namespace</code> is a prefix inserted
            into the import path (unlike esbuild, Bun inserts the prefix into
            transpiled output). For example, if you have a loader with a
            <code>filter</code> of <code>\.yaml$</code> and a
            <code>namespace</code> of <code>yaml:</code>, then the import path
            <code>./myfile.yaml</code> will be transformed to
            <code>yaml:./myfile.yaml</code>.
          </p>
          <p>
            <strong><code>plugin</code> function</strong>
          </p>
          <p>
            At the top-level, a <code>plugin</code> function exported from
            <code>"bun"</code> expects a <code>"name"</code> string and a
            <code>"setup"</code> function that takes a
            <code>builder</code> object.
          </p>
          <p>
            For plugins to automatically activate, the
            <code>plugin</code> function must be from an import statement like
            this:
          </p>
          <pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { plugin } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun"</span>;
  
  <span class="hljs-comment">// This automatically activates on import</span>
  <span class="hljs-title function_">plugin</span>({
    <span class="hljs-attr">name</span>: <span class="hljs-string">"my plugin"</span>,
    <span class="hljs-title function_">setup</span>(<span class="hljs-params">builder</span>) {},
  });
  
  <span class="hljs-comment">/* Bun.plugin() does not automatically activate. */</span>
  </code></pre>
          <p>Inside the <code>setup</code> function, you can:</p>
          <ul>
            <li>register loaders using <code>builder.onLoad()</code></li>
            <li>register resolvers using <code>builder.onResolve()</code></li>
          </ul>
          <p>
            Internally, Bun's transpiler automatically turns
            <code>plugin()</code> calls into separate files (at most 1 per
            file). This lets loaders activate before the rest of your
            application runs with zero configuration.
          </p>
          <h4 id="builderonload-filter-namespace-optional-namespace--callback">
            <code
              >builder.onLoad({ filter, namespace?: "optional-namespace" },
              callback)</code
            >
          </h4>
          <p>
            <code>builder.onLoad()</code> registers a loader for a matching
            <code>filter</code> RegExp and <code>namespace</code> string.
          </p>
          <p>
            The <code>callback</code> function is called with an
            <code>args</code> object that contains the following properties:
          </p>
          <ul>
            <li><code>path</code>: the path of the file being loaded</li>
          </ul>
          <p>
            For now, that's the only property. More will likely be added in the
            future.
          </p>
          <p><strong>Loader types</strong></p>
          <p>There are different types of loaders:</p>
          <ul>
            <li>
              <code>"js"</code>, <code>"jsx"</code>, <code>"ts"</code>,
              <code>"tsx"</code>: these loaders run the source text through
              Bun's transpiler
            </li>
            <li>
              <code>"json"</code>, <code>"toml"</code>: these loaders run the
              source text through Bun's built-in parsers
            </li>
            <li>
              <code>"object"</code>: this loader inserts a new ECMAScript Module
              into the ECMAScript Module registry by copying all the keys and
              values from the <code>"exports"</code> object into the
              <a href="https://tc39.es/ecma262/#module-namespace-exotic-object"
                >Module Namespace Object</a
              >
            </li>
          </ul>
          <p>
            The <code>callback</code> function expects a return value that
            contains <code>contents</code> and <code>loader</code> properties,
            unless the loader is <code>"object"</code>.
          </p>
          <p>
            <code>"contents"</code> is the source code. It can be a string or an
            <code>ArrayBufferView</code>.
          </p>
          <p>
            <code>"loader"</code> is the loader type. It can be
            <code>"js"</code>, <code>"jsx"</code>, <code>"ts"</code>,
            <code>"tsx"</code>, <code>"json"</code>, <code>"toml"</code>, or
            <code>"object"</code>.
          </p>
          <p>
            If <code>"loader"</code> is <code>"object"</code>, the
            <code>callback</code> function expects a
            <code>"exports"</code> object instead of <code>"contents"</code>.
            The keys and values will be copied onto the ESM module namespace
            object.
          </p>
          <p>
            <code>"object"</code> loaders are useful when the return value is
            parsed into an object, like when parsing YAML, JSON, or other data
            formats. Most loader APIs force you to stringify values and parse
            again. This loader lets you skip that step, which improves
            performance and is a little easier sometimes.
          </p>
          <h2 id="bunserve---fast-http-server">
            <code>Bun.serve</code> - fast HTTP server
          </h2>
          <p>
            For a hello world HTTP server that writes "bun!",
            <code>Bun.serve</code> serves about 2.5x more requests per second
            than node.js on Linux:
          </p>
          <table>
            <thead>
              <tr>
                <th>Requests per second</th>
                <th>Runtime</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>~64,000</td>
                <td>Node 16</td>
              </tr>
              <tr>
                <td>~160,000</td>
                <td>Bun</td>
              </tr>
            </tbody>
          </table>
          <p><sup>Bigger is better</sup></p>

          Code

          <p>Bun:</p>
          <pre><code class="hljs language-ts"><span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">serve</span>({
    <span class="hljs-title function_">fetch</span>(<span class="hljs-params">req: Request</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">`bun!`</span>);
    },
    <span class="hljs-attr">port</span>: <span class="hljs-number">3000</span>,
  });
  </code></pre>
          <p>Node:</p>
          <pre><code class="hljs language-ts"><span class="hljs-built_in">require</span>(<span class="hljs-string">"http"</span>)
    .<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> res.<span class="hljs-title function_">end</span>(<span class="hljs-string">"bun!"</span>))
    .<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
  </code></pre>
          <img
            width="499"
            alt="image"
            src="https://user-images.githubusercontent.com/709451/162389032-fc302444-9d03-46be-ba87-c12bd8ce89a0.png"
          />

          <h4 id="usage-1">Usage</h4>
          <p>Two ways to start an HTTP server with bun.js:</p>
          <ol>
            <li>
              <code>export default</code> an object with a
              <code>fetch</code> function
            </li>
          </ol>
          <p>
            If the file used to start bun has a default export with a
            <code>fetch</code> function, it will start the HTTP server.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-comment">// hi.js</span>
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-title function_">fetch</span>(<span class="hljs-params">req</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">"HI!"</span>);
    },
  };
  
  <span class="hljs-comment">// bun ./hi.js</span>
  </code></pre>
          <p>
            <code>fetch</code> receives a
            <a href="https://developer.mozilla.org/en-US/docs/Web/API/Request"
              ><code>Request</code></a
            >
            object and must return either a
            <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response"
              ><code>Response</code>
            </a>
            or a
            <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response"
              ><code>Promise&lt;Response&gt;</code></a
            >. In a future version, it might have additional arguments for
            things like cookies.
          </p>
          <ol>
            <li><code>Bun.serve</code> starts the HTTP server explicitly</li>
          </ol>
          <pre><code class="hljs language-ts"><span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">serve</span>({
    <span class="hljs-title function_">fetch</span>(<span class="hljs-params">req</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">"HI!"</span>);
    },
  });
  </code></pre>
          <h4 id="error-handling">Error handling</h4>
          <p>For error handling, you get an <code>error</code> function.</p>
          <p>
            If <code>development: true</code> and <code>error</code> is not
            defined or doesn't return a <code>Response</code>, you will get an
            exception page with a stack trace:
          </p>
          <img
            width="687"
            alt="image"
            src="https://user-images.githubusercontent.com/709451/162382958-23614e8f-239c-4ba6-be75-b76ceef8227c.png"
          />

          <p>
            It will hopefully make it easier to debug issues with bun until bun
            gets debugger support. This error page is based on what
            <code>bun dev</code> does.
          </p>
          <p>
            <strong
              >If the error function returns a <code>Response</code>, it will be
              served instead</strong
            >
          </p>
          <pre><code class="hljs language-js"><span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">serve</span>({
    <span class="hljs-title function_">fetch</span>(<span class="hljs-params">req</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"woops!"</span>);
    },
    <span class="hljs-title function_">error</span>(<span class="hljs-params">error: <span class="hljs-built_in">Error</span></span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">"Uh oh!!\n"</span> + error.<span class="hljs-title function_">toString</span>(), { <span class="hljs-attr">status</span>: <span class="hljs-number">500</span> });
    },
  });
  </code></pre>
          <p>
            <strong
              >If the <code>error</code> function itself throws and
              <code>development</code> is <code>false</code>, a generic 500 page
              will be shown</strong
            >
          </p>
          <p>To stop the server, call <code>server.stop()</code>:</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">const</span> server = <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">serve</span>({
    <span class="hljs-title function_">fetch</span>(<span class="hljs-params"></span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">"HI!"</span>);
    },
  });
  
  server.<span class="hljs-title function_">stop</span>();
  </code></pre>
          <h3 id="https-with-bunserve">HTTPS with Bun.serve()</h3>
          <p>
            <code>Bun.serve()</code> has builtin support for TLS (HTTPS). Pass
            <code>keyFile</code> and <code>certFile</code> option to enable
            HTTPS.
          </p>
          <p>Example:</p>
          <pre><code class="hljs language-ts"><span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">serve</span>({
    <span class="hljs-title function_">fetch</span>(<span class="hljs-params">req</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">"Hello!!!"</span>);
    },
    <span class="hljs-comment">/**
     * File path to a TLS key
     *
     * To enable TLS, this option is required.
     */</span>
    <span class="hljs-attr">keyFile</span>: <span class="hljs-string">"./key.pem"</span>,
    <span class="hljs-comment">/**
     * File path to a TLS certificate
     *
     * To enable TLS, this option is required.
     */</span>
    <span class="hljs-attr">certFile</span>: <span class="hljs-string">"./cert.pem"</span>,
  
    <span class="hljs-comment">/**
     * Optional SSL options
     */</span>
    <span class="hljs-comment">// passphrase?: string;</span>
    <span class="hljs-comment">// caFile?: string;</span>
    <span class="hljs-comment">// dhParamsFile?: string;</span>
    <span class="hljs-comment">// lowMemoryMode?: boolean;</span>
  });
  </code></pre>
          <h3 id="streaming-files-with-bunserve">
            Streaming files with Bun.serve()
          </h3>
          <p><code>Bun.serve()</code> lets you stream files fast.</p>
          <p>
            To stream a file, return a <code>Response</code> object with a
            <code>Bun.file(pathOrFd)</code> object as the body.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { serve, file } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun"</span>;
  
  <span class="hljs-title function_">serve</span>({
    <span class="hljs-title function_">fetch</span>(<span class="hljs-params">req</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-title function_">file</span>(<span class="hljs-string">"./hello.txt"</span>));
    },
  });
  </code></pre>
          <p>
            Bun automatically uses the
            <a href="https://man7.org/linux/man-pages/man2/sendfile.2.html"
              ><code>sendfile(2)</code></a
            >
            system call when possible, enabling zero-copy file transfers in the
            kernel — the fastest way to send files.
          </p>
          <p>
            Note: You can also read the files into memory and send it manually,
            but that is slower.
          </p>
          <p><strong>Sending only part of a file</strong></p>
          <p><sup>Available in Bun v0.3.0</sup></p>
          <p>
            <code>Bun.serve()</code> has builtin support for the
            <code>Content-Range</code> header
          </p>
          <p>
            To stream up to the first N bytes of a file, call
            <a
              href="https://developer.mozilla.org/en-US/docs/Web/API/Blob/slice"
              ><code>slice(start, end)</code></a
            >
            on the <code>Bun.file</code> object:
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { serve, file } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun"</span>;
  
  <span class="hljs-title function_">serve</span>({
    <span class="hljs-title function_">fetch</span>(<span class="hljs-params">req</span>) {
      <span class="hljs-keyword">const</span> [start = <span class="hljs-number">0</span>, end = <span class="hljs-title class_">Infinity</span>] =
        req.<span class="hljs-property">headers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">"Range"</span>).<span class="hljs-title function_">split</span>(<span class="hljs-string">"="</span>).<span class="hljs-title function_">at</span>(-<span class="hljs-number">1</span>).<span class="hljs-title function_">split</span>(<span class="hljs-string">"-"</span>) ?? [];
  
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(
        <span class="hljs-title function_">file</span>(<span class="hljs-string">"./my-big-video-to-stream.mp4"</span>).<span class="hljs-title function_">slice</span>(<span class="hljs-title class_">Number</span>(start), <span class="hljs-title class_">Number</span>(end)),
      );
    },
  });
  </code></pre>
          <h3 id="websockets-with-bunserve">WebSockets with Bun.serve()</h3>
          <p>
            <code>Bun.serve()</code> has builtin support for server-side
            websockets (as of Bun v0.2.1).
          </p>
          <p>Features:</p>
          <ul>
            <li>Compression (pass <code>perMessageDeflate: true</code>)</li>
            <li>HTTPS</li>
            <li>Pubsub / broadcast support with MQTT-like topics</li>
          </ul>
          <p>
            It's also fast. For
            <a href="./bench/websocket-server/">a chatroom</a> on Linux x64:
          </p>
          <table>
            <thead>
              <tr>
                <th>Messages sent per second</th>
                <th>Runtime</th>
                <th>Clients</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>~700,000</td>
                <td>(<code>Bun.serve</code>) Bun v0.2.1 (x64)</td>
                <td>16</td>
              </tr>
              <tr>
                <td>~100,000</td>
                <td>(<code>ws</code>) Node v18.10.0 (x64)</td>
                <td>16</td>
              </tr>
            </tbody>
          </table>
          <p>Here is an example that echoes back any message it receives:</p>
          <pre><code class="hljs language-ts"><span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">serve</span>({
    <span class="hljs-attr">websocket</span>: {
      <span class="hljs-title function_">message</span>(<span class="hljs-params">ws, message</span>) {
        ws.<span class="hljs-title function_">send</span>(message);
      },
    },
  
    <span class="hljs-title function_">fetch</span>(<span class="hljs-params">req, server</span>) {
      <span class="hljs-comment">// Upgrade to a ServerWebSocket if we can</span>
      <span class="hljs-comment">// This automatically checks for the `Sec-WebSocket-Key` header</span>
      <span class="hljs-comment">// meaning you don't have to check headers, you can just call `upgrade()`</span>
      <span class="hljs-keyword">if</span> (server.<span class="hljs-title function_">upgrade</span>(req))
        <span class="hljs-comment">// When upgrading, we return undefined since we don't want to send a Response</span>
        <span class="hljs-keyword">return</span>;
  
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">"Regular HTTP response"</span>);
    },
  });
  </code></pre>
          <p>Here is a more complete example:</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">type</span> <span class="hljs-title class_">User</span> = {
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  };
  
  <span class="hljs-title class_">Bun</span>.<span class="hljs-property">serve</span>&lt;<span class="hljs-title class_">User</span>&gt;({
    <span class="hljs-title function_">fetch</span>(<span class="hljs-params">req, server</span>) {
      <span class="hljs-keyword">if</span> (req.<span class="hljs-property">url</span> === <span class="hljs-string">"/chat"</span>) {
        <span class="hljs-keyword">if</span> (
          server.<span class="hljs-title function_">upgrade</span>(req, {
            <span class="hljs-comment">// This User object becomes ws.data</span>
            <span class="hljs-attr">data</span>: {
              <span class="hljs-attr">name</span>: <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(req.<span class="hljs-property">url</span>).<span class="hljs-property">searchParams</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">"name"</span>) || <span class="hljs-string">"Friend"</span>,
            },
            <span class="hljs-comment">// Pass along some headers to the client</span>
            <span class="hljs-attr">headers</span>: {
              <span class="hljs-string">"Set-Cookie"</span>: <span class="hljs-string">"name="</span> + <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(req.<span class="hljs-property">url</span>).<span class="hljs-property">searchParams</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">"name"</span>),
            },
          })
        )
          <span class="hljs-keyword">return</span>;
      }
  
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-string">"Expected a websocket connection"</span>, { <span class="hljs-attr">status</span>: <span class="hljs-number">400</span> });
    },
  
    <span class="hljs-attr">websocket</span>: {
      <span class="hljs-title function_">open</span>(<span class="hljs-params">ws</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"WebSocket opened"</span>);
  
        <span class="hljs-comment">// subscribe to "the-group-chat" topic</span>
        ws.<span class="hljs-title function_">subscribe</span>(<span class="hljs-string">"the-group-chat"</span>);
      },
  
      <span class="hljs-title function_">message</span>(<span class="hljs-params">ws, message</span>) {
        <span class="hljs-comment">// In a group chat, we want to broadcast to everyone</span>
        <span class="hljs-comment">// so we use publish()</span>
        ws.<span class="hljs-title function_">publish</span>(<span class="hljs-string">"the-group-chat"</span>, <span class="hljs-string">`<span class="hljs-subst">${ws.data.name}</span>: <span class="hljs-subst">${message}</span>`</span>);
      },
  
      <span class="hljs-title function_">close</span>(<span class="hljs-params">ws, code, reason</span>) {
        ws.<span class="hljs-title function_">publish</span>(<span class="hljs-string">"the-group-chat"</span>, <span class="hljs-string">`<span class="hljs-subst">${ws.data.name}</span> left the chat`</span>);
      },
  
      <span class="hljs-title function_">drain</span>(<span class="hljs-params">ws</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Please send me data. I am ready to receive it."</span>);
      },
  
      <span class="hljs-comment">// enable compression</span>
      <span class="hljs-attr">perMessageDeflate</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-comment">/*
      * perMessageDeflate: {
         **
         * Enable compression on the {@link ServerWebSocket}
         *
         * @default false
         *
         * `true` is equivalent to `"shared"
         compress?: WebSocketCompressor | false | true;
         **
         * Configure decompression
         *
         * @default false
         *
         * `true` is equivalent to `"shared"
         decompress?: WebSocketCompressor | false | true;
      */</span>
  
      <span class="hljs-comment">/**
       * The maximum size of a message
       */</span>
      <span class="hljs-comment">// maxPayloadLength?: number;</span>
      <span class="hljs-comment">/**
       * After a connection has not received a message for this many seconds, it will be closed.
       * <span class="hljs-doctag">@default</span> 120 (2 minutes)
       */</span>
      <span class="hljs-comment">// idleTimeout?: number;</span>
      <span class="hljs-comment">/**
       * The maximum number of bytes that can be buffered for a single connection.
       * <span class="hljs-doctag">@default</span> 16MB
       */</span>
      <span class="hljs-comment">// backpressureLimit?: number;</span>
      <span class="hljs-comment">/**
       * Close the connection if the backpressure limit is reached.
       * <span class="hljs-doctag">@default</span> <span class="hljs-variable">false</span>
       */</span>
      <span class="hljs-comment">// closeOnBackpressureLimit?: boolean;</span>
  
      <span class="hljs-comment">// this makes it so ws.data shows up as a Request object</span>
    },
    <span class="hljs-comment">// TLS is also supported with WebSockets</span>
    <span class="hljs-comment">/**
     * File path to a TLS key
     *
     * To enable TLS, this option is required.
     */</span>
    <span class="hljs-comment">// keyFile: "./key.pem",</span>
    <span class="hljs-comment">/**
     * File path to a TLS certificate
     *
     * To enable TLS, this option is required.
     */</span>
    <span class="hljs-comment">// certFile: "./cert.pem",</span>
  });
  </code></pre>
          <h4 id="serverwebsocket-vs-websocket">
            ServerWebSocket vs WebSocket
          </h4>
          <p>
            For server websocket connections, Bun exposes a
            <code>ServerWebSocket</code> class which is similar to the
            web-standard <code>WebSocket</code> class used for websocket client
            connections, but with a few differences:
          </p>
          <h5 id="headers">Headers</h5>
          <p>
            <code>ServerWebSocket</code> supports passing headers. This is
            useful for setting cookies or other headers that you want to send to
            the client before the connection is upgraded.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">serve</span>({
    <span class="hljs-title function_">fetch</span>(<span class="hljs-params">req, server</span>) {
      <span class="hljs-keyword">if</span> (
        server.<span class="hljs-title function_">upgrade</span>(req, { <span class="hljs-attr">headers</span>: { <span class="hljs-string">"Set-Cookie"</span>: <span class="hljs-string">"name=HiThereMyNameIs"</span> } })
      )
        <span class="hljs-keyword">return</span>;
    },
    <span class="hljs-attr">websocket</span>: {
      <span class="hljs-title function_">message</span>(<span class="hljs-params">ws, message</span>) {
        ws.<span class="hljs-title function_">send</span>(message);
      },
    },
  });
  </code></pre>
          <p>
            The web-standard <code>WebSocket</code> API does not let you specify
            headers.
          </p>
          <h5 id="publishsubscribe">Publish/subscribe</h5>
          <p>
            <code>ServerWebSocket</code> has <code>publish()</code>,
            <code>subscribe()</code>, and <code>unsubscribe</code> methods which
            let you broadcast the same message to all clients connected to a
            topic in one line of code.
          </p>
          <pre><code class="hljs language-ts">ws.<span class="hljs-title function_">publish</span>(<span class="hljs-string">"stock-prices/GOOG"</span>, <span class="hljs-string">`<span class="hljs-subst">${price}</span>`</span>);
  </code></pre>
          <h5 id="backpressure">Backpressure</h5>
          <p>
            <code>ServerWebSocket.send</code> returns a number that indicates:
          </p>
          <ul>
            <li>
              <code>0</code> if the message was dropped due to a connection
              issue
            </li>
            <li>
              <code>-1</code> if the message was enqueued but there is
              backpressure
            </li>
            <li>any other number indicates the number of bytes sent</li>
          </ul>
          <p>
            This lets you have
            <strong>better control over backpressure in your server</strong>.
          </p>
          <p>
            You can also enable/disable compression per message with the
            <code>compress</code> option:
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-comment">// this will compress</span>
  ws.<span class="hljs-title function_">send</span>(<span class="hljs-string">"Hello"</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">1000</span>), <span class="hljs-literal">true</span>);
  </code></pre>
          <p>
            <code>WebSocket.send</code> returns <code>undefined</code> and does
            not indicate backpressure, which can cause issues if you are sending
            a lot of data.
          </p>
          <p>
            <code>ServerWebSocket</code> also supports a
            <code>drain</code> callback that runs when the connection is ready
            to receive more data.
          </p>
          <h5 id="callbacks-are-per-server-instead-of-per-socket">
            Callbacks are per server instead of per socket
          </h5>
          <p>
            <code>ServerWebSocket</code> expects you to pass a
            <code>WebSocketHandler</code> object to the
            <code>Bun.serve()</code> method which has methods for
            <code>open</code>, <code>message</code>, <code>close</code>,
            <code>drain</code>, and <code>error</code>. This is different than
            the client-side <code>WebSocket</code> class which extends
            <code>EventTarget</code> (onmessage, onopen, onclose),
          </p>
          <p>
            Clients tend to not have many socket connections open so an
            event-based API makes sense.
          </p>
          <p>
            But servers tend to have <strong>many</strong> socket connections
            open, which means:
          </p>
          <ul>
            <li>
              Time spent adding/removing event listeners for each connection
              adds up
            </li>
            <li>
              Extra memory spent on storing references to callbacks function for
              each connection
            </li>
            <li>
              Usually, people create new functions for each connection, which
              also means more memory
            </li>
          </ul>
          <p>
            So, instead of using an event-based API,
            <code>ServerWebSocket</code> expects you to pass a single object
            with methods for each event in <code>Bun.serve()</code> and it is
            reused for each connection.
          </p>
          <p>
            This leads to less memory usage and less time spent adding/removing
            event listeners.
          </p>
          <hr />
          <p>
            The interface for <code>Bun.serve</code> is loosely based on what
            <a
              href="https://developers.cloudflare.com/workers/learning/migrating-to-module-workers/#module-workers-in-the-dashboard"
              >Cloudflare Workers</a
            >
            does.
          </p>
          <p>
            The HTTP server and server-side websockets are based on
            <a href="https://github.com/uNetworking/uWebSockets">uWebSockets</a
            >.
          </p>
          <h2 id="bunspawn--spawn-a-process">
            <code>Bun.spawn</code> – spawn a process
          </h2>
          <p>
            <code>Bun.spawn</code> lets you quickly spawn a process. Available
            as of Bun v0.2.0.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { spawn } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun"</span>;
  
  <span class="hljs-keyword">const</span> { stdout } = <span class="hljs-title function_">spawn</span>([<span class="hljs-string">"esbuild"</span>], {
    <span class="hljs-attr">stdin</span>: <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(
      <span class="hljs-string">"https://raw.githubusercontent.com/oven-sh/bun/main/examples/hashing.js"</span>,
    ),
  });
  
  <span class="hljs-keyword">const</span> text = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(stdout).<span class="hljs-title function_">text</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(text); <span class="hljs-comment">// "const input = "hello world".repeat(400); ..."</span>
  </code></pre>
          <p>
            Bun.spawn spawns processes 60% faster than Node.js'
            <code>child_process</code>.
          </p>
          <pre><code class="hljs language-zig">❯ bun spawn.mjs
  cpu: Apple M1 Max
  runtime: bun 0.2.0 (arm64-darwin)
  
  benchmark              time (avg)             (min … max)       p75       p99      p995
  --------------------------------------------------------- -----------------------------
  spawnSync echo hi  888.14 µs/iter    (821.83 µs … 1.2 ms) 905.92 µs      1 ms   1.03 ms
  
  ❯ node spawn.node.mjs
  cpu: Apple M1 Max
  runtime: node v18.9.1 (arm64-darwin)
  
  benchmark              time (avg)             (min … max)       p75       p99      p995
  --------------------------------------------------------- -----------------------------
  spawnSync echo hi    1.47 ms/iter     (1.14 ms … 2.64 ms)   1.57 ms   2.37 ms   2.52 ms
  </code></pre>
          <p>Synchronous example:</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { spawnSync } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun"</span>;
  
  <span class="hljs-keyword">const</span> { stdout } = <span class="hljs-title function_">spawnSync</span>([<span class="hljs-string">"echo"</span>, <span class="hljs-string">"hi"</span>]);
  
  <span class="hljs-comment">// When using spawnSync, stdout is a Buffer</span>
  <span class="hljs-comment">// this lets you read from it synchronously</span>
  <span class="hljs-keyword">const</span> text = stdout.<span class="hljs-title function_">toString</span>();
  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(text); <span class="hljs-comment">// "hi\n"</span>
  </code></pre>
          <p>
            You can pass an object as the second argument to customize the
            process:
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { spawn } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun"</span>;
  
  <span class="hljs-keyword">const</span> { stdout } = <span class="hljs-title function_">spawn</span>([<span class="hljs-string">"printenv"</span>, <span class="hljs-string">"FOO"</span>], {
    <span class="hljs-attr">cwd</span>: <span class="hljs-string">"/tmp"</span>,
  
    <span class="hljs-attr">env</span>: {
      ...process.<span class="hljs-property">env</span>,
      <span class="hljs-attr">FOO</span>: <span class="hljs-string">"bar"</span>,
    },
  
    <span class="hljs-comment">// Disable stdin</span>
    <span class="hljs-attr">stdin</span>: <span class="hljs-literal">null</span>,
  
    <span class="hljs-comment">// Allow us to read from stdout</span>
    <span class="hljs-attr">stdout</span>: <span class="hljs-string">"pipe"</span>,
  
    <span class="hljs-comment">// Point stderr to write to "/tmp/stderr.log"</span>
    <span class="hljs-attr">stderr</span>: <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">file</span>(<span class="hljs-string">"/tmp/stderr.log"</span>),
  });
  
  <span class="hljs-keyword">const</span> text = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(stdout).<span class="hljs-title function_">text</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(text); <span class="hljs-comment">// "bar\n"</span>
  </code></pre>
          <p>
            You can also pass a <code>Bun.file</code> for <code>stdin</code>:
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { spawn, file, write } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun"</span>;
  
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">write</span>(<span class="hljs-string">"/tmp/foo.txt"</span>, <span class="hljs-string">"hi"</span>);
  <span class="hljs-keyword">const</span> { stdout } = <span class="hljs-title function_">spawn</span>([<span class="hljs-string">"cat"</span>], {
    <span class="hljs-comment">// Set /tmp/foo.txt as stdin</span>
    <span class="hljs-attr">stdin</span>: <span class="hljs-title function_">file</span>(<span class="hljs-string">"/tmp/foo.txt"</span>),
  });
  
  <span class="hljs-keyword">const</span> text = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(stdout).<span class="hljs-title function_">text</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(text); <span class="hljs-comment">// "hi\n"</span>
  </code></pre>
          <p><code>stdin</code> also accepts a TypedArray:</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { spawn } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun"</span>;
  
  <span class="hljs-keyword">const</span> { stdout } = <span class="hljs-title function_">spawn</span>([<span class="hljs-string">"cat"</span>], {
    <span class="hljs-attr">stdin</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextEncoder</span>().<span class="hljs-title function_">encode</span>(<span class="hljs-string">"hi"</span>),
    <span class="hljs-attr">stdout</span>: <span class="hljs-string">"pipe"</span>,
  });
  
  <span class="hljs-keyword">const</span> text = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(stdout).<span class="hljs-title function_">text</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(text); <span class="hljs-comment">// "hi\n"</span>
  </code></pre>
          <p>
            <code>Bun.spawn</code> also supports incrementally writing to stdin:
          </p>
          <blockquote>
            <p>⚠️ <strong>This API is a little buggy right now</strong></p>
          </blockquote>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { spawn } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun"</span>;
  
  <span class="hljs-keyword">const</span> { stdin, stdout } = <span class="hljs-title function_">spawn</span>([<span class="hljs-string">"cat"</span>], {
    <span class="hljs-attr">stdin</span>: <span class="hljs-string">"pipe"</span>,
    <span class="hljs-attr">stdout</span>: <span class="hljs-string">"pipe"</span>,
  });
  
  <span class="hljs-comment">// You can pass it strings or TypedArrays</span>
  <span class="hljs-comment">// Write "hi" to stdin</span>
  stdin.<span class="hljs-title function_">write</span>(<span class="hljs-string">"hi"</span>);
  
  <span class="hljs-comment">// By default, stdin is buffered so you need to call flush() to send it</span>
  stdin.<span class="hljs-title function_">flush</span>(<span class="hljs-literal">true</span>);
  
  <span class="hljs-comment">// When you're done, call end()</span>
  stdin.<span class="hljs-title function_">end</span>();
  
  <span class="hljs-keyword">const</span> text = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(stdout).<span class="hljs-title function_">text</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(text); <span class="hljs-comment">// "hi\n"</span>
  </code></pre>
          <p>
            Under the hood, <code>Bun.spawn</code> and
            <code>Bun.spawnSync</code> use
            <a href="https://man7.org/linux/man-pages/man3/posix_spawn.3.html"
              ><code>posix_spawn(3)</code></a
            >.
          </p>
          <p><strong>stdin</strong></p>
          <p><code>stdin</code> can be one of:</p>
          <ul>
            <li><code>Bun.file()</code></li>
            <li><code>null</code> (no stdin)</li>
            <li><code>ArrayBufferView</code></li>
            <li>
              <code>Response</code>, <code>Request</code> with a buffered body
              or from <code>fetch()</code>. <code>ReadableStream</code> is not
              supported yet (TODO)
            </li>
            <li><code>number</code> (file descriptor)</li>
            <li>
              <code>"pipe"</code> (default), which returns a
              <code>FileSink</code> for fast incremental writing
            </li>
            <li>
              <code>"inherit"</code> which will inherit the parent's stdin
            </li>
          </ul>
          <p><strong>stdout</strong> and <strong>stderr</strong></p>
          <p><code>stdout</code> and <code>stderr</code> can be one of:</p>
          <ul>
            <li><code>Bun.file()</code></li>
            <li><code>null</code> (disable)</li>
            <li><code>number</code> (file descriptor)</li>
            <li>
              <code>"pipe"</code> (default for <code>stdout</code>), returns a
              <code>ReadableStream</code>
            </li>
            <li>
              <code>"inherit"</code> (default for <code>stderr</code>) which
              will inherit the parent's stdout/stderr
            </li>
          </ul>
          <p>
            <strong
              >When to use <code>Bun.spawn</code> vs
              <code>Bun.spawnSync</code></strong
            >
          </p>
          <p>
            There are three main differences between <code>Bun.spawn</code> and
            <code>Bun.spawnSync</code>.
          </p>
          <ol>
            <li>
              <p>
                <code>Bun.spawnSync</code> blocks the event loop until the
                subprocess exits. For HTTP servers, you probably should avoid
                using <code>Bun.spawnSync</code> but for CLI apps, you probably
                should use <code>Bun.spawnSync</code>.
              </p>
            </li>
            <li>
              <p>
                <code>spawnSync</code> returns a different object for
                <code>stdout</code> and <code>stderr</code> so you can read the
                data synchronously.
              </p>
            </li>
          </ol>
          <table>
            <thead>
              <tr>
                <th><code>spawn</code></th>
                <th><code>spawnSync</code></th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>ReadableStream</code></td>
                <td><code>Buffer</code></td>
              </tr>
            </tbody>
          </table>
          <ol>
            <li>
              <code>Bun.spawn</code> supports incrementally writing to
              <code>stdin</code>.
            </li>
          </ol>
          <p>
            If you need to read from <code>stdout</code> or
            <code>stderr</code> synchronously, you should use
            <code>Bun.spawnSync</code>. Otherwise, <code>Bun.spawn</code> is
            preferred.
          </p>
          <p><strong>More details</strong></p>
          <p>
            <code>Bun.spawn</code> returns a <code>Subprocess</code> object.
          </p>
          <p>
            More complete types are available in
            <a href="https://github.com/oven-sh/bun-types"
              ><code>bun-types</code></a
            >.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Subprocess</span> {
    <span class="hljs-keyword">readonly</span> <span class="hljs-attr">pid</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-keyword">readonly</span> <span class="hljs-attr">stdin</span>: <span class="hljs-title class_">FileSink</span> | <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">readonly</span> <span class="hljs-attr">stdout</span>: <span class="hljs-title class_">ReadableStream</span> | <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">readonly</span> <span class="hljs-attr">stderr</span>: <span class="hljs-title class_">ReadableStream</span> | <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span>;
  
    <span class="hljs-keyword">readonly</span> <span class="hljs-attr">exitCode</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span>;
  
    <span class="hljs-comment">// Wait for the process to exit</span>
    <span class="hljs-keyword">readonly</span> <span class="hljs-attr">exited</span>: <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">number</span>&gt;;
  
    <span class="hljs-comment">// Keep Bun's process alive until the subprocess exits</span>
    <span class="hljs-title function_">ref</span>(): <span class="hljs-built_in">void</span>;
  
    <span class="hljs-comment">// Don't keep Bun's process alive until the subprocess exits</span>
    <span class="hljs-title function_">unref</span>(): <span class="hljs-built_in">void</span>;
  
    <span class="hljs-comment">// Kill the process</span>
    <span class="hljs-title function_">kill</span>(code?: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span>;
    <span class="hljs-keyword">readonly</span> <span class="hljs-attr">killed</span>: <span class="hljs-built_in">boolean</span>;
  }
  </code></pre>
          <h2 id="bunwhich--find-the-path-to-a-binary">
            <code>Bun.which</code> – find the path to a binary
          </h2>
          <p>
            Find the path to an executable, similar to typing
            <code>which</code> in your terminal.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">const</span> ls = <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">which</span>(<span class="hljs-string">"ls"</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ls); <span class="hljs-comment">// "/usr/bin/ls"</span>
  </code></pre>
          <p>
            <code>Bun.which</code> defaults the <code>PATH</code> to the current
            <code>PATH</code> environment variable, but you can customize it
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">const</span> ls = <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">which</span>(<span class="hljs-string">"ls"</span>, {
    <span class="hljs-attr">PATH</span>: <span class="hljs-string">"/usr/local/bin:/usr/bin:/bin"</span>,
  });
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ls); <span class="hljs-comment">// "/usr/bin/ls"</span>
  </code></pre>
          <p>
            <code>Bun.which</code> also accepts a <code>cwd</code> option to
            search for the binary in a specific directory.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">const</span> ls = <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">which</span>(<span class="hljs-string">"ls"</span>, {
    <span class="hljs-attr">cwd</span>: <span class="hljs-string">"/tmp"</span>,
    <span class="hljs-attr">PATH</span>: <span class="hljs-string">""</span>,
  });
  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ls); <span class="hljs-comment">// null</span>
  </code></pre>
          <h2 id="bunlisten--bunconnect---tcptls-sockets">
            <code>Bun.listen</code> &amp; <code>Bun.connect</code> - TCP/TLS
            sockets
          </h2>
          <p>
            <code>Bun.listen</code> and <code>Bun.connect</code> is bun's native
            TCP &amp; TLS socket API. Use it to implement database clients, game
            servers – anything that needs to communicate over TCP (instead of
            HTTP). This is a low-level API intended for library authors and for
            advanced use cases.
          </p>
          <p>Start a TCP server with <code>Bun.listen</code>:</p>
          <pre><code class="hljs language-ts"><span class="hljs-comment">// The server</span>
  <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">listen</span>({
    <span class="hljs-attr">hostname</span>: <span class="hljs-string">"localhost"</span>,
    <span class="hljs-attr">port</span>: <span class="hljs-number">8080</span>,
    <span class="hljs-attr">socket</span>: {
      <span class="hljs-title function_">open</span>(<span class="hljs-params">socket</span>) {
        socket.<span class="hljs-title function_">write</span>(<span class="hljs-string">"hello world"</span>);
      },
      <span class="hljs-title function_">data</span>(<span class="hljs-params">socket, data</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Uint8Array</span>); <span class="hljs-comment">// true</span>
      },
      <span class="hljs-title function_">drain</span>(<span class="hljs-params">socket</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"gimme more data"</span>);
      },
      <span class="hljs-title function_">close</span>(<span class="hljs-params">socket</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"goodbye!"</span>);
      },
    },
    <span class="hljs-comment">// This is a TLS socket</span>
    <span class="hljs-comment">// certFile: "/path/to/cert.pem",</span>
    <span class="hljs-comment">// keyFile: "/path/to/key.pem",</span>
  });
  </code></pre>
          <p><code>Bun.connect</code> lets you create a TCP client:</p>
          <pre><code class="hljs language-ts"><span class="hljs-comment">// The client</span>
  <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">connect</span>({
    <span class="hljs-attr">hostname</span>: <span class="hljs-string">"localhost"</span>,
    <span class="hljs-attr">port</span>: <span class="hljs-number">8080</span>,
  
    <span class="hljs-attr">socket</span>: {
      <span class="hljs-title function_">open</span>(<span class="hljs-params">socket</span>) {
        socket.<span class="hljs-title function_">write</span>(<span class="hljs-string">"hello server, i'm the client!"</span>);
      },
      <span class="hljs-title function_">data</span>(<span class="hljs-params">socket, message</span>) {
        socket.<span class="hljs-title function_">write</span>(<span class="hljs-string">"thanks for the message! Sincerely, "</span> + socket.<span class="hljs-property">data</span>.<span class="hljs-property">name</span>);
      },
      <span class="hljs-title function_">drain</span>(<span class="hljs-params">socket</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"my socket is ready for more data"</span>);
      },
      <span class="hljs-title function_">close</span>(<span class="hljs-params">socket</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">""</span>);
      },
      <span class="hljs-title function_">timeout</span>(<span class="hljs-params">socket</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"socket timed out"</span>);
      },
    },
  
    <span class="hljs-attr">data</span>: {
      <span class="hljs-attr">name</span>: <span class="hljs-string">"Clienty McClientface"</span>,
    },
  });
  </code></pre>
          <h4 id="benchmark-driven-api-design">Benchmark-driven API design</h4>
          <p>Bun's TCP socket API is designed to go fast.</p>
          <p>
            Instead of using promises or assigning callbacks per socket instance
            (like Node.js' <code>EventEmitter</code> or the web-standard
            <code>WebSocket</code> API), assign all callbacks one time
          </p>
          <p>
            This design decision was made after benchmarking. For
            performance-sensitive servers, promise-heavy APIs or assigning
            callbacks per socket instance can cause significant garbage
            collector pressure and increase memory usage. If you're using a TCP
            server API, you probably care more about performance.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">listen</span>({
    <span class="hljs-attr">socket</span>: {
      <span class="hljs-title function_">open</span>(<span class="hljs-params">socket</span>) {},
      <span class="hljs-title function_">data</span>(<span class="hljs-params">socket, data</span>) {},
      <span class="hljs-title function_">drain</span>(<span class="hljs-params">socket</span>) {},
      <span class="hljs-title function_">close</span>(<span class="hljs-params">socket</span>) {},
      <span class="hljs-title function_">error</span>(<span class="hljs-params">socket, error</span>) {},
    },
    <span class="hljs-attr">hostname</span>: <span class="hljs-string">"localhost"</span>,
    <span class="hljs-attr">port</span>: <span class="hljs-number">8080</span>,
  });
  </code></pre>
          <p>
            Instead of having to allocate unique functions for each instance of
            a socket, we can use each callback once for all sockets. This is a
            small optimization, but it adds up.
          </p>
          <p>How do you pass per-socket data to each socket object?</p>
          <p>
            <code>**data**</code> is a property on the
            <code>TCPSocket</code> &amp; <code>TLSSocket</code> object that you
            can use to store per-socket data.
          </p>
          <pre><code class="hljs language-ts">socket.<span class="hljs-property">data</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">"Clienty McClientface"</span> };
  </code></pre>
          <p>
            You can assign a default value to <code>data</code> in the
            <code>connect</code> or <code>listen</code> options.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">listen</span>({
    <span class="hljs-attr">socket</span>: {
      <span class="hljs-title function_">open</span>(<span class="hljs-params">socket</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(socket.<span class="hljs-property">data</span>); <span class="hljs-comment">// { name: "Servery McServerface" }</span>
      },
    },
    <span class="hljs-attr">data</span>: {
      <span class="hljs-attr">name</span>: <span class="hljs-string">"Servery McServerface"</span>,
    },
  });
  </code></pre>
          <h4 id="hot-reloading-tcp-servers--clients">
            Hot-reloading TCP servers &amp; clients
          </h4>
          <p>
            <code>TCPSocket</code> (returned by <code>Bun.connect</code> and
            passed through callbacks in <code>Bun.listen</code>) has a
            <code>reload</code> method that lets you reload the callbacks for
            all related sockets (either just the one for
            <code>Bun.connect</code> or all sockets for
            <code>Bun.listen</code>):
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">const</span> socket = <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">connect</span>({
    <span class="hljs-attr">hostname</span>: <span class="hljs-string">"localhost"</span>,
    <span class="hljs-attr">port</span>: <span class="hljs-number">8080</span>,
    <span class="hljs-attr">socket</span>: {
      <span class="hljs-title function_">data</span>(<span class="hljs-params">socket, msg</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"wow i got a message!"</span>);
  
        <span class="hljs-comment">// this will be called the next time the server sends a message</span>
        socket.<span class="hljs-title function_">reload</span>({
          <span class="hljs-title function_">data</span>(<span class="hljs-params">socket</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"okay, not so surprising this time"</span>);
          },
        });
      },
    },
  });
  </code></pre>
          <h4 id="no-buffering">No buffering</h4>
          <p>
            Currently, <code>TCPSocket</code> &amp; <code>TLSSocket</code> in
            Bun do not buffer data. Adding support for corking (similar to
            <code>ServerWebSocket</code>) is planned, but it means you will need
            to handle backpressure yourself using the
            <code>drain</code> callback.
          </p>
          <p>
            Your TCP client/server will have abysmal performance if you don't
            consider buffering carefully.
          </p>
          <p>For example, this:</p>
          <pre><code class="hljs language-ts">socket.<span class="hljs-title function_">write</span>(<span class="hljs-string">"h"</span>);
  socket.<span class="hljs-title function_">write</span>(<span class="hljs-string">"e"</span>);
  socket.<span class="hljs-title function_">write</span>(<span class="hljs-string">"l"</span>);
  socket.<span class="hljs-title function_">write</span>(<span class="hljs-string">"l"</span>);
  socket.<span class="hljs-title function_">write</span>(<span class="hljs-string">"o"</span>);
  </code></pre>
          <p>Performs significantly worse than:</p>
          <pre><code class="hljs language-ts">socket.<span class="hljs-title function_">write</span>(<span class="hljs-string">"hello"</span>);
  </code></pre>
          <p>
            To simplify this for now, consider using
            <code>ArrayBufferSink</code> with the
            <code>{stream: true}</code> option:
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">const</span> sink = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBufferSink</span>({ <span class="hljs-attr">stream</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">highWaterMark</span>: <span class="hljs-number">1024</span> });
  
  sink.<span class="hljs-title function_">write</span>(<span class="hljs-string">"h"</span>);
  sink.<span class="hljs-title function_">write</span>(<span class="hljs-string">"e"</span>);
  sink.<span class="hljs-title function_">write</span>(<span class="hljs-string">"l"</span>);
  sink.<span class="hljs-title function_">write</span>(<span class="hljs-string">"l"</span>);
  sink.<span class="hljs-title function_">write</span>(<span class="hljs-string">"o"</span>);
  
  <span class="hljs-title function_">queueMicrotask</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">var</span> data = sink.<span class="hljs-title function_">flush</span>();
    <span class="hljs-keyword">if</span> (!socket.<span class="hljs-title function_">write</span>(data)) {
      <span class="hljs-comment">// put it back in the sink if the socket is full</span>
      sink.<span class="hljs-title function_">write</span>(data);
    }
  });
  </code></pre>
          <p>Builtin buffering is planned in a future version of Bun.</p>
          <h2 id="bunpeek---read-a-promise-without-resolving-it">
            <code>Bun.peek</code> - read a promise without resolving it
          </h2>
          <p>
            <code>Bun.peek</code> is a utility function that lets you read a
            promise's result without <code>await</code> or <code>.then</code>,
            but only if the promise has already fulfilled or rejected.
          </p>
          <p>This function was added in Bun v0.2.2.</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { peek } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun"</span>;
  
  <span class="hljs-keyword">const</span> promise = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">"hi"</span>);
  
  <span class="hljs-comment">// no await!</span>
  <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">peek</span>(promise);
  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result); <span class="hljs-comment">// "hi"</span>
  </code></pre>
          <p>
            <code>Bun.peek</code> is useful for performance-sensitive code that
            wants to reduce the number of extra microticks. It's an advanced API
            and you probably shouldn't use it unless you know what you're doing.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { peek } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun"</span>;
  <span class="hljs-keyword">import</span> { expect, test } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:test"</span>;
  
  <span class="hljs-title function_">test</span>(<span class="hljs-string">"peek"</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> promise = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-literal">true</span>);
  
    <span class="hljs-comment">// no await necessary!</span>
    <span class="hljs-title function_">expect</span>(<span class="hljs-title function_">peek</span>(promise)).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);
  
    <span class="hljs-comment">// if we peek again, it returns the same value</span>
    <span class="hljs-keyword">const</span> again = <span class="hljs-title function_">peek</span>(promise);
    <span class="hljs-title function_">expect</span>(again).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>);
  
    <span class="hljs-comment">// if we peek a non-promise, it returns the value</span>
    <span class="hljs-keyword">const</span> value = <span class="hljs-title function_">peek</span>(<span class="hljs-number">42</span>);
    <span class="hljs-title function_">expect</span>(value).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">42</span>);
  
    <span class="hljs-comment">// if we peek a pending promise, it returns the promise again</span>
    <span class="hljs-keyword">const</span> pending = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">() =&gt;</span> {});
    <span class="hljs-title function_">expect</span>(<span class="hljs-title function_">peek</span>(pending)).<span class="hljs-title function_">toBe</span>(pending);
  
    <span class="hljs-comment">// If we peek a rejected promise, it:</span>
    <span class="hljs-comment">// - returns the error</span>
    <span class="hljs-comment">// - does not mark the promise as handled</span>
    <span class="hljs-keyword">const</span> rejected = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Successfully tested promise rejection"</span>),
    );
    <span class="hljs-title function_">expect</span>(<span class="hljs-title function_">peek</span>(rejected).<span class="hljs-property">message</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">"Successfully tested promise rejection"</span>);
  });
  </code></pre>
          <p>
            <code>peek.status</code> lets you read the status of a promise
            without resolving it.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { peek } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun"</span>;
  <span class="hljs-keyword">import</span> { expect, test } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:test"</span>;
  
  <span class="hljs-title function_">test</span>(<span class="hljs-string">"peek.status"</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> promise = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-literal">true</span>);
    <span class="hljs-title function_">expect</span>(peek.<span class="hljs-title function_">status</span>(promise)).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">"fulfilled"</span>);
  
    <span class="hljs-keyword">const</span> pending = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">() =&gt;</span> {});
    <span class="hljs-title function_">expect</span>(peek.<span class="hljs-title function_">status</span>(pending)).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">"pending"</span>);
  
    <span class="hljs-keyword">const</span> rejected = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"oh nooo"</span>));
    <span class="hljs-title function_">expect</span>(peek.<span class="hljs-title function_">status</span>(rejected)).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">"rejected"</span>);
  });
  </code></pre>
          <h2 id="bunwrite--optimizing-io">
            <code>Bun.write</code> – optimizing I/O
          </h2>
          <p>
            <code>Bun.write</code> lets you write, copy or pipe files
            automatically using the fastest system calls compatible with the
            input and platform.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Bun</span> {
    <span class="hljs-title function_">write</span>(
      <span class="hljs-attr">destination</span>: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> | <span class="hljs-title class_">FileBlob</span>,
      <span class="hljs-attr">input</span>: <span class="hljs-built_in">string</span> | <span class="hljs-title class_">FileBlob</span> | <span class="hljs-title class_">Blob</span> | <span class="hljs-title class_">ArrayBufferView</span>,
    ): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">number</span>&gt;;
  }
  </code></pre>
          <table>
            <thead>
              <tr>
                <th>Output</th>
                <th>Input</th>
                <th>System Call</th>
                <th>Platform</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>file</td>
                <td>file</td>
                <td>copy_file_range</td>
                <td>Linux</td>
              </tr>
              <tr>
                <td>file</td>
                <td>pipe</td>
                <td>sendfile</td>
                <td>Linux</td>
              </tr>
              <tr>
                <td>pipe</td>
                <td>pipe</td>
                <td>splice</td>
                <td>Linux</td>
              </tr>
              <tr>
                <td>terminal</td>
                <td>file</td>
                <td>sendfile</td>
                <td>Linux</td>
              </tr>
              <tr>
                <td>terminal</td>
                <td>terminal</td>
                <td>sendfile</td>
                <td>Linux</td>
              </tr>
              <tr>
                <td>socket</td>
                <td>file or pipe</td>
                <td>sendfile (if http, not https)</td>
                <td>Linux</td>
              </tr>
              <tr>
                <td>file (path, doesn't exist)</td>
                <td>file (path)</td>
                <td>clonefile</td>
                <td>macOS</td>
              </tr>
              <tr>
                <td>file</td>
                <td>file</td>
                <td>fcopyfile</td>
                <td>macOS</td>
              </tr>
              <tr>
                <td>file</td>
                <td>Blob or string</td>
                <td>write</td>
                <td>macOS</td>
              </tr>
              <tr>
                <td>file</td>
                <td>Blob or string</td>
                <td>write</td>
                <td>Linux</td>
              </tr>
            </tbody>
          </table>
          <p>All this complexity is handled by a single function.</p>
          <pre><code class="hljs language-ts"><span class="hljs-comment">// Write "Hello World" to output.txt</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">"output.txt"</span>, <span class="hljs-string">"Hello World"</span>);
  </code></pre>
          <pre><code class="hljs language-ts"><span class="hljs-comment">// log a file to stdout</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">write</span>(<span class="hljs-title class_">Bun</span>.<span class="hljs-property">stdout</span>, <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">file</span>(<span class="hljs-string">"input.txt"</span>));
  </code></pre>
          <pre><code class="hljs language-ts"><span class="hljs-comment">// write the HTTP response body to disk</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">"index.html"</span>, <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"http://example.com"</span>));
  <span class="hljs-comment">// this does the same thing</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">write</span>(<span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">file</span>(<span class="hljs-string">"index.html"</span>), <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"http://example.com"</span>));
  </code></pre>
          <pre><code class="hljs language-ts"><span class="hljs-comment">// copy input.txt to output.txt</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">"output.txt"</span>, <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">file</span>(<span class="hljs-string">"input.txt"</span>));
  </code></pre>
          <h2 id="bunsqlite-sqlite3-module">bun:sqlite (SQLite3 module)</h2>
          <p>
            <code>bun:sqlite</code> is a high-performance built-in
            <a href="https://www.sqlite.org/">SQLite3</a> module for bun.js.
          </p>
          <ul>
            <li>Simple, synchronous API (synchronous <em>is</em> faster)</li>
            <li>Transactions</li>
            <li>Binding named &amp; positional parameters</li>
            <li>Prepared statements</li>
            <li>
              Automatic type conversions (<code>BLOB</code> becomes
              <code>Uint8Array</code>)
            </li>
            <li>toString() prints as SQL</li>
          </ul>
          <p>Installation:</p>
          <pre><code class="hljs language-sh"><span class="hljs-comment"># there's nothing to install</span>
  <span class="hljs-comment"># bun:sqlite is built-in to bun.js</span>
  </code></pre>
          <p>Example:</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Database</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:sqlite"</span>;
  
  <span class="hljs-keyword">const</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>(<span class="hljs-string">"mydb.sqlite"</span>);
  db.<span class="hljs-title function_">run</span>(
    <span class="hljs-string">"CREATE TABLE IF NOT EXISTS foo (id INTEGER PRIMARY KEY AUTOINCREMENT, greeting TEXT)"</span>,
  );
  db.<span class="hljs-title function_">run</span>(<span class="hljs-string">"INSERT INTO foo (greeting) VALUES (?)"</span>, <span class="hljs-string">"Welcome to bun!"</span>);
  db.<span class="hljs-title function_">run</span>(<span class="hljs-string">"INSERT INTO foo (greeting) VALUES (?)"</span>, <span class="hljs-string">"Hello World!"</span>);
  
  <span class="hljs-comment">// get the first row</span>
  db.<span class="hljs-title function_">query</span>(<span class="hljs-string">"SELECT * FROM foo"</span>).<span class="hljs-title function_">get</span>();
  <span class="hljs-comment">// { id: 1, greeting: "Welcome to bun!" }</span>
  
  <span class="hljs-comment">// get all rows</span>
  db.<span class="hljs-title function_">query</span>(<span class="hljs-string">"SELECT * FROM foo"</span>).<span class="hljs-title function_">all</span>();
  <span class="hljs-comment">// [</span>
  <span class="hljs-comment">//   { id: 1, greeting: "Welcome to bun!" },</span>
  <span class="hljs-comment">//   { id: 2, greeting: "Hello World!" },</span>
  <span class="hljs-comment">// ]</span>
  
  <span class="hljs-comment">// get all rows matching a condition</span>
  db.<span class="hljs-title function_">query</span>(<span class="hljs-string">"SELECT * FROM foo WHERE greeting = ?"</span>).<span class="hljs-title function_">all</span>(<span class="hljs-string">"Welcome to bun!"</span>);
  <span class="hljs-comment">// [</span>
  <span class="hljs-comment">//   { id: 1, greeting: "Welcome to bun!" },</span>
  <span class="hljs-comment">// ]</span>
  
  <span class="hljs-comment">// get first row matching a named condition</span>
  db.<span class="hljs-title function_">query</span>(<span class="hljs-string">"SELECT * FROM foo WHERE greeting = $greeting"</span>).<span class="hljs-title function_">get</span>({
    <span class="hljs-attr">$greeting</span>: <span class="hljs-string">"Welcome to bun!"</span>,
  });
  <span class="hljs-comment">// [</span>
  <span class="hljs-comment">//   { id: 1, greeting: "Welcome to bun!" },</span>
  <span class="hljs-comment">// ]</span>
  </code></pre>
          <h3 id="bunsqlite-benchmark">bun:sqlite Benchmark</h3>
          <p>
            Database:
            <a
              href="https://github.com/jpwhite3/northwind-SQLite3/blob/46d5f8a64f396f87cd374d1600dbf521523980e8/Northwind_large.sqlite.zip"
              >Northwind Traders</a
            >.
          </p>
          <p>
            This benchmark can be run from
            <a href="./bench/sqlite">./bench/sqlite</a>.
          </p>
          <p>Here are results from an M1 Pro (64GB) on macOS 12.3.1.</p>
          <p><strong>SELECT * FROM "Order"</strong></p>
          <table>
            <thead>
              <tr>
                <th>Library</th>
                <th>Runtime</th>
                <th>ms/iter</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>bun:sqlite3</td>
                <td>Bun 0.0.83</td>
                <td>14.31 (1x)</td>
              </tr>
              <tr>
                <td>better-sqlite3</td>
                <td>Node 18.0.0</td>
                <td>40.81 (2.8x slower)</td>
              </tr>
              <tr>
                <td>deno.land/x/sqlite</td>
                <td>Deno 1.21.2</td>
                <td>125.96 (8.9x slower)</td>
              </tr>
            </tbody>
          </table>
          <p><strong>SELECT * FROM "Product"</strong></p>
          <table>
            <thead>
              <tr>
                <th>Library</th>
                <th>Runtime</th>
                <th>us/iter</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>bun:sqlite3</td>
                <td>Bun 0.0.83</td>
                <td>33.85 (1x)</td>
              </tr>
              <tr>
                <td>better-sqlite3</td>
                <td>Node 18.0.0</td>
                <td>121.09 (3.5x slower)</td>
              </tr>
              <tr>
                <td>deno.land/x/sqlite</td>
                <td>Deno 1.21.2</td>
                <td>187.64 (8.9x slower)</td>
              </tr>
            </tbody>
          </table>
          <p><strong>SELECT * FROM "OrderDetail"</strong></p>
          <table>
            <thead>
              <tr>
                <th>Library</th>
                <th>Runtime</th>
                <th>ms/iter</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>bun:sqlite3</td>
                <td>Bun 0.0.83</td>
                <td>146.92 (1x)</td>
              </tr>
              <tr>
                <td>better-sqlite3</td>
                <td>Node 18.0.0</td>
                <td>875.73 (5.9x slower)</td>
              </tr>
              <tr>
                <td>deno.land/x/sqlite</td>
                <td>Deno 1.21.2</td>
                <td>541.15 (3.6x slower)</td>
              </tr>
            </tbody>
          </table>
          <p>In screenshot form (which has a different sorting order)</p>
          <img
            width="738"
            alt="image"
            src="https://user-images.githubusercontent.com/709451/168459263-8cd51ca3-a924-41e9-908d-cf3478a3b7f3.png"
          />

          <h3 id="getting-started-with-bunsqlite">
            Getting started with bun:sqlite
          </h3>
          <p>
            bun:sqlite's API is loosely based on
            <a href="https://github.com/JoshuaWise/better-sqlite3"
              >better-sqlite3</a
            >, though the implementation is different.
          </p>
          <p>bun:sqlite has two classes:</p>
          <ul>
            <li><code>class Database</code></li>
            <li><code>class Statement</code></li>
          </ul>
          <h4 id="database"><code>Database</code></h4>
          <p>
            Calling <code>new Database(filename)</code> opens or creates the
            SQLite database.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-title function_">constructor</span>(<span class="hljs-params">
        filename: <span class="hljs-built_in">string</span>,
        options?:
          | <span class="hljs-built_in">number</span>
          | {
              /**
               * Open the database <span class="hljs-keyword">as</span> read-only (no write operations, no create).
               *
               * Equivalent to {@link constants.SQLITE_OPEN_READONLY}
               */
              <span class="hljs-keyword">readonly</span>?: <span class="hljs-built_in">boolean</span>;
              /**
               * Allow creating a <span class="hljs-keyword">new</span> database
               *
               * Equivalent to {@link constants.SQLITE_OPEN_CREATE}
               */
              create?: <span class="hljs-built_in">boolean</span>;
              /**
               * Open the database <span class="hljs-keyword">as</span> read-write
               *
               * Equivalent to {@link constants.SQLITE_OPEN_READWRITE}
               */
              readwrite?: <span class="hljs-built_in">boolean</span>;
            }
      </span>);
  </code></pre>
          <p>To open or create a SQLite3 database:</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Database</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:sqlite"</span>;
  
  <span class="hljs-keyword">const</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>(<span class="hljs-string">"mydb.sqlite"</span>);
  </code></pre>
          <p>Open an in-memory database:</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Database</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:sqlite"</span>;
  
  <span class="hljs-comment">// all of these do the same thing</span>
  <span class="hljs-keyword">let</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>(<span class="hljs-string">":memory:"</span>);
  <span class="hljs-keyword">let</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>();
  <span class="hljs-keyword">let</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>(<span class="hljs-string">""</span>);
  </code></pre>
          <p>Open read-write and throw if the database doesn't exist:</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Database</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:sqlite"</span>;
  <span class="hljs-keyword">const</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>(<span class="hljs-string">"mydb.sqlite"</span>, { <span class="hljs-attr">readwrite</span>: <span class="hljs-literal">true</span> });
  </code></pre>
          <p>Open read-only and throw if the database doesn't exist:</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Database</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:sqlite"</span>;
  <span class="hljs-keyword">const</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>(<span class="hljs-string">"mydb.sqlite"</span>, { <span class="hljs-attr">readonly</span>: <span class="hljs-literal">true</span> });
  </code></pre>
          <p>Open read-write, don't throw if new file:</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Database</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:sqlite"</span>;
  <span class="hljs-keyword">const</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>(<span class="hljs-string">"mydb.sqlite"</span>, { <span class="hljs-attr">readonly</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">create</span>: <span class="hljs-literal">true</span> });
  </code></pre>
          <p>Open a database from a <code>Uint8Array</code>:</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Database</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:sqlite"</span>;
  <span class="hljs-keyword">import</span> { readFileSync } <span class="hljs-keyword">from</span> <span class="hljs-string">"fs"</span>;
  
  <span class="hljs-comment">// unlike passing a filepath, this will not persist any changes to disk</span>
  <span class="hljs-comment">// it will be read-write but not persistent</span>
  <span class="hljs-keyword">const</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>(<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">"mydb.sqlite"</span>));
  </code></pre>
          <p>Close a database:</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">let</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>();
  db.<span class="hljs-title function_">close</span>();
  </code></pre>
          <p>
            Note: <code>close()</code> is called automatically when the database
            is garbage collected. It is safe to call multiple times but has no
            effect after the first.
          </p>
          <h4 id="databaseprototypequery">Database.prototype.query</h4>
          <p>
            <code>query(sql)</code> creates a <code>Statement</code> for the
            given SQL and caches it, but does not execute it.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Database</span> {
    <span class="hljs-title function_">query</span>(<span class="hljs-attr">sql</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Statement</span>;
  }
  </code></pre>
          <p><code>query</code> returns a <code>Statement</code> object.</p>
          <p>
            It performs the same operation as
            <code>Database.prototype.prepare</code>, except:
          </p>
          <ul>
            <li>
              <code>query</code> caches the prepared statement in the
              <code>Database</code> object
            </li>
            <li><code>query</code> doesn't bind parameters</li>
          </ul>
          <p>
            This intended to make it easier for <code>bun:sqlite</code> to be
            fast by default. Calling <code>.prepare</code> compiles a SQLite
            query, which can take some time, so it's better to cache those a
            little.
          </p>
          <p>You can bind parameters on any call to a statement.</p>
          <pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Database</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:sqlite"</span>;
  
  <span class="hljs-comment">// generate some data</span>
  <span class="hljs-keyword">let</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>();
  db.<span class="hljs-title function_">run</span>(
    <span class="hljs-string">"CREATE TABLE foo (id INTEGER PRIMARY KEY AUTOINCREMENT, greeting TEXT)"</span>,
  );
  db.<span class="hljs-title function_">run</span>(<span class="hljs-string">"INSERT INTO foo (greeting) VALUES ($greeting)"</span>, {
    <span class="hljs-attr">$greeting</span>: <span class="hljs-string">"Welcome to bun"</span>,
  });
  
  <span class="hljs-comment">// get the query</span>
  <span class="hljs-keyword">const</span> stmt = db.<span class="hljs-title function_">query</span>(<span class="hljs-string">"SELECT * FROM foo WHERE greeting = ?"</span>);
  
  <span class="hljs-comment">// run the query</span>
  stmt.<span class="hljs-title function_">all</span>(<span class="hljs-string">"Welcome to bun!"</span>);
  stmt.<span class="hljs-title function_">get</span>(<span class="hljs-string">"Welcome to bun!"</span>);
  stmt.<span class="hljs-title function_">run</span>(<span class="hljs-string">"Welcome to bun!"</span>);
  </code></pre>
          <h4 id="databaseprototypeprepare">Database.prototype.prepare</h4>
          <p>
            <code>prepare(sql)</code> creates a <code>Statement</code> for the
            given SQL, but does not execute it.
          </p>
          <p>
            Unlike <code>query()</code>, this does not cache the compiled query.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Database</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:sqlite"</span>;
  
  <span class="hljs-comment">// generate some data</span>
  <span class="hljs-keyword">let</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>();
  db.<span class="hljs-title function_">run</span>(
    <span class="hljs-string">"CREATE TABLE foo (id INTEGER PRIMARY KEY AUTOINCREMENT, greeting TEXT)"</span>,
  );
  
  <span class="hljs-comment">// compile the prepared statement</span>
  <span class="hljs-keyword">const</span> stmt = db.<span class="hljs-title function_">prepare</span>(<span class="hljs-string">"SELECT * FROM foo WHERE bar = ?"</span>);
  
  <span class="hljs-comment">// run the prepared statement</span>
  stmt.<span class="hljs-title function_">all</span>(<span class="hljs-string">"baz"</span>);
  </code></pre>
          <p>
            Internally, this calls
            <a href="https://www.sqlite.org/c3ref/prepare.html"
              ><code>sqlite3_prepare_v3</code></a
            >.
          </p>
          <h4 id="databaseprototypeexec--databaseprototyperun">
            Database.prototype.exec &amp; Database.prototype.run
          </h4>
          <p>
            <code>exec</code> is for one-off executing a query which does not
            need to return anything. <code>run</code> is an alias.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Database</span> {
    <span class="hljs-comment">// exec is an alias for run</span>
    <span class="hljs-title function_">exec</span>(<span class="hljs-attr">sql</span>: <span class="hljs-built_in">string</span>, ...<span class="hljs-attr">params</span>: <span class="hljs-title class_">ParamsType</span>): <span class="hljs-built_in">void</span>;
    <span class="hljs-title function_">run</span>(<span class="hljs-attr">sql</span>: <span class="hljs-built_in">string</span>, ...<span class="hljs-attr">params</span>: <span class="hljs-title class_">ParamsType</span>): <span class="hljs-built_in">void</span>;
  }
  </code></pre>
          <p>This is useful for things like</p>
          <p>Creating a table:</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Database</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:sqlite"</span>;
  
  <span class="hljs-keyword">let</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>();
  db.<span class="hljs-title function_">exec</span>(
    <span class="hljs-string">"CREATE TABLE foo (id INTEGER PRIMARY KEY AUTOINCREMENT, greeting TEXT)"</span>,
  );
  </code></pre>
          <p>Inserting one row:</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Database</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:sqlite"</span>;
  
  <span class="hljs-keyword">let</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>();
  db.<span class="hljs-title function_">exec</span>(
    <span class="hljs-string">"CREATE TABLE foo (id INTEGER PRIMARY KEY AUTOINCREMENT, greeting TEXT)"</span>,
  );
  
  <span class="hljs-comment">// insert one row</span>
  db.<span class="hljs-title function_">exec</span>(<span class="hljs-string">"INSERT INTO foo (greeting) VALUES ($greeting)"</span>, {
    <span class="hljs-attr">$greeting</span>: <span class="hljs-string">"Welcome to bun"</span>,
  });
  </code></pre>
          <p>
            For queries which aren't intended to be run multiple times, it
            should be faster to use <code>exec()</code> than
            <code>prepare()</code> or <code>query()</code> because it doesn't
            create a <code>Statement</code> object.
          </p>
          <p>
            Internally, this function calls
            <a href="https://www.sqlite.org/c3ref/prepare.html"
              ><code>sqlite3_prepare</code></a
            >,
            <a href="https://www.sqlite.org/c3ref/step.html"
              ><code>sqlite3_step</code></a
            >, and
            <a href="https://www.sqlite.org/c3ref/finalize.html"
              ><code>sqlite3_finalize</code></a
            >.
          </p>
          <h4 id="databaseprototypetransaction">
            Database.prototype.transaction
          </h4>
          <p>
            Creates a function that always runs inside a transaction. When the
            function is invoked, it will begin a new transaction. When the
            function returns, the transaction will be committed. If an exception
            is thrown, the transaction will be rolled back (and the exception
            will propagate as usual).
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-comment">// setup</span>
  <span class="hljs-keyword">import</span> { <span class="hljs-title class_">Database</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:sqlite"</span>;
  <span class="hljs-keyword">const</span> db = <span class="hljs-title class_">Database</span>.<span class="hljs-title function_">open</span>(<span class="hljs-string">":memory:"</span>);
  db.<span class="hljs-title function_">exec</span>(
    <span class="hljs-string">"CREATE TABLE cats (id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT UNIQUE, age INTEGER)"</span>,
  );
  
  <span class="hljs-keyword">const</span> insert = db.<span class="hljs-title function_">prepare</span>(<span class="hljs-string">"INSERT INTO cats (name, age) VALUES ($name, $age)"</span>);
  <span class="hljs-keyword">const</span> insertMany = db.<span class="hljs-title function_">transaction</span>(<span class="hljs-function">(<span class="hljs-params">cats</span>) =&gt;</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> cat <span class="hljs-keyword">of</span> cats) insert.<span class="hljs-title function_">run</span>(cat);
  });
  
  <span class="hljs-title function_">insertMany</span>([
    { <span class="hljs-attr">$name</span>: <span class="hljs-string">"Joey"</span>, <span class="hljs-attr">$age</span>: <span class="hljs-number">2</span> },
    { <span class="hljs-attr">$name</span>: <span class="hljs-string">"Sally"</span>, <span class="hljs-attr">$age</span>: <span class="hljs-number">4</span> },
    { <span class="hljs-attr">$name</span>: <span class="hljs-string">"Junior"</span>, <span class="hljs-attr">$age</span>: <span class="hljs-number">1</span> },
  ]);
  </code></pre>
          <p>
            Transaction functions can be called from inside other transaction
            functions. When doing so, the inner transaction becomes a savepoint.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-comment">// setup</span>
  <span class="hljs-keyword">import</span> { <span class="hljs-title class_">Database</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:sqlite"</span>;
  <span class="hljs-keyword">const</span> db = <span class="hljs-title class_">Database</span>.<span class="hljs-title function_">open</span>(<span class="hljs-string">":memory:"</span>);
  db.<span class="hljs-title function_">exec</span>(
    <span class="hljs-string">"CREATE TABLE expenses (id INTEGER PRIMARY KEY AUTOINCREMENT, note TEXT, dollars INTEGER);"</span>,
  );
  db.<span class="hljs-title function_">exec</span>(
    <span class="hljs-string">"CREATE TABLE cats (id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT UNIQUE, age INTEGER)"</span>,
  );
  <span class="hljs-keyword">const</span> newExpense = db.<span class="hljs-title function_">prepare</span>(
    <span class="hljs-string">"INSERT INTO expenses (note, dollars) VALUES (?, ?)"</span>,
  );
  <span class="hljs-keyword">const</span> insert = db.<span class="hljs-title function_">prepare</span>(<span class="hljs-string">"INSERT INTO cats (name, age) VALUES ($name, $age)"</span>);
  <span class="hljs-keyword">const</span> insertMany = db.<span class="hljs-title function_">transaction</span>(<span class="hljs-function">(<span class="hljs-params">cats</span>) =&gt;</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> cat <span class="hljs-keyword">of</span> cats) insert.<span class="hljs-title function_">run</span>(cat);
  });
  
  <span class="hljs-keyword">const</span> adopt = db.<span class="hljs-title function_">transaction</span>(<span class="hljs-function">(<span class="hljs-params">cats</span>) =&gt;</span> {
    newExpense.<span class="hljs-title function_">run</span>(<span class="hljs-string">"adoption fees"</span>, <span class="hljs-number">20</span>);
    <span class="hljs-title function_">insertMany</span>(cats); <span class="hljs-comment">// nested transaction</span>
  });
  
  <span class="hljs-title function_">adopt</span>([
    { <span class="hljs-attr">$name</span>: <span class="hljs-string">"Joey"</span>, <span class="hljs-attr">$age</span>: <span class="hljs-number">2</span> },
    { <span class="hljs-attr">$name</span>: <span class="hljs-string">"Sally"</span>, <span class="hljs-attr">$age</span>: <span class="hljs-number">4</span> },
    { <span class="hljs-attr">$name</span>: <span class="hljs-string">"Junior"</span>, <span class="hljs-attr">$age</span>: <span class="hljs-number">1</span> },
  ]);
  </code></pre>
          <p>
            Transactions also come with <code>deferred</code>,
            <code>immediate</code>, and <code>exclusive</code> versions.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-title function_">insertMany</span>(cats); <span class="hljs-comment">// uses "BEGIN"</span>
  insertMany.<span class="hljs-title function_">deferred</span>(cats); <span class="hljs-comment">// uses "BEGIN DEFERRED"</span>
  insertMany.<span class="hljs-title function_">immediate</span>(cats); <span class="hljs-comment">// uses "BEGIN IMMEDIATE"</span>
  insertMany.<span class="hljs-title function_">exclusive</span>(cats); <span class="hljs-comment">// uses "BEGIN EXCLUSIVE"</span>
  </code></pre>
          <p>
            Any arguments passed to the transaction function will be forwarded
            to the wrapped function, and any values returned from the wrapped
            function will be returned from the transaction function. The wrapped
            function will also have access to the same binding as the
            transaction function.
          </p>
          <p>
            bun:sqlite's transaction implementation is based on
            <a
              href="https://github.com/JoshuaWise/better-sqlite3/blob/master/docs/api.md#transactionfunction---function"
              >better-sqlite3</a
            >
            (along with this section of the docs), so thanks to Joshua Wise and
            better-sqlite3 contributors.
          </p>
          <h4 id="databaseprototypeserialize">Database.prototype.serialize</h4>
          <p>
            SQLite has a built-in way to
            <a href="https://www.sqlite.org/c3ref/serialize.html">serialize</a>
            and
            <a href="https://www.sqlite.org/c3ref/deserialize.html"
              >deserialize</a
            >
            databases to and from memory.
          </p>
          <p><code>bun:sqlite</code> fully supports it:</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">let</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>();
  
  <span class="hljs-comment">// write some data</span>
  db.<span class="hljs-title function_">run</span>(
    <span class="hljs-string">"CREATE TABLE foo (id INTEGER PRIMARY KEY AUTOINCREMENT, greeting TEXT)"</span>,
  );
  db.<span class="hljs-title function_">run</span>(<span class="hljs-string">"INSERT INTO foo VALUES (?)"</span>, <span class="hljs-string">"Welcome to bun!"</span>);
  db.<span class="hljs-title function_">run</span>(<span class="hljs-string">"INSERT INTO foo VALUES (?)"</span>, <span class="hljs-string">"Hello World!"</span>);
  
  <span class="hljs-keyword">const</span> copy = db.<span class="hljs-title function_">serialize</span>();
  <span class="hljs-comment">// =&gt; Uint8Array</span>
  
  <span class="hljs-keyword">const</span> db2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>(copy);
  db2.<span class="hljs-title function_">query</span>(<span class="hljs-string">"SELECT * FROM foo"</span>).<span class="hljs-title function_">all</span>();
  <span class="hljs-comment">// =&gt; [</span>
  <span class="hljs-comment">//   { id: 1, greeting: "Welcome to bun!" },</span>
  <span class="hljs-comment">//   { id: 2, greeting: "Hello World!" },</span>
  <span class="hljs-comment">// ]</span>
  </code></pre>
          <p>
            <code>db.serialize()</code> returns a <code>Uint8Array</code> of the
            database.
          </p>
          <p>
            Internally, it calls
            <a href="https://www.sqlite.org/c3ref/serialize.html"
              ><code>sqlite3_serialize</code></a
            >.
          </p>
          <h4 id="databaseprototypeloadextension">
            Database.prototype.loadExtension
          </h4>
          <p>
            <code>bun:sqlite</code> supports
            <a href="https://www.sqlite.org/loadext.html">SQLite extensions</a>.
          </p>
          <p>
            To load a SQLite extension, call
            <code>Database.prototype.loadExtension(name)</code>:
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Database</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:sqlite"</span>;
  
  <span class="hljs-keyword">let</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>();
  
  db.<span class="hljs-title function_">loadExtension</span>(<span class="hljs-string">"myext"</span>);
  </code></pre>
          <p>
            If you're on macOS, you will need to first use a custom SQLite
            install (you can install with homebrew). By default, bun uses
            Apple's proprietary build of SQLite because it benchmarks about 50%
            faster. However, they disabled extension support, so you will need
            to have a custom build of SQLite to use extensions on macOS.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Database</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:sqlite"</span>;
  
  <span class="hljs-comment">// on macOS, this must be run before any other calls to `Database`</span>
  <span class="hljs-comment">// if called on linux, it will return true and do nothing</span>
  <span class="hljs-comment">// on linux it will still check that a string was passed</span>
  <span class="hljs-title class_">Database</span>.<span class="hljs-title function_">setCustomSQLite</span>(<span class="hljs-string">"/path/to/sqlite.dylib"</span>);
  
  <span class="hljs-keyword">let</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>();
  
  db.<span class="hljs-title function_">loadExtension</span>(<span class="hljs-string">"myext"</span>);
  </code></pre>
          <p>To install sqlite with homebrew:</p>
          <pre><code class="hljs language-bash">brew install sqlite
  </code></pre>
          <h4 id="statement">Statement</h4>
          <p>
            <code>Statement</code> is a prepared statement. Use it to run
            queries that get results.
          </p>
          <p>TLDR:</p>
          <ul>
            <li>
              <a href="#statementall"
                ><code>Statement.all(...optionalParamsToBind)</code></a
              >
              returns all rows as an array of objects
            </li>
            <li>
              <a href="#statementvalues"
                ><code>Statement.values(...optionalParamsToBind)</code></a
              >
              returns all rows as an array of arrays
            </li>
            <li>
              <a href="#statementget"
                ><code>Statement.get(...optionalParamsToBind)</code></a
              >
              returns the first row as an object
            </li>
            <li>
              <a href="#statementrun"
                ><code>Statement.run(...optionalParamsToBind)</code></a
              >
              runs the statement and returns nothing
            </li>
            <li>
              <a href="#statementfinalize"><code>Statement.finalize()</code></a>
              closes the statement
            </li>
            <li>
              <a href="#statementtostring"><code>Statement.toString()</code></a>
              prints the expanded SQL, including bound parameters
            </li>
            <li>
              <code>get Statement.columnNames</code> get the returned column
              names
            </li>
            <li>
              <code>get Statement.paramsCount</code> how many parameters are
              expected?
            </li>
          </ul>
          <p>
            You can bind parameters on any call to a statement. Named parameters
            and positional parameters are supported. Bound parameters are
            remembered between calls and reset the next time you pass parameters
            to bind.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Database</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:sqlite"</span>;
  
  <span class="hljs-comment">// setup</span>
  <span class="hljs-keyword">let</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>();
  db.<span class="hljs-title function_">run</span>(
    <span class="hljs-string">"CREATE TABLE foo (id INTEGER PRIMARY KEY AUTOINCREMENT, greeting TEXT)"</span>,
  );
  db.<span class="hljs-title function_">run</span>(<span class="hljs-string">"INSERT INTO foo VALUES (?)"</span>, <span class="hljs-string">"Welcome to bun!"</span>);
  db.<span class="hljs-title function_">run</span>(<span class="hljs-string">"INSERT INTO foo VALUES (?)"</span>, <span class="hljs-string">"Hello World!"</span>);
  
  <span class="hljs-comment">// Statement object</span>
  <span class="hljs-keyword">let</span> statement = db.<span class="hljs-title function_">query</span>(<span class="hljs-string">"SELECT * FROM foo"</span>);
  
  <span class="hljs-comment">// returns all the rows</span>
  statement.<span class="hljs-title function_">all</span>();
  
  <span class="hljs-comment">// returns the first row</span>
  statement.<span class="hljs-title function_">get</span>();
  
  <span class="hljs-comment">// runs the query, without returning anything</span>
  statement.<span class="hljs-title function_">run</span>();
  </code></pre>
          <h4 id="statementall">Statement.all</h4>
          <p>
            Calling <code>all()</code> on a <code>Statement</code> instance runs
            the query and returns the rows as an array of objects.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Database</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:sqlite"</span>;
  
  <span class="hljs-comment">// setup</span>
  <span class="hljs-keyword">let</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>();
  db.<span class="hljs-title function_">run</span>(
    <span class="hljs-string">"CREATE TABLE foo (id INTEGER PRIMARY KEY AUTOINCREMENT, greeting TEXT, count INTEGER)"</span>,
  );
  db.<span class="hljs-title function_">run</span>(<span class="hljs-string">"INSERT INTO foo (greeting, count) VALUES (?, ?)"</span>, <span class="hljs-string">"Welcome to bun!"</span>, <span class="hljs-number">2</span>);
  db.<span class="hljs-title function_">run</span>(<span class="hljs-string">"INSERT INTO foo (greeting, count) VALUES (?, ?)"</span>, <span class="hljs-string">"Hello World!"</span>, <span class="hljs-number">0</span>);
  db.<span class="hljs-title function_">run</span>(
    <span class="hljs-string">"INSERT INTO foo (greeting, count) VALUES (?, ?)"</span>,
    <span class="hljs-string">"Welcome to bun!!!!"</span>,
    <span class="hljs-number">2</span>,
  );
  
  <span class="hljs-comment">// Statement object</span>
  <span class="hljs-keyword">let</span> statement = db.<span class="hljs-title function_">query</span>(<span class="hljs-string">"SELECT * FROM foo WHERE count = ?"</span>);
  
  <span class="hljs-comment">// return all the query results, binding 2 to the count parameter</span>
  statement.<span class="hljs-title function_">all</span>(<span class="hljs-number">2</span>);
  <span class="hljs-comment">// =&gt; [</span>
  <span class="hljs-comment">//   { id: 1, greeting: "Welcome to bun!", count: 2 },</span>
  <span class="hljs-comment">//   { id: 3, greeting: "Welcome to bun!!!!", count: 2 },</span>
  <span class="hljs-comment">// ]</span>
  </code></pre>
          <p>
            Internally, this calls
            <a href="https://www.sqlite.org/capi3ref.html#sqlite3_reset"
              ><code>sqlite3_reset</code></a
            >
            and repeatedly calls
            <a href="https://www.sqlite.org/capi3ref.html#sqlite3_step"
              ><code>sqlite3_step</code></a
            >
            until it returns <code>SQLITE_DONE</code>.
          </p>
          <h4 id="statementvalues">Statement.values</h4>
          <p>
            Calling <code>values()</code> on a <code>Statement</code> instance
            runs the query and returns the rows as an array of arrays.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Database</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:sqlite"</span>;
  
  <span class="hljs-comment">// setup</span>
  <span class="hljs-keyword">let</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>();
  db.<span class="hljs-title function_">run</span>(
    <span class="hljs-string">"CREATE TABLE foo (id INTEGER PRIMARY KEY AUTOINCREMENT, greeting TEXT, count INTEGER)"</span>,
  );
  db.<span class="hljs-title function_">run</span>(<span class="hljs-string">"INSERT INTO foo (greeting, count) VALUES (?, ?)"</span>, <span class="hljs-string">"Welcome to bun!"</span>, <span class="hljs-number">2</span>);
  db.<span class="hljs-title function_">run</span>(<span class="hljs-string">"INSERT INTO foo (greeting, count) VALUES (?, ?)"</span>, <span class="hljs-string">"Hello World!"</span>, <span class="hljs-number">0</span>);
  db.<span class="hljs-title function_">run</span>(
    <span class="hljs-string">"INSERT INTO foo (greeting, count) VALUES (?, ?)"</span>,
    <span class="hljs-string">"Welcome to bun!!!!"</span>,
    <span class="hljs-number">2</span>,
  );
  
  <span class="hljs-comment">// Statement object</span>
  <span class="hljs-keyword">let</span> statement = db.<span class="hljs-title function_">query</span>(<span class="hljs-string">"SELECT * FROM foo WHERE count = ?"</span>);
  
  <span class="hljs-comment">// return all the query results as an array of arrays, binding 2 to "count"</span>
  statement.<span class="hljs-title function_">values</span>(<span class="hljs-number">2</span>);
  <span class="hljs-comment">// =&gt; [</span>
  <span class="hljs-comment">//   [ 1, "Welcome to bun!", 2 ],</span>
  <span class="hljs-comment">//   [ 3, "Welcome to bun!!!!", 2 ],</span>
  <span class="hljs-comment">// ]</span>
  
  <span class="hljs-comment">// Statement object, but with named parameters</span>
  <span class="hljs-keyword">let</span> statement = db.<span class="hljs-title function_">query</span>(<span class="hljs-string">"SELECT * FROM foo WHERE count = $count"</span>);
  
  <span class="hljs-comment">// return all the query results as an array of arrays, binding 2 to "count"</span>
  statement.<span class="hljs-title function_">values</span>({ <span class="hljs-attr">$count</span>: <span class="hljs-number">2</span> });
  <span class="hljs-comment">// =&gt; [</span>
  <span class="hljs-comment">//   [ 1, "Welcome to bun!", 2 ],</span>
  <span class="hljs-comment">//   [ 3, "Welcome to bun!!!!", 2 ],</span>
  <span class="hljs-comment">// ]</span>
  </code></pre>
          <p>
            Internally, this calls
            <a href="https://www.sqlite.org/capi3ref.html#sqlite3_reset"
              ><code>sqlite3_reset</code></a
            >
            and repeatedly calls
            <a href="https://www.sqlite.org/capi3ref.html#sqlite3_step"
              ><code>sqlite3_step</code></a
            >
            until it returns <code>SQLITE_DONE</code>.
          </p>
          <h4 id="statementget">Statement.get</h4>
          <p>
            Calling <code>get()</code> on a <code>Statement</code> instance runs
            the query and returns the first result as an object.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Database</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:sqlite"</span>;
  
  <span class="hljs-comment">// setup</span>
  <span class="hljs-keyword">let</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>();
  db.<span class="hljs-title function_">run</span>(
    <span class="hljs-string">"CREATE TABLE foo (id INTEGER PRIMARY KEY AUTOINCREMENT, greeting TEXT, count INTEGER)"</span>,
  );
  db.<span class="hljs-title function_">run</span>(<span class="hljs-string">"INSERT INTO foo (greeting, count) VALUES (?, ?)"</span>, <span class="hljs-string">"Welcome to bun!"</span>, <span class="hljs-number">2</span>);
  db.<span class="hljs-title function_">run</span>(<span class="hljs-string">"INSERT INTO foo (greeting, count) VALUES (?, ?)"</span>, <span class="hljs-string">"Hello World!"</span>, <span class="hljs-number">0</span>);
  db.<span class="hljs-title function_">run</span>(
    <span class="hljs-string">"INSERT INTO foo (greeting, count) VALUES (?, ?)"</span>,
    <span class="hljs-string">"Welcome to bun!!!!"</span>,
    <span class="hljs-number">2</span>,
  );
  
  <span class="hljs-comment">// Statement object</span>
  <span class="hljs-keyword">let</span> statement = db.<span class="hljs-title function_">query</span>(<span class="hljs-string">"SELECT * FROM foo WHERE count = ?"</span>);
  
  <span class="hljs-comment">// return the first row as an object, binding 2 to the count parameter</span>
  statement.<span class="hljs-title function_">get</span>(<span class="hljs-number">2</span>);
  <span class="hljs-comment">// =&gt; { id: 1, greeting: "Welcome to bun!", count: 2 }</span>
  
  <span class="hljs-comment">// Statement object, but with named parameters</span>
  <span class="hljs-keyword">let</span> statement = db.<span class="hljs-title function_">query</span>(<span class="hljs-string">"SELECT * FROM foo WHERE count = $count"</span>);
  
  <span class="hljs-comment">// return the first row as an object, binding 2 to the count parameter</span>
  statement.<span class="hljs-title function_">get</span>({ <span class="hljs-attr">$count</span>: <span class="hljs-number">2</span> });
  <span class="hljs-comment">// =&gt; { id: 1, greeting: "Welcome to bun!", count: 2 }</span>
  </code></pre>
          <p>
            Internally, this calls
            <a href="https://www.sqlite.org/capi3ref.html#sqlite3_reset"
              ><code>sqlite3_reset</code></a
            >
            and calls
            <a href="https://www.sqlite.org/capi3ref.html#sqlite3_step"
              ><code>sqlite3_step</code></a
            >
            once. Stepping through all the rows is not necessary when you only
            want the first row.
          </p>
          <h4 id="statementrun">Statement.run</h4>
          <p>
            Calling <code>run()</code> on a <code>Statement</code> instance runs
            the query and returns nothing.
          </p>
          <p>
            This is useful if you want to repeatedly run a query, but don't care
            about the results.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Database</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:sqlite"</span>;
  
  <span class="hljs-comment">// setup</span>
  <span class="hljs-keyword">let</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>();
  db.<span class="hljs-title function_">run</span>(
    <span class="hljs-string">"CREATE TABLE foo (id INTEGER PRIMARY KEY AUTOINCREMENT, greeting TEXT, count INTEGER)"</span>,
  );
  db.<span class="hljs-title function_">run</span>(<span class="hljs-string">"INSERT INTO foo (greeting, count) VALUES (?, ?)"</span>, <span class="hljs-string">"Welcome to bun!"</span>, <span class="hljs-number">2</span>);
  db.<span class="hljs-title function_">run</span>(<span class="hljs-string">"INSERT INTO foo (greeting, count) VALUES (?, ?)"</span>, <span class="hljs-string">"Hello World!"</span>, <span class="hljs-number">0</span>);
  db.<span class="hljs-title function_">run</span>(
    <span class="hljs-string">"INSERT INTO foo (greeting, count) VALUES (?, ?)"</span>,
    <span class="hljs-string">"Welcome to bun!!!!"</span>,
    <span class="hljs-number">2</span>,
  );
  
  <span class="hljs-comment">// Statement object (<span class="hljs-doctag">TODO:</span> use a better example query)</span>
  <span class="hljs-keyword">let</span> statement = db.<span class="hljs-title function_">query</span>(<span class="hljs-string">"SELECT * FROM foo"</span>);
  
  <span class="hljs-comment">// run the query, returning nothing</span>
  statement.<span class="hljs-title function_">run</span>();
  </code></pre>
          <p>
            Internally, this calls
            <a href="https://www.sqlite.org/capi3ref.html#sqlite3_reset"
              ><code>sqlite3_reset</code></a
            >
            and calls
            <a href="https://www.sqlite.org/capi3ref.html#sqlite3_step"
              ><code>sqlite3_step</code></a
            >
            once. Stepping through all the rows is not necessary when you don't
            care about the results.
          </p>
          <h4 id="statementfinalize">Statement.finalize</h4>
          <p>
            This method finalizes the statement, freeing any resources
            associated with it.
          </p>
          <p>
            After a statement has been finalized, it cannot be used for any
            further queries. Any attempt to run the statement will throw an
            error. Calling it multiple times will have no effect.
          </p>
          <p>
            It is a good idea to finalize a statement when you are done with it,
            but the garbage collector will do it for you if you don't.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Database</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:sqlite"</span>;
  
  <span class="hljs-comment">// setup</span>
  <span class="hljs-keyword">let</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>();
  db.<span class="hljs-title function_">run</span>(
    <span class="hljs-string">"CREATE TABLE foo (id INTEGER PRIMARY KEY AUTOINCREMENT, greeting TEXT, count INTEGER)"</span>,
  );
  db.<span class="hljs-title function_">run</span>(<span class="hljs-string">"INSERT INTO foo (greeting, count) VALUES (?, ?)"</span>, <span class="hljs-string">"Welcome to bun!"</span>, <span class="hljs-number">2</span>);
  db.<span class="hljs-title function_">run</span>(<span class="hljs-string">"INSERT INTO foo (greeting, count) VALUES (?, ?)"</span>, <span class="hljs-string">"Hello World!"</span>, <span class="hljs-number">0</span>);
  db.<span class="hljs-title function_">run</span>(
    <span class="hljs-string">"INSERT INTO foo (greeting, count) VALUES (?, ?)"</span>,
    <span class="hljs-string">"Welcome to bun!!!!"</span>,
    <span class="hljs-number">2</span>,
  );
  
  <span class="hljs-comment">// Statement object</span>
  <span class="hljs-keyword">let</span> statement = db.<span class="hljs-title function_">query</span>(<span class="hljs-string">"SELECT * FROM foo WHERE count = ?"</span>);
  
  statement.<span class="hljs-title function_">finalize</span>();
  
  <span class="hljs-comment">// this will throw</span>
  statement.<span class="hljs-title function_">run</span>();
  </code></pre>
          <h4 id="statementtostring">Statement.toString()</h4>
          <p>
            Calling <code>toString()</code> on a <code>Statement</code> instance
            prints the expanded SQL query. This is useful for debugging.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Database</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:sqlite"</span>;
  
  <span class="hljs-comment">// setup</span>
  <span class="hljs-keyword">let</span> db = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>();
  db.<span class="hljs-title function_">run</span>(
    <span class="hljs-string">"CREATE TABLE foo (id INTEGER PRIMARY KEY AUTOINCREMENT, greeting TEXT, count INTEGER)"</span>,
  );
  db.<span class="hljs-title function_">run</span>(<span class="hljs-string">"INSERT INTO foo (greeting, count) VALUES (?, ?)"</span>, <span class="hljs-string">"Welcome to bun!"</span>, <span class="hljs-number">2</span>);
  db.<span class="hljs-title function_">run</span>(<span class="hljs-string">"INSERT INTO foo (greeting, count) VALUES (?, ?)"</span>, <span class="hljs-string">"Hello World!"</span>, <span class="hljs-number">0</span>);
  db.<span class="hljs-title function_">run</span>(
    <span class="hljs-string">"INSERT INTO foo (greeting, count) VALUES (?, ?)"</span>,
    <span class="hljs-string">"Welcome to bun!!!!"</span>,
    <span class="hljs-number">2</span>,
  );
  
  <span class="hljs-comment">// Statement object</span>
  <span class="hljs-keyword">const</span> statement = db.<span class="hljs-title function_">query</span>(<span class="hljs-string">"SELECT * FROM foo WHERE count = ?"</span>);
  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(statement.<span class="hljs-title function_">toString</span>());
  <span class="hljs-comment">// =&gt; "SELECT * FROM foo WHERE count = NULL"</span>
  
  statement.<span class="hljs-title function_">run</span>(<span class="hljs-number">2</span>); <span class="hljs-comment">// bind the param</span>
  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(statement.<span class="hljs-title function_">toString</span>());
  <span class="hljs-comment">// =&gt; "SELECT * FROM foo WHERE count = 2"</span>
  </code></pre>
          <p>
            Internally, this calls
            <a href="https://www.sqlite.org/capi3ref.html#sqlite3_expanded_sql"
              ><code>sqlite3_expanded_sql</code></a
            >.
          </p>
          <h4 id="datatypes">Datatypes</h4>
          <table>
            <thead>
              <tr>
                <th>JavaScript type</th>
                <th>SQLite type</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>string</code></td>
                <td><code>TEXT</code></td>
              </tr>
              <tr>
                <td><code>number</code></td>
                <td><code>INTEGER</code> or <code>DECIMAL</code></td>
              </tr>
              <tr>
                <td><code>boolean</code></td>
                <td><code>INTEGER</code> (1 or 0)</td>
              </tr>
              <tr>
                <td><code>Uint8Array</code></td>
                <td><code>BLOB</code></td>
              </tr>
              <tr>
                <td><code>Buffer</code></td>
                <td><code>BLOB</code></td>
              </tr>
              <tr>
                <td><code>bigint</code></td>
                <td><code>INTEGER</code></td>
              </tr>
              <tr>
                <td><code>null</code></td>
                <td><code>NULL</code></td>
              </tr>
            </tbody>
          </table>
          <h3 id="bunffi-foreign-functions-interface">
            <code>bun:ffi</code> (Foreign Functions Interface)
          </h3>
          <p>
            <code>bun:ffi</code> lets you efficiently call native libraries from
            JavaScript. It works with languages that support the C ABI (Zig,
            Rust, C/C++, C#, Nim, Kotlin, etc).
          </p>
          <p>This snippet prints sqlite3's version number:</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { dlopen, <span class="hljs-title class_">FFIType</span>, suffix } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:ffi"</span>;
  
  <span class="hljs-comment">// `suffix` is either "dylib", "so", or "dll" depending on the platform</span>
  <span class="hljs-comment">// you don't have to use "suffix", it's just there for convenience</span>
  <span class="hljs-keyword">const</span> path = <span class="hljs-string">`libsqlite3.<span class="hljs-subst">${suffix}</span>`</span>;
  
  <span class="hljs-keyword">const</span> {
    <span class="hljs-attr">symbols</span>: {
      <span class="hljs-comment">// sqlite3_libversion is the function we will call</span>
      sqlite3_libversion,
    },
  } =
    <span class="hljs-comment">// dlopen() expects:</span>
    <span class="hljs-comment">// 1. a library name or file path</span>
    <span class="hljs-comment">// 2. a map of symbols</span>
    <span class="hljs-title function_">dlopen</span>(path, {
      <span class="hljs-comment">// `sqlite3_libversion` is a function that returns a string</span>
      <span class="hljs-attr">sqlite3_libversion</span>: {
        <span class="hljs-comment">// sqlite3_libversion takes no arguments</span>
        <span class="hljs-attr">args</span>: [],
        <span class="hljs-comment">// sqlite3_libversion returns a pointer to a string</span>
        <span class="hljs-attr">returns</span>: <span class="hljs-title class_">FFIType</span>.<span class="hljs-property">cstring</span>,
      },
    });
  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`SQLite 3 version: <span class="hljs-subst">${sqlite3_libversion()}</span>`</span>);
  </code></pre>
          <h4 id="low-overhead-ffi">Low-overhead FFI</h4>
          <p>
            3ns to go from JavaScript &lt;&gt; native code with
            <code>bun:ffi</code> (on my machine, an M1 Pro with 64GB of RAM)
          </p>
          <ul>
            <li>5x faster than napi (Node v17.7.1)</li>
            <li>100x faster than Deno v1.21.1</li>
          </ul>
          <p>As measured in <a href="./bench/ffi">this simple benchmark</a></p>
          <img
            src="https://user-images.githubusercontent.com/709451/166429741-e6d83ca5-3808-4397-acb7-bb2c9f4329be.png"
            height="400"
          />

          Why is bun:ffi fast?

          <p>
            Bun generates &amp; just-in-time compiles C bindings that
            efficiently convert values between JavaScript types and native
            types.
          </p>
          <p>
            To compile C, Bun embeds
            <a href="https://github.com/TinyCC/tinycc">TinyCC</a>, a small and
            fast C compiler.
          </p>

          <h4 id="usage-2">Usage</h4>
          <p>With Zig:</p>
          <pre><code class="hljs language-zig">// add.zig
  pub export fn add(a: i32, b: i32) i32 {
    return a + b;
  }
  </code></pre>
          <p>To compile:</p>
          <pre><code class="hljs language-bash">zig build-lib add.zig -dynamic -OReleaseFast
  </code></pre>
          <p>
            Pass <code>dlopen</code> the path to the shared library and the list
            of symbols you want to import.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { dlopen, <span class="hljs-title class_">FFIType</span>, suffix } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:ffi"</span>;
  
  <span class="hljs-keyword">const</span> path = <span class="hljs-string">`libadd.<span class="hljs-subst">${suffix}</span>`</span>;
  
  <span class="hljs-keyword">const</span> lib = <span class="hljs-title function_">dlopen</span>(path, {
    <span class="hljs-attr">add</span>: {
      <span class="hljs-attr">args</span>: [<span class="hljs-title class_">FFIType</span>.<span class="hljs-property">i32</span>, <span class="hljs-title class_">FFIType</span>.<span class="hljs-property">i32</span>],
      <span class="hljs-attr">returns</span>: <span class="hljs-title class_">FFIType</span>.<span class="hljs-property">i32</span>,
    },
  });
  
  lib.<span class="hljs-property">symbols</span>.<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
  </code></pre>
          <p>With Rust:</p>
          <pre><code class="hljs language-rust"><span class="hljs-comment">// add.rs</span>
  <span class="hljs-meta">#[no_mangle]</span>
  <span class="hljs-keyword">pub</span> <span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">add</span>(a: <span class="hljs-type">isize</span>, b: <span class="hljs-type">isize</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">isize</span> {
      a + b
  }
  </code></pre>
          <p>To compile:</p>
          <pre><code class="hljs language-bash">rustc --crate-type cdylib add.rs
  </code></pre>
          <h4 id="supported-ffi-types-ffitype">
            Supported FFI types (<code>FFIType</code>)
          </h4>
          <table>
            <thead>
              <tr>
                <th><code>FFIType</code></th>
                <th>C Type</th>
                <th>Aliases</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>cstring</td>
                <td><code>char*</code></td>
                <td></td>
              </tr>
              <tr>
                <td>function</td>
                <td><code>(void*)(*)()</code></td>
                <td><code>fn</code>, <code>callback</code></td>
              </tr>
              <tr>
                <td>ptr</td>
                <td><code>void*</code></td>
                <td>
                  <code>pointer</code>, <code>void*</code>, <code>char*</code>
                </td>
              </tr>
              <tr>
                <td>i8</td>
                <td><code>int8_t</code></td>
                <td><code>int8_t</code></td>
              </tr>
              <tr>
                <td>i16</td>
                <td><code>int16_t</code></td>
                <td><code>int16_t</code></td>
              </tr>
              <tr>
                <td>i32</td>
                <td><code>int32_t</code></td>
                <td><code>int32_t</code>, <code>int</code></td>
              </tr>
              <tr>
                <td>i64</td>
                <td><code>int64_t</code></td>
                <td><code>int64_t</code></td>
              </tr>
              <tr>
                <td>i64_fast</td>
                <td><code>int64_t</code></td>
                <td></td>
              </tr>
              <tr>
                <td>u8</td>
                <td><code>uint8_t</code></td>
                <td><code>uint8_t</code></td>
              </tr>
              <tr>
                <td>u16</td>
                <td><code>uint16_t</code></td>
                <td><code>uint16_t</code></td>
              </tr>
              <tr>
                <td>u32</td>
                <td><code>uint32_t</code></td>
                <td><code>uint32_t</code></td>
              </tr>
              <tr>
                <td>u64</td>
                <td><code>uint64_t</code></td>
                <td><code>uint64_t</code></td>
              </tr>
              <tr>
                <td>u64_fast</td>
                <td><code>uint64_t</code></td>
                <td></td>
              </tr>
              <tr>
                <td>f32</td>
                <td><code>float</code></td>
                <td><code>float</code></td>
              </tr>
              <tr>
                <td>f64</td>
                <td><code>double</code></td>
                <td><code>double</code></td>
              </tr>
              <tr>
                <td>bool</td>
                <td><code>bool</code></td>
                <td></td>
              </tr>
              <tr>
                <td>char</td>
                <td><code>char</code></td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <h4 id="strings-cstring">Strings (<code>CString</code>)</h4>
          <p>
            JavaScript strings and C-like strings are different, and that
            complicates using strings with native libraries.
          </p>

          How are JavaScript strings and C strings different?

          <p>JavaScript strings:</p>
          <ul>
            <li>
              UTF16 (2 bytes per letter) or potentially latin1, depending on the
              JavaScript engine &amp; what characters are used
            </li>
            <li><code>length</code> stored separately</li>
            <li>Immutable</li>
          </ul>
          <p>C strings:</p>
          <ul>
            <li>UTF8 (1 byte per letter), usually</li>
            <li>
              The length is not stored. Instead, the string is null-terminated
              which means the length is the index of the first
              <code>\0</code> it finds
            </li>
            <li>Mutable</li>
          </ul>

          <p>
            To help with that, <code>bun:ffi</code> exports
            <code>CString</code> which extends JavaScript's built-in
            <code>String</code> to support null-terminated strings and add a few
            extras:
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CString</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">String</span> {
    <span class="hljs-comment">/**
     * Given a `ptr`, this will automatically search for the closing `\0` character and transcode from UTF-8 to UTF-16 if necessary.
     */</span>
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">ptr: <span class="hljs-built_in">number</span>, byteOffset?: <span class="hljs-built_in">number</span>, byteLength?: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">string</span>;
  
    <span class="hljs-comment">/**
     * The ptr to the C string
     *
     * This `CString` instance is a clone of the string, so it
     * is safe to continue using this instance after the `ptr` has been
     * freed.
     */</span>
    <span class="hljs-attr">ptr</span>: <span class="hljs-built_in">number</span>;
    byteOffset?: <span class="hljs-built_in">number</span>;
    byteLength?: <span class="hljs-built_in">number</span>;
  }
  </code></pre>
          <p>
            To convert from a null-terminated string pointer to a JavaScript
            string:
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">const</span> myString = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CString</span>(ptr);
  </code></pre>
          <p>
            To convert from a pointer with a known length to a JavaScript
            string:
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">const</span> myString = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CString</span>(ptr, <span class="hljs-number">0</span>, byteLength);
  </code></pre>
          <p>
            <code>new CString</code> clones the C string, so it is safe to
            continue using <code>myString</code> after <code>ptr</code> has been
            freed.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-title function_">my_library_free</span>(myString.<span class="hljs-property">ptr</span>);
  
  <span class="hljs-comment">// this is safe because myString is a clone</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myString);
  </code></pre>
          <h5 id="returning-a-string">Returning a string</h5>
          <p>
            When used in <code>returns</code>,
            <code>FFIType.cstring</code> coerces the pointer to a JavaScript
            <code>string</code>. When used in <code>args</code>,
            <code>cstring</code> is identical to <code>ptr</code>.
          </p>
          <h4 id="function-pointers-cfunction">
            Function pointers (<code>CFunction</code>)
          </h4>
          <p>
            To call a function pointer from JavaScript, use
            <code>CFunction</code>
          </p>
          <p>
            This is useful if using Node-API (napi) with Bun, and you've already
            loaded some symbols.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">CFunction</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:ffi"</span>;
  
  <span class="hljs-keyword">let</span> myNativeLibraryGetVersion = <span class="hljs-comment">/* somehow, you got this pointer */</span>
  
  <span class="hljs-keyword">const</span> getVersion = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CFunction</span>({
    <span class="hljs-attr">returns</span>: <span class="hljs-string">"cstring"</span>,
    <span class="hljs-attr">args</span>: [],
    <span class="hljs-attr">ptr</span>: myNativeLibraryGetVersion,
  });
  <span class="hljs-title function_">getVersion</span>();
  </code></pre>
          <p>
            If you have multiple function pointers, you can define them all at
            once with <code>linkSymbols</code>:
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { linkSymbols } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:ffi"</span>;
  
  <span class="hljs-comment">// getVersionPtrs defined elsewhere</span>
  <span class="hljs-keyword">const</span> [majorPtr, minorPtr, patchPtr] = <span class="hljs-title function_">getVersionPtrs</span>();
  
  <span class="hljs-keyword">const</span> lib = <span class="hljs-title function_">linkSymbols</span>({
    <span class="hljs-comment">// Unlike with dlopen(), the names here can be whatever you want</span>
    <span class="hljs-attr">getMajor</span>: {
      <span class="hljs-attr">returns</span>: <span class="hljs-string">"cstring"</span>,
      <span class="hljs-attr">args</span>: [],
  
      <span class="hljs-comment">// Since this doesn't use dlsym(), you have to provide a valid ptr</span>
      <span class="hljs-comment">// That ptr could be a number or a bigint</span>
      <span class="hljs-comment">// An invalid pointer will crash your program.</span>
      <span class="hljs-attr">ptr</span>: majorPtr,
    },
    <span class="hljs-attr">getMinor</span>: {
      <span class="hljs-attr">returns</span>: <span class="hljs-string">"cstring"</span>,
      <span class="hljs-attr">args</span>: [],
      <span class="hljs-attr">ptr</span>: minorPtr,
    },
    <span class="hljs-attr">getPatch</span>: {
      <span class="hljs-attr">returns</span>: <span class="hljs-string">"cstring"</span>,
      <span class="hljs-attr">args</span>: [],
      <span class="hljs-attr">ptr</span>: patchPtr,
    },
  });
  
  <span class="hljs-keyword">const</span> [major, minor, patch] = [
    lib.<span class="hljs-property">symbols</span>.<span class="hljs-title function_">getMajor</span>(),
    lib.<span class="hljs-property">symbols</span>.<span class="hljs-title function_">getMinor</span>(),
    lib.<span class="hljs-property">symbols</span>.<span class="hljs-title function_">getPatch</span>(),
  ];
  </code></pre>
          <h4 id="callbacks-jscallback">Callbacks (<code>JSCallback</code>)</h4>
          <p>
            Bun v0.3.0 added <code>JSCallback</code> which lets you create
            JavaScript callback functions that you can pass to C/FFI functions.
            The C/FFI function can call into the JavaScript/TypeScript code.
            This is useful for asynchronous code or otherwise when you want to
            call into JavaScript code from C.
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { dlopen, <span class="hljs-title class_">JSCallback</span>, ptr, <span class="hljs-title class_">CString</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:ffi"</span>;
  
  <span class="hljs-keyword">const</span> {
    <span class="hljs-attr">symbols</span>: { search },
    close,
  } = <span class="hljs-title function_">dlopen</span>(<span class="hljs-string">"libmylib"</span>, {
    <span class="hljs-attr">search</span>: {
      <span class="hljs-attr">returns</span>: <span class="hljs-string">"usize"</span>,
      <span class="hljs-attr">args</span>: [<span class="hljs-string">"cstring"</span>, <span class="hljs-string">"callback"</span>],
    },
  });
  
  <span class="hljs-keyword">const</span> searchIterator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSCallback</span>(
    <span class="hljs-function">(<span class="hljs-params">ptr, length</span>) =&gt;</span> <span class="hljs-regexp">/hello/</span>.<span class="hljs-title function_">test</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CString</span>(ptr, length)),
    {
      <span class="hljs-attr">returns</span>: <span class="hljs-string">"bool"</span>,
      <span class="hljs-attr">args</span>: [<span class="hljs-string">"ptr"</span>, <span class="hljs-string">"usize"</span>],
    },
  );
  
  <span class="hljs-keyword">const</span> str = <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(<span class="hljs-string">"wwutwutwutwutwutwutwutwutwutwutut\0"</span>, <span class="hljs-string">"utf8"</span>);
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">search</span>(<span class="hljs-title function_">ptr</span>(str), searchIterator)) {
    <span class="hljs-comment">// found a match!</span>
  }
  
  <span class="hljs-comment">// Sometime later:</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    searchIterator.<span class="hljs-title function_">close</span>();
    <span class="hljs-title function_">close</span>();
  }, <span class="hljs-number">5000</span>);
  </code></pre>
          <p>
            When you're done with a JSCallback, you should call
            <code>close()</code> to free the memory.
          </p>
          <p>
            For a slight performance boost, directly pass
            <code>JSCallback.prototype.ptr</code> instead of the
            <code>JSCallback</code> object:
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">const</span> onResolve = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSCallback</span>(<span class="hljs-function">(<span class="hljs-params">arg</span>) =&gt;</span> arg === <span class="hljs-number">42</span>, {
    <span class="hljs-attr">returns</span>: <span class="hljs-string">"bool"</span>,
    <span class="hljs-attr">args</span>: [<span class="hljs-string">"i32"</span>],
  });
  <span class="hljs-keyword">const</span> setOnResolve = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CFunction</span>({
    <span class="hljs-attr">returns</span>: <span class="hljs-string">"bool"</span>,
    <span class="hljs-attr">args</span>: [<span class="hljs-string">"function"</span>],
    <span class="hljs-attr">ptr</span>: myNativeLibrarySetOnResolve,
  });
  
  <span class="hljs-comment">// This code runs slightly faster:</span>
  <span class="hljs-title function_">setOnResolve</span>(onResolve.<span class="hljs-property">ptr</span>);
  
  <span class="hljs-comment">// Compared to this:</span>
  <span class="hljs-title function_">setOnResolve</span>(onResolve);
  </code></pre>
          <h4 id="pointers">Pointers</h4>
          <p>
            Bun represents
            <a
              href="https://en.wikipedia.org/wiki/Pointer_(computer_programming)"
              >pointers</a
            >
            as a <code>number</code> in JavaScript.
          </p>

          How does a 64 bit pointer fit in a JavaScript number?

          <p>
            64-bit processors support up to
            <a
              href="https://en.wikipedia.org/wiki/64-bit_computing#Limits_of_processors"
              >52 bits of addressable space</a
            >.
          </p>
          <p>
            <a
              href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format#IEEE_754_double-precision_binary_floating-point_format:_binary64"
              >JavaScript numbers</a
            >
            support 53 bits of usable space, so that leaves us with about 11
            bits of extra space.
          </p>
          <p>Why not <code>BigInt</code>?</p>
          <p>
            <code>BigInt</code> is slower. JavaScript engines allocate a
            separate <code>BigInt</code> which means they can't just fit in a
            regular javascript value.
          </p>
          <p>
            If you pass a <code>BigInt</code> to a function, it will be
            converted to a <code>number</code>
          </p>

          <p><strong>To convert from a TypedArray to a pointer</strong>:</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { ptr } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:ffi"</span>;
  <span class="hljs-keyword">let</span> myTypedArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(<span class="hljs-number">32</span>);
  <span class="hljs-keyword">const</span> myPtr = <span class="hljs-title function_">ptr</span>(myTypedArray);
  </code></pre>
          <p><strong>To convert from a pointer to an ArrayBuffer</strong>:</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { ptr, toArrayBuffer } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:ffi"</span>;
  <span class="hljs-keyword">let</span> myTypedArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(<span class="hljs-number">32</span>);
  <span class="hljs-keyword">const</span> myPtr = <span class="hljs-title function_">ptr</span>(myTypedArray);
  
  <span class="hljs-comment">// toArrayBuffer accepts a `byteOffset` and `byteLength`</span>
  <span class="hljs-comment">// if `byteLength` is not provided, it is assumed to be a null-terminated pointer</span>
  myTypedArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(<span class="hljs-title function_">toArrayBuffer</span>(myPtr, <span class="hljs-number">0</span>, <span class="hljs-number">32</span>), <span class="hljs-number">0</span>, <span class="hljs-number">32</span>);
  </code></pre>
          <p><strong>To read data from a pointer</strong></p>
          <p>You have two options.</p>
          <p>
            For long-lived pointers, a <code>DataView</code> is the fastest
            option:
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { toArrayBuffer } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:ffi"</span>;
  <span class="hljs-keyword">let</span> myDataView = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataView</span>(<span class="hljs-title function_">toArrayBuffer</span>(myPtr, <span class="hljs-number">0</span>, <span class="hljs-number">32</span>));
  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
    myDataView.<span class="hljs-title function_">getUint8</span>(<span class="hljs-number">0</span>, <span class="hljs-literal">true</span>),
    myDataView.<span class="hljs-title function_">getUint8</span>(<span class="hljs-number">1</span>, <span class="hljs-literal">true</span>),
    myDataView.<span class="hljs-title function_">getUint8</span>(<span class="hljs-number">2</span>, <span class="hljs-literal">true</span>),
    myDataView.<span class="hljs-title function_">getUint8</span>(<span class="hljs-number">3</span>, <span class="hljs-literal">true</span>),
  );
  </code></pre>
          <p>
            For short-lived pointers, <code>read</code> is the fastest option:
          </p>
          <p><em>Available in Bun v0.1.12+</em></p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { read } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:ffi"</span>;
  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
    <span class="hljs-comment">// ptr, byteOffset</span>
    read.<span class="hljs-title function_">u8</span>(myPtr, <span class="hljs-number">0</span>),
    read.<span class="hljs-title function_">u8</span>(myPtr, <span class="hljs-number">1</span>),
    read.<span class="hljs-title function_">u8</span>(myPtr, <span class="hljs-number">2</span>),
    read.<span class="hljs-title function_">u8</span>(myPtr, <span class="hljs-number">3</span>),
  );
  </code></pre>
          <p>
            <code>read</code> behaves similarly to <code>DataView</code>, but it
            can be faster because it doesn't need to create a
            <code>DataView</code> or <code>ArrayBuffer</code>.
          </p>
          <table>
            <thead>
              <tr>
                <th><code>FFIType</code></th>
                <th><code>read</code> function</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>ptr</td>
                <td><code>read.ptr</code></td>
              </tr>
              <tr>
                <td>i8</td>
                <td><code>read.i8</code></td>
              </tr>
              <tr>
                <td>i16</td>
                <td><code>read.i16</code></td>
              </tr>
              <tr>
                <td>i32</td>
                <td><code>read.i32</code></td>
              </tr>
              <tr>
                <td>i64</td>
                <td><code>read.i64</code></td>
              </tr>
              <tr>
                <td>u8</td>
                <td><code>read.u8</code></td>
              </tr>
              <tr>
                <td>u16</td>
                <td><code>read.u16</code></td>
              </tr>
              <tr>
                <td>u32</td>
                <td><code>read.u32</code></td>
              </tr>
              <tr>
                <td>u64</td>
                <td><code>read.u64</code></td>
              </tr>
              <tr>
                <td>f32</td>
                <td><code>read.f32</code></td>
              </tr>
              <tr>
                <td>f64</td>
                <td><code>read.f64</code></td>
              </tr>
            </tbody>
          </table>
          <p><strong>Memory management with pointers</strong>:</p>
          <p>
            <code>bun:ffi</code> does not manage memory for you because it
            doesn't have the information necessary. You must free the memory
            when you're done with it.
          </p>
          <p><strong>From JavaScript</strong>:</p>
          <p>
            If you want to track when a TypedArray is no longer in use from
            JavaScript, you can use a
            <a
              href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/FinalizationRegistry"
              >FinalizationRegistry</a
            >.
          </p>
          <p><strong>From FFI (C, Rust, Zig, etc)</strong>:</p>
          <p><sup>Available in Bun v0.1.8 and later.</sup></p>
          <p>
            If you want to track when a TypedArray is no longer in use from C or
            FFI, you can pass a callback and an optional context pointer to
            <code>toArrayBuffer</code> or <code>toBuffer</code>. This function
            is called at some point later, once the garbage collector frees the
            underlying <code>ArrayBuffer</code> JavaScript object.
          </p>
          <p>
            The expected signature is the same as in
            <a
              href="https://developer.apple.com/documentation/javascriptcore/jstypedarraybytesdeallocator?language=objc"
              >JavaScriptCore's C API</a
            >:
          </p>
          <pre><code class="hljs language-c"><span class="hljs-keyword">typedef</span> <span class="hljs-title function_">void</span> <span class="hljs-params">(*JSTypedArrayBytesDeallocator)</span><span class="hljs-params">(<span class="hljs-type">void</span> *bytes, <span class="hljs-type">void</span> *deallocatorContext)</span>;
  </code></pre>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { toArrayBuffer } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:ffi"</span>;
  
  <span class="hljs-comment">// with a deallocatorContext:</span>
  <span class="hljs-title function_">toArrayBuffer</span>(
    bytes,
    byteOffset,
  
    byteLength,
  
    <span class="hljs-comment">// this is an optional pointer to a callback</span>
    deallocatorContext,
  
    <span class="hljs-comment">// this is a pointer to a function</span>
    jsTypedArrayBytesDeallocator,
  );
  
  <span class="hljs-comment">// without a deallocatorContext:</span>
  <span class="hljs-title function_">toArrayBuffer</span>(
    bytes,
    byteOffset,
  
    byteLength,
  
    <span class="hljs-comment">// this is a pointer to a function</span>
    jsTypedArrayBytesDeallocator,
  );
  </code></pre>
          <p><strong>Pointers &amp; memory safety</strong></p>
          <p>Using raw pointers outside of FFI is extremely not recommended.</p>
          <p>
            A future version of bun may add a CLI flag to disable
            <code>bun:ffi</code> (or potentially a separate build of bun).
          </p>
          <p><strong>Pointer alignment</strong></p>
          <p>
            If an API expects a pointer sized to something other than
            <code>char</code> or <code>u8</code>, make sure the typed array is
            also that size.
          </p>
          <p>
            A <code>u64*</code> is not exactly the same as
            <code>[8]u8*</code> due to alignment
          </p>
          <h5 id="passing-a-pointer">Passing a pointer</h5>
          <p>
            Where FFI functions expect a pointer, pass a TypedArray of
            equivalent size
          </p>
          <p>Easymode:</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { dlopen, <span class="hljs-title class_">FFIType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:ffi"</span>;
  
  <span class="hljs-keyword">const</span> {
    <span class="hljs-attr">symbols</span>: { encode_png },
  } = <span class="hljs-title function_">dlopen</span>(myLibraryPath, {
    <span class="hljs-attr">encode_png</span>: {
      <span class="hljs-comment">// FFIType's can be specified as strings too</span>
      <span class="hljs-attr">args</span>: [<span class="hljs-string">"ptr"</span>, <span class="hljs-string">"u32"</span>, <span class="hljs-string">"u32"</span>],
      <span class="hljs-attr">returns</span>: <span class="hljs-title class_">FFIType</span>.<span class="hljs-property">ptr</span>,
    },
  });
  
  <span class="hljs-keyword">const</span> pixels = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8ClampedArray</span>(<span class="hljs-number">128</span> * <span class="hljs-number">128</span> * <span class="hljs-number">4</span>);
  pixels.<span class="hljs-title function_">fill</span>(<span class="hljs-number">254</span>);
  pixels.<span class="hljs-title function_">subarray</span>(<span class="hljs-number">0</span>, <span class="hljs-number">32</span> * <span class="hljs-number">32</span> * <span class="hljs-number">2</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);
  
  <span class="hljs-keyword">const</span> out = <span class="hljs-title function_">encode_png</span>(
    <span class="hljs-comment">// pixels will be passed as a pointer</span>
    pixels,
  
    <span class="hljs-number">128</span>,
    <span class="hljs-number">128</span>,
  );
  </code></pre>
          <p>
            The
            <a
              href="https://github.com/oven-sh/bun/blob/6a65631cbdcae75bfa1e64323a6ad613a922cd1a/src/bun.js/ffi.exports.js#L180-L182"
              >auto-generated wrapper</a
            >
            converts the pointer to a TypedArray
          </p>

          Hardmode

          <p>
            If you don't want the automatic conversion or you want a pointer to
            a specific byte offset within the TypedArray, you can also directly
            get the pointer to the TypedArray:
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { dlopen, <span class="hljs-title class_">FFIType</span>, ptr } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:ffi"</span>;
  
  <span class="hljs-keyword">const</span> {
    <span class="hljs-attr">symbols</span>: { encode_png },
  } = <span class="hljs-title function_">dlopen</span>(myLibraryPath, {
    <span class="hljs-attr">encode_png</span>: {
      <span class="hljs-comment">// FFIType's can be specified as strings too</span>
      <span class="hljs-attr">args</span>: [<span class="hljs-string">"ptr"</span>, <span class="hljs-string">"u32"</span>, <span class="hljs-string">"u32"</span>],
      <span class="hljs-attr">returns</span>: <span class="hljs-title class_">FFIType</span>.<span class="hljs-property">ptr</span>,
    },
  });
  
  <span class="hljs-keyword">const</span> pixels = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8ClampedArray</span>(<span class="hljs-number">128</span> * <span class="hljs-number">128</span> * <span class="hljs-number">4</span>);
  pixels.<span class="hljs-title function_">fill</span>(<span class="hljs-number">254</span>);
  
  <span class="hljs-comment">// this returns a number! not a BigInt!</span>
  <span class="hljs-keyword">const</span> myPtr = <span class="hljs-title function_">ptr</span>(pixels);
  
  <span class="hljs-keyword">const</span> out = <span class="hljs-title function_">encode_png</span>(
    myPtr,
  
    <span class="hljs-comment">// dimensions:</span>
    <span class="hljs-number">128</span>,
    <span class="hljs-number">128</span>,
  );
  </code></pre>

          <h5 id="reading-pointers">Reading pointers</h5>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">const</span> out = <span class="hljs-title function_">encode_png</span>(
    <span class="hljs-comment">// pixels will be passed as a pointer</span>
    pixels,
  
    <span class="hljs-comment">// dimensions:</span>
    <span class="hljs-number">128</span>,
    <span class="hljs-number">128</span>,
  );
  
  <span class="hljs-comment">// assuming it is 0-terminated, it can be read like this:</span>
  <span class="hljs-keyword">let</span> png = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(<span class="hljs-title function_">toArrayBuffer</span>(out));
  
  <span class="hljs-comment">// save it to disk:</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">"out.png"</span>, png);
  </code></pre>
          <h5 id="not-implemented-yet-1">Not implemented yet</h5>
          <p>
            <code>bun:ffi</code> has a few more things planned but not
            implemented yet:
          </p>
          <ul>
            <li>callback functions</li>
            <li>async functions</li>
          </ul>
          <h3 id="node-api-napi">Node-API (napi)</h3>
          <p>
            Bun.js implements 90% of the APIs available in
            <a href="https://nodejs.org/api/n-api.html">Node-API</a> (napi).
          </p>
          <p>
            You can see the status of
            <a href="https://github.com/oven-sh/bun/issues/158">this here</a>.
          </p>
          <p>
            Loading Node-API modules in Bun.js works the same as in Node.js:
          </p>
          <pre><code class="hljs language-js"><span class="hljs-keyword">const</span> napi = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./my-node-module.node"</span>);
  </code></pre>
          <p>You can also use <code>process.dlopen</code>:</p>
          <pre><code class="hljs language-js"><span class="hljs-keyword">let</span> mod = { <span class="hljs-attr">exports</span>: {} };
  process.<span class="hljs-title function_">dlopen</span>(mod, <span class="hljs-string">"./my-node-module.node"</span>);
  </code></pre>
          <p>
            As part of that work, Bun.js also polyfills the
            <a href="https://npmjs.com/package/detect-libc"
              ><code>detect-libc</code></a
            >
            package, which is used by many Node-API modules to detect which
            <code>.node</code> binding to <code>require</code>.
          </p>
          <p>
            This implementation of Node-API is from scratch. It doesn't use any
            code from Node.js.
          </p>
          <p><strong>Some implementation details</strong></p>
          <p>
            When requiring a <code>*.node</code> module, Bun's JavaScript
            transpiler transforms the <code>require</code> expression into a
            call to <code>import.meta.require</code>:
          </p>
          <pre><code class="hljs language-js"><span class="hljs-comment">// this is the input</span>
  <span class="hljs-built_in">require</span>(<span class="hljs-string">"./my-node-module.node"</span>);
  
  <span class="hljs-comment">// this is the output</span>
  <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-built_in">require</span>(<span class="hljs-string">"./my-node-module.node"</span>);
  </code></pre>
          <p>
            Bun doesn't currently support dynamic requires, but
            <code>import.meta.require</code> is an escape hatch for that. It
            uses a
            <a
              href="https://github.com/oven-sh/bun/blob/aa87d40f4b7fdfb52575f44d151906ddba6a82d0/src/javascript/jsc/bindings/builtins/js/JSZigGlobalObject.js#L26"
              >JavaScriptCore built-in function</a
            >.
          </p>
          <h3 id="buntranspiler"><code>Bun.Transpiler</code></h3>
          <p>
            <code>Bun.Transpiler</code> lets you use Bun's transpiler from
            JavaScript (available in Bun.js)
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Loader</span> = <span class="hljs-string">"jsx"</span> | <span class="hljs-string">"js"</span> | <span class="hljs-string">"ts"</span> | <span class="hljs-string">"tsx"</span>;
  
  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TranspilerOptions</span> {
    <span class="hljs-comment">// Replace key with value. Value must be a JSON string.</span>
    <span class="hljs-comment">// { "process.env.NODE_ENV": "\"production\"" }</span>
    <span class="hljs-attr">define</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;,
  
    <span class="hljs-comment">// What is the default loader used for this transpiler?</span>
    <span class="hljs-attr">loader</span>: <span class="hljs-title class_">Loader</span>,
  
    <span class="hljs-comment">// What platform are we targeting? This may affect how import and/or require is used</span>
    <span class="hljs-attr">platform</span>: <span class="hljs-string">"browser"</span> | <span class="hljs-string">"bun"</span> | <span class="hljs-string">"macro"</span> | <span class="hljs-string">"node"</span>,
  
    <span class="hljs-comment">// TSConfig.json file as stringified JSON or an object</span>
    <span class="hljs-comment">// Use this to set a custom JSX factory, fragment, or import source</span>
    <span class="hljs-comment">// For example, if you want to use Preact instead of React. Or if you want to use Emotion.</span>
    <span class="hljs-attr">tsconfig</span>: <span class="hljs-built_in">string</span> | <span class="hljs-title class_">TSConfig</span>,
  
    <span class="hljs-comment">// Replace imports with macros</span>
    <span class="hljs-attr">macros</span>: <span class="hljs-title class_">MacroMap</span>,
  }
  
  <span class="hljs-comment">// This lets you use macros</span>
  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MacroMap</span> {
    <span class="hljs-comment">// {</span>
    <span class="hljs-comment">//   "react-relay": {</span>
    <span class="hljs-comment">//     "graphql": "bun-macro-relay/bun-macro-relay.tsx"</span>
    <span class="hljs-comment">//   }</span>
    <span class="hljs-comment">// }</span>
    [<span class="hljs-attr">packagePath</span>: <span class="hljs-built_in">string</span>]: {
      [<span class="hljs-attr">importItemName</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">string</span>,
    },
  }
  
  <span class="hljs-keyword">class</span> <span class="hljs-title class_">Bun</span>.<span class="hljs-property">Transpiler</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options: TranspilerOptions</span>)
  
    <span class="hljs-title function_">transform</span>(<span class="hljs-attr">code</span>: <span class="hljs-built_in">string</span>, loader?: <span class="hljs-title class_">Loader</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;
    <span class="hljs-title function_">transformSync</span>(<span class="hljs-attr">code</span>: <span class="hljs-built_in">string</span>, loader?: <span class="hljs-title class_">Loader</span>): <span class="hljs-built_in">string</span>
  
    <span class="hljs-title function_">scan</span>(<span class="hljs-attr">code</span>: <span class="hljs-built_in">string</span>): {<span class="hljs-attr">exports</span>: <span class="hljs-built_in">string</span>[], <span class="hljs-attr">imports</span>: <span class="hljs-title class_">Import</span>}
    <span class="hljs-title function_">scanImports</span>(<span class="hljs-attr">code</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Import</span>[]
  }
  
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">Import</span> = {
    <span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>,
    <span class="hljs-attr">kind</span>:
    <span class="hljs-comment">// import foo from 'bar'; in JavaScript</span>
    | <span class="hljs-string">"import-statement"</span>
    <span class="hljs-comment">// require("foo") in JavaScript</span>
    | <span class="hljs-string">"require-call"</span>
    <span class="hljs-comment">// require.resolve("foo") in JavaScript</span>
    | <span class="hljs-string">"require-resolve"</span>
    <span class="hljs-comment">// Dynamic import() in JavaScript</span>
    | <span class="hljs-string">"dynamic-import"</span>
    <span class="hljs-comment">// @import() in CSS</span>
    | <span class="hljs-string">"import-rule"</span>
    <span class="hljs-comment">// url() in CSS</span>
    | <span class="hljs-string">"url-token"</span>
    <span class="hljs-comment">// The import was injected by Bun</span>
    | <span class="hljs-string">"internal"</span> 
    <span class="hljs-comment">// Entry point</span>
    <span class="hljs-comment">// Probably won't see this one</span>
    | <span class="hljs-string">"entry-point"</span>
  }
  
  <span class="hljs-keyword">const</span> transpiler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bun</span>.<span class="hljs-title class_">Transpiler</span>({ <span class="hljs-attr">loader</span>: <span class="hljs-string">"jsx"</span> });
  </code></pre>
          <h4 id="buntranspilertransformsync">
            <code>Bun.Transpiler.transformSync</code>
          </h4>
          <p>
            This lets you transpile JavaScript, TypeScript, TSX, and JSX using
            Bun's transpiler. It does not resolve modules.
          </p>
          <p>
            It is synchronous and runs in the same thread as other JavaScript
            code.
          </p>
          <pre><code class="hljs language-js"><span class="hljs-keyword">const</span> transpiler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bun</span>.<span class="hljs-title class_">Transpiler</span>({ <span class="hljs-attr">loader</span>: <span class="hljs-string">"jsx"</span> });
  transpiler.<span class="hljs-title function_">transformSync</span>(<span class="hljs-string">"&lt;div&gt;hi!&lt;/div&gt;"</span>);
  </code></pre>
          <pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { __require <span class="hljs-keyword">as</span> <span class="hljs-built_in">require</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:wrap"</span>;
  <span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">JSX</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"react/jsx-dev-runtime"</span>;
  <span class="hljs-keyword">var</span> jsx = <span class="hljs-built_in">require</span>(<span class="hljs-variable constant_">JSX</span>).<span class="hljs-property">jsxDEV</span>;
  
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">jsx</span>(
    <span class="hljs-string">"div"</span>,
    {
      <span class="hljs-attr">children</span>: <span class="hljs-string">"hi!"</span>,
    },
    <span class="hljs-literal">undefined</span>,
    <span class="hljs-literal">false</span>,
    <span class="hljs-literal">undefined</span>,
    <span class="hljs-variable language_">this</span>,
  );
  </code></pre>
          <p>
            If a macro is used, it will be run in the same thread as the
            transpiler, but in a separate event loop from the rest of your
            application. Currently, globals between macros and regular code are
            shared, which means it is possible (but not recommended) to share
            states between macros and regular code. Attempting to use AST nodes
            outside of a macro is undefined behavior.
          </p>
          <h4 id="buntranspilertransform">
            <code>Bun.Transpiler.transform</code>
          </h4>
          <p>
            This lets you transpile JavaScript, TypeScript, TSX, and JSX using
            Bun's transpiler. It does not resolve modules.
          </p>
          <p>
            It is async and automatically runs in Bun's worker threadpool. That
            means, if you run it 100 times, it will run it across
            <code>Math.floor($cpu_count * 0.8)</code> threads without blocking
            the main JavaScript thread.
          </p>
          <p>
            If code uses a macro, it will potentially spawn a new copy of
            Bun.js' JavaScript runtime environment in that new thread.
          </p>
          <p>
            Unless you're transpiling <em>many</em> large files, you should
            probably use <code>Bun.Transpiler.transformSync</code>. The cost of
            the threadpool will often take longer than actually transpiling
            code.
          </p>
          <pre><code class="hljs language-js"><span class="hljs-keyword">const</span> transpiler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bun</span>.<span class="hljs-title class_">Transpiler</span>({ <span class="hljs-attr">loader</span>: <span class="hljs-string">"jsx"</span> });
  <span class="hljs-keyword">await</span> transpiler.<span class="hljs-title function_">transform</span>(<span class="hljs-string">"&lt;div&gt;hi!&lt;/div&gt;"</span>);
  </code></pre>
          <pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { __require <span class="hljs-keyword">as</span> <span class="hljs-built_in">require</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:wrap"</span>;
  <span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">JSX</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"react/jsx-dev-runtime"</span>;
  <span class="hljs-keyword">var</span> jsx = <span class="hljs-built_in">require</span>(<span class="hljs-variable constant_">JSX</span>).<span class="hljs-property">jsxDEV</span>;
  
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">jsx</span>(
    <span class="hljs-string">"div"</span>,
    {
      <span class="hljs-attr">children</span>: <span class="hljs-string">"hi!"</span>,
    },
    <span class="hljs-literal">undefined</span>,
    <span class="hljs-literal">false</span>,
    <span class="hljs-literal">undefined</span>,
    <span class="hljs-variable language_">this</span>,
  );
  </code></pre>
          <p>You can also pass a <code>Loader</code> as a string</p>
          <pre><code class="hljs language-js"><span class="hljs-keyword">await</span> transpiler.<span class="hljs-title function_">transform</span>(<span class="hljs-string">"&lt;div&gt;hi!&lt;/div&gt;"</span>, <span class="hljs-string">"tsx"</span>);
  </code></pre>
          <h4 id="buntranspilerscan"><code>Bun.Transpiler.scan</code></h4>
          <p>
            This is a fast way to get a list of imports &amp; exports used in a
            JavaScript/jsx or TypeScript/tsx file.
          </p>
          <p>This function is synchronous.</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">const</span> transpiler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bun</span>.<span class="hljs-title class_">Transpiler</span>({ <span class="hljs-attr">loader</span>: <span class="hljs-string">"ts"</span> });
  
  transpiler.<span class="hljs-title function_">scan</span>(<span class="hljs-string">`
  import React from 'react';
  import Remix from 'remix';
  import type {ReactNode} from 'react';
  
  export const loader = () =&gt; import('./loader');
  `</span>);
  </code></pre>
          <pre><code class="hljs language-ts">{
    <span class="hljs-string">"exports"</span>: [
      <span class="hljs-string">"loader"</span>
    ],
    <span class="hljs-string">"imports"</span>: [
      {
        <span class="hljs-string">"kind"</span>: <span class="hljs-string">"import-statement"</span>,
        <span class="hljs-string">"path"</span>: <span class="hljs-string">"react"</span>
      },
      {
        <span class="hljs-string">"kind"</span>: <span class="hljs-string">"import-statement"</span>,
        <span class="hljs-string">"path"</span>: <span class="hljs-string">"remix"</span>
      },
      {
        <span class="hljs-string">"kind"</span>: <span class="hljs-string">"dynamic-import"</span>,
        <span class="hljs-string">"path"</span>: <span class="hljs-string">"./loader"</span>
      }
    ]
  }
  </code></pre>
          <h4 id="buntranspilerscanimports">
            <code>Bun.Transpiler.scanImports</code>
          </h4>
          <p>
            This is a fast path for getting a list of imports used in a
            JavaScript/jsx or TypeScript/tsx file. It skips the visiting pass,
            which means it is faster but less accurate. You probably won't
            notice a difference between <code>Bun.Transpiler.scan</code> and
            <code>Bun.Transpiler.scanImports</code> often. You might notice it
            for very large files (megabytes).
          </p>
          <p>This function is synchronous.</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">const</span> transpiler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bun</span>.<span class="hljs-title class_">Transpiler</span>({ <span class="hljs-attr">loader</span>: <span class="hljs-string">"ts"</span> });
  
  transpiler.<span class="hljs-title function_">scanImports</span>(<span class="hljs-string">`
  import React from 'react';
  import Remix from 'remix';
  import type {ReactNode} from 'react';
  
  export const loader = () =&gt; import('./loader');
  `</span>);
  </code></pre>
          <pre><code class="hljs language-json"><span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"kind"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"import-statement"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"react"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"kind"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"import-statement"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"remix"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"kind"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dynamic-import"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./loader"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
  </code></pre>
          <h2 id="module-resolution-in-bun">Module resolution in Bun</h2>
          <p>
            Loading &amp; resolving modules in JavaScript &amp; TypeScript is
            complicated.
          </p>
          <h3 id="module-loading">Module loading</h3>
          <p>
            Bun supports CommonJS and ESM. Bun automatically transpiles CommonJS
            into synchronous ESM. Bun assumes projects internally use ESM, but
            dependencies may use either ESM or CommonJS. Using CommonJS is
            discouraged in new projects because it lacks support for top-level
            await and syntax like <code>export * from</code> is less reliable in
            CommonJS (without bundling the entire dependency tree ahead of
            time).
          </p>
          <p>
            Bun supports the <code>"bun"</code> <code>exports</code> condition
            and will prefer that over other conditions.
          </p>
          <p>
            To load a bun-specific module, set the <code>"bun"</code> export
            condition in package.json:
          </p>
          <pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"foo"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"bun"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./index.bun.js"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"default"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./index.js"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
  </code></pre>
          <p>
            When importing <code>"foo"</code> in a bun project, it will load
            <code>./index.bun.js</code> instead of <code>./index.js</code>.
          </p>
          <p>
            If the library strictly uses ESM (excluding dependencies), specify
            <code>"type": "module"</code> in package.json.
          </p>
          <pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"foo"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"module"</span>
  <span class="hljs-punctuation">}</span>
  </code></pre>
          <h3 id="module-resolution">Module resolution</h3>
          <p>
            Bun implements the Node Module Resolution Algorithm, which is the
            same algorithm used by Node.js. It is also the same algorithm used
            by Webpack, Rollup, esbuild and many other bundlers.
          </p>
          <pre><code class="hljs language-js"><span class="hljs-keyword">import</span> <span class="hljs-string">"./foo"</span>;
  <span class="hljs-comment">// This will check:</span>
  <span class="hljs-comment">// - ./foo.ts</span>
  <span class="hljs-comment">// - ./foo.tsx</span>
  <span class="hljs-comment">// - ./foo.js</span>
  <span class="hljs-comment">// - ./foo.mjs</span>
  <span class="hljs-comment">// - ./foo.cjs</span>
  <span class="hljs-comment">// - ./foo/index.ts</span>
  <span class="hljs-comment">// - ./foo/index.js</span>
  <span class="hljs-comment">// - ./foo/index.json</span>
  <span class="hljs-comment">// - ./foo/index.mjs</span>
  </code></pre>
          <p>
            Bun also supports <code>package.json</code>, including
            <code>exports</code>, <code>imports</code>, <code>module</code>,
            <code>main</code> and <code>browser</code> fields.
          </p>
          <p>
            Bun supports <code>tsconfig.json</code>'s <code>paths</code> field,
            allowing you to override how paths resolve.
          </p>
          <pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"paths"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"foo"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"./bar"</span><span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
  </code></pre>
          <pre><code class="hljs language-js"><span class="hljs-keyword">import</span> <span class="hljs-string">"foo"</span>;
  <span class="hljs-comment">// This will check:</span>
  <span class="hljs-comment">// - ./bar</span>
  <span class="hljs-comment">// - ./bar.ts</span>
  <span class="hljs-comment">// - ./bar.tsx</span>
  <span class="hljs-comment">// - ./bar.js</span>
  <span class="hljs-comment">// - ./bar.mjs</span>
  <span class="hljs-comment">// - ./bar.cjs</span>
  <span class="hljs-comment">// - ./bar/index.ts</span>
  <span class="hljs-comment">// - ./bar/index.js</span>
  <span class="hljs-comment">// - ./bar/index.json</span>
  <span class="hljs-comment">// - ./bar/index.mjs</span>
  </code></pre>
          <p>
            You can also use <code>jsconfig.json</code> if you don't want to use
            TypeScript.
          </p>
          <h3 id="buns-module-resolution-algorithm">
            Bun's Module Resolution Algorithm
          </h3>
          <p><small>Added in Bun v0.3.0</small></p>
          <p>
            Bun's module resolution algorithm is a lot like Node's except one
            key difference: <code>node_modules</code> folder is optional and
            <code>package.json</code> is optional.
          </p>
          <p>Highlights:</p>
          <ul>
            <li>
              Automatic package installs, there is no need to run
              <code>npm install</code> or <code>bun install</code> before
              running a project.
            </li>
            <li>
              Save disk space &amp; time by not copying/linking dependencies
              into
              <code>node_modules</code>. Instead, Bun uses a shared global cache
              to store &amp; load dependencies from a single location on disk.
            </li>
            <li><code>package.json</code> is optional</li>
            <li>Compatible with npm packages</li>
            <li>
              Security: dependencies can't run postinstall scripts. No malicious
              code can be run when installing dependencies.
            </li>
            <li>
              One name@version of a dependency is used instead of multiple
              copies. Bun still supports different versions of the same package.
              Since
              <code>node_modules</code> relies on directory structure to resolve
              dependencies, projects often end up with the same name@version of
              a dependency installed multiple times in one
              <code>node_modules</code> folder. This is not a problem with Bun's
              module resolution algorithm because it uses a single flat global
              cache for all dependencies on your computer.
            </li>
          </ul>
          <p>
            For ecosystem compatibility, when the
            <code>node_modules</code> folder is present, it will be used to
            resolve modules like in node and Bun-specific features like
            automatic package installs are disabled.
          </p>
          <p>
            When the <code>node_modules</code> folder is <em>not</em> present,
            that's when it gets more interesting.
          </p>
          <p>
            Bun lazily loads a lockfile for the project. It checks for
            <code>bun.lockb</code> in the project root.
          </p>
          <p>
            If the lockfile is present, the lockfile will be used to resolve
            modules first. If the lockfile is not present, the lockfile will be
            lazily generated.
          </p>
          <pre><code class="hljs language-js"><span class="hljs-comment">// unspecified version:</span>
  <span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
  
  <span class="hljs-comment">// set version in import specifier: (only supported if no package.json is present)</span>
  <span class="hljs-keyword">import</span> <span class="hljs-title class_">React18</span>_2 <span class="hljs-keyword">from</span> <span class="hljs-string">"react@18.2.0"</span>;
  
  <span class="hljs-comment">// range version: (only supported if no package.json is present)</span>
  <span class="hljs-keyword">import</span> <span class="hljs-title class_">React18</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"react@^18"</span>;
  </code></pre>
          <p>
            It will check the lockfile for the version. If the lockfile doesn't
            have a version, it will check the nearest
            <code>package.json</code> for a <code>react</code> dependency and
            use that version. If the <code>package.json</code> doesn't have a
            <code>react</code> dependency, it will use the latest version. If
            the latest version is not installed in the global cache, it will
            download the latest version from npm's registry.
          </p>
          <p>Lowlights:</p>
          <ul>
            <li>TypeScript type support isn't implmented yet</li>
            <li>patch package support isn't implemented yet</li>
          </ul>
          <h4 id="resolving-packages">Resolving packages</h4>
          <p>
            <code>bun install</code> uses a shared global cache. After packages
            install, we add a symlink indexing the version of the package to
            allow us to quickly see what versions of a package are installed
            on-disk.
          </p>
          <p>
            Bun's module resolver shares the same global cache as
            <code>bun install</code> so it can resolve packages without needing
            to install them into a local <code>node_modules</code> folder.
            Instead, it uses the global cache to resolve packages.
          </p>
          <p>
            When you import a module like <code>lodash</code> in Bun without a
            node_modules folder, here's what happens:
          </p>
          <pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { debounce } <span class="hljs-keyword">from</span> <span class="hljs-string">"lodash"</span>;
  </code></pre>
          <ol>
            <li>
              Check if auto-install is enabled and if so, load the lockfile or
              lazily generate it.
            </li>
            <li>
              Check if the lockfile has an existing dependency for
              <code>lodash</code>.
            </li>
            <li>
              If the lockfile has an existing dependency for
              <code>lodash</code>, use the resolved version specified in the
              lockfile.
            </li>
            <li>
              If the lockfile does not have an existing resolved version for
              <code>lodash</code>, check if there is a
              <code>package.json</code> in the current or parent directories
              with a dependency on <code>lodash</code>. If so, use that as the
              range specifier for the dependency. Since no version is specified
              for the <code>"lodash"</code> string, it is assumed that you meant
              the version specified in the <code>package.json</code>'s
              <code>"dependencies"</code> field.
            </li>
            <li>
              If there is no <code>package.json</code> in the current or parent
              directories which has a dependency on <code>lodash</code>, use the
              latest version of <code>lodash</code> listed in the package
              manifest cache. If the package manifest cache is out of date,
              refresh it.
            </li>
            <li>
              Once a version is chosen, add the dependency to the lockfile and
              all the dependencies of the dependency to the lockfile.
            </li>
            <li>
              Return the file path to the resolved version of
              <code>lodash</code>. If the version is not installed on-disk,
              download &amp; install it, along with all dependencies.
            </li>
          </ol>
          <p>More details:</p>
          <ul>
            <li>
              <code>bun install</code> ordinarily caches package manifests from
              npm for up to 5 minutes. For automatic package installs in Bun's
              JavaScript runtime, that cache is refreshed daily instead. This is
              to minimize startup time cost when no lockfile is present.
            </li>
            <li>
              The <code>BUN_INSTALL_CACHE_DIR</code> environment variable lets
              you customize the location of the cache. Currently, it defaults to
              <code>$XDG_CACHE_HOME/.bun/install/cache</code> or
              <code>$HOME/.bun/install/cache</code>.
            </li>
            <li>
              The implementation details of Bun's install cache will change
              between versions. Don't think of it as an API. To reliably resolve
              packages, use bun's builtin APIs (such as
              <code>Bun.resolveSync</code> or <code>import.meta.resolve</code>)
              instead of relying on the filesystem directly. Bun will likely
              move to a binary archive format where packages may not correspond
              to files/folders on disk at all - so if you depend on the
              filesystem structure instead of the JavaScript API, your code will
              eventually break.
            </li>
          </ul>
          <h5 id="prefer-offline">Prefer offline</h5>
          <p>
            Instead of checking npm for latest versions, you can pass the
            <code>--prefer-offline</code> flag to prefer locally-installed
            versions of packages.
          </p>
          <pre><code class="hljs language-bash">bun run --prefer-offline my-script.ts
  </code></pre>
          <p>
            This will check the install cache for installed versions of packages
            before checking the npm registry. If no matching version of a
            package is installed, only then will it check npm for the latest
            version.
          </p>
          <h5 id="prefer-latest">Prefer latest</h5>
          <p>
            To always use the latest version of a package, you can pass the
            <code>--prefer-latest</code> flag.
          </p>
          <pre><code class="hljs language-bash">bun run --prefer-latest my-script.ts
  </code></pre>
          <h4 id="resolving-modules">Resolving modules</h4>
          <p>
            After ensuring the package is installed, Bun resolves the module.
          </p>
          <p>For the most part, this is the same as what Node.js does.</p>
          <p>
            The main difference is instead of looking for
            <code>node_modules</code> folders to resolve packages, Bun looks in
            bun's install cache.
          </p>
          <p>
            This only activates for "package paths". That is, paths that start
            with a package name. For example, <code>lodash/debounce</code> is a
            package path. <code>./foo</code> is not a package path.
          </p>
          <h4 id="frequently-asked-questions">Frequently asked questions</h4>
          <p><strong>How is this different than what Node.js does?</strong></p>
          <p>
            Per-project <code>node_modules</code> folders are not necessary when
            using Bun. This saves you disk space and time spent copying/linking
            dependencies into <code>node_modules</code> folders for every
            project.
          </p>
          <table>
            <thead>
              <tr>
                <th>Runtime</th>
                <th>require/import</th>
                <th>in package</th>
                <th>resolution</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Node.js</td>
                <td>"react-dom"</td>
                <td>"react"</td>
                <td><code>./node_modules/react-dom/index.js</code></td>
              </tr>
              <tr>
                <td>Bun</td>
                <td>"react-dom"</td>
                <td>"react"</td>
                <td>
                  <code
                    >$BUN_INSTALL_CACHE_DIR/react-dom@${version}/index.js</code
                  >
                </td>
              </tr>
            </tbody>
          </table>
          <p>
            When multiple versions of a package are installed, Node.js relies on
            the directory tree structure to resolve the correct version.
          </p>
          <p>
            Bun uses bun's lockfile to figure out what the version SHOULD be and
            then installs it into the global cache (if that version is not
            already installed).
          </p>
          <p>With a dependency tree like this:</p>
          <pre><code class="hljs language-zig">- root 1.0.0
    - dep1 1.0.0
      - dep2 1.0.0
      - dep3 1.0.0
        - dep2 2.0.0
    - dep2 2.0.0
  </code></pre>
          <p>
            To satisfy the Node.js Module Resolution algorithm, npm clients are
            forced to install the same version of <code>dep2</code>
            <strong>multiple times for the same project</strong>. This is
            because <code>dep2</code> is a dependency of <code>dep1</code> and
            <code>dep3</code>, and <code>dep3</code> depends on a different
            version of <code>dep2</code> than <code>dep1</code>.
          </p>
          <p>
            With Bun, the lockfile is used to resolve the correct version of
            <code>dep2</code> to use. This means that <code>dep2</code> only
            needs to be installed once and it will be reused for all projects on
            your computer that depend on it.
          </p>
          <p>
            <img
              src="https://user-images.githubusercontent.com/709451/198907459-710d5299-bac0-40d8-b630-8112d42900e1.png"
              alt="image"
            />
          </p>
          <p><strong>How do I debug an issue with a dependency?</strong></p>
          <p>
            If you run <code>bun install</code> (or any other npm package
            manager), it will create a <code>node_modules</code> folder and
            install dependencies into that folder.
          </p>
          <p>
            Bun's runtime continues to fully support the
            <code>node_modules</code> folder.
          </p>
          <p><strong>How is this different than what pnpm does?</strong></p>
          <p>
            With pnpm, you have to run <code>pnpm install</code>, which creates
            a <code>node_modules</code> folder of symlinks for the runtime to
            resolve.
          </p>
          <p>
            With Bun, you don't have to run any commands to install
            dependencies. Bun doesn't create a <code>node_modules</code> folder.
          </p>
          <p>
            Just run <code>bun run foo.js</code> and it will automatically
            install the dependencies for you on-demand.
          </p>
          <p>
            <strong>How is this different than Yarn Plug'N'Play does?</strong>
          </p>
          <p>Two things:</p>
          <ol>
            <li>
              Bun's JavaScript runtime automatically installs dependencies when
              running a file. With yarn, you have to run
              <code>yarn install</code> before you run a script.
            </li>
            <li>
              Yarn Plug'N'Play
              <a
                href="https://twitter.com/jarredsumner/status/1458207919636287490"
                >makes loading dependencies slower</a
              >
              at runtime because under the hood, it uses zip files to store
              dependencies. zip files tend not to be as performant for random
              access reads as files on disk.
            </li>
          </ol>
          <p><strong>How is this different than what Deno does?</strong></p>
          <p>
            Deno requires an <code>npm:</code> specifier before each npm import,
            lacks support for reading <code>"paths"</code> from tsconfig.json,
            and doesn't have as much support for package.json fields.
          </p>
          <p><strong>What about security?</strong></p>
          <p>
            Bun doesn't run postinstall scripts. No malicious code can be run
            from installing dependencies.
          </p>
          <p><strong>Can I use bun install with Node.js projects?</strong></p>
          <p>
            Yes. <code>bun install</code> creates a ordinary node_modules
            folder. It's designed to be compatible with other package managers
            and Node.js.
          </p>
          <h2 id="environment-variables">Environment variables</h2>
          <ul>
            <li>
              <code>GOMAXPROCS</code>: For <code>bun bun</code>, this sets the
              maximum number of threads to use. If you’re experiencing an issue
              with <code>bun bun</code>, try setting
              <code>GOMAXPROCS=1</code> to force bun to run single-threaded
            </li>
            <li>
              <code>DISABLE_BUN_ANALYTICS=1</code> this disables bun’s
              analytics. bun records bundle timings (so we can answer with data,
              "is bun getting faster?") and feature usage (e.g., "are people
              actually using macros?"). The request body size is about 60 bytes,
              so it’s not a lot of data
            </li>
            <li>
              <code>TMPDIR</code>: Before <code>bun bun</code> completes, it
              stores the new <code>.bun</code> in <code>$TMPDIR</code>. If
              unset, <code>TMPDIR</code> defaults to the platform-specific
              temporary directory (on Linux, <code>/tmp</code> and on macOS
              <code>/private/tmp</code>)
            </li>
          </ul>
          <h2 id="profiling-bun">Profiling Bun</h2>
          <p>
            To precisely measure time, Bun offers two runtime APIs functions:
          </p>
          <ol>
            <li>
              The web-standard
              <a
                href="https://developer.mozilla.org/en-US/docs/Web/API/Performance/now"
                ><code>performance.now()</code></a
              >
              function
            </li>
            <li>
              <code>Bun.nanoseconds()</code> which is similar to
              <code>performance.now()</code> except it returns the current time
              since the application started in nanoseconds. You can use
              <code>performance.timeOrigin</code> to convert this to a Unix
              timestamp.
            </li>
          </ol>
          <h3 id="benchmarking-bunserve">
            Benchmarking <code>Bun.serve</code>
          </h3>
          <p>
            You will need an HTTP client which is at least as fast as
            <code>Bun.serve()</code>.
          </p>
          <p>
            That means popular Node.js-based benchmarking tools like
            <strong>autocannon is not fast enough</strong>.
          </p>
          <p>Recommended HTTP clients:</p>
          <ul>
            <li>
              <a href="https://github.com/codesenberg/bombardier"
                ><code>bombardier</code></a
              >
            </li>
            <li>
              <a href="https://github.com/hatoo/oha"><code>oha</code></a>
            </li>
            <li>
              <a
                href="https://github.com/uNetworking/uSockets/blob/master/examples/http_load_test.c"
                ><code>http_load_test</code></a
              >
            </li>
          </ul>
          <h3 id="measuring-memory-usage">Measuring memory usage</h3>
          <p>
            Bun has two heaps. One heap is for the JavaScript runtime and the
            other heap is for everything else.
          </p>
          <h4 id="javascript-heap-stats">JavaScript heap stats</h4>
          <p>
            The <code>bun:jsc</code> module exposes a few functions for
            measuring memory usage:
          </p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { heapStats } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun:jsc"</span>;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">heapStats</span>());
  
  <span class="hljs-comment">// will show something like this:</span>
  {
    <span class="hljs-attr">heapSize</span>: <span class="hljs-number">1657575</span>,
    <span class="hljs-attr">heapCapacity</span>: <span class="hljs-number">2872775</span>,
    <span class="hljs-attr">extraMemorySize</span>: <span class="hljs-number">598199</span>,
    <span class="hljs-attr">objectCount</span>: <span class="hljs-number">13790</span>,
    <span class="hljs-attr">protectedObjectCount</span>: <span class="hljs-number">62</span>,
    <span class="hljs-attr">globalObjectCount</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">protectedGlobalObjectCount</span>: <span class="hljs-number">1</span>,
    <span class="hljs-comment">// A count of every object type in the heap</span>
    <span class="hljs-attr">objectTypeCounts</span>: {
      <span class="hljs-title class_">CallbackObject</span>: <span class="hljs-number">25</span>,
      <span class="hljs-title class_">FunctionExecutable</span>: <span class="hljs-number">2078</span>,
      <span class="hljs-title class_">AsyncGeneratorFunction</span>: <span class="hljs-number">2</span>,
      <span class="hljs-string">'RegExp String Iterator'</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">FunctionCodeBlock</span>: <span class="hljs-number">188</span>,
      <span class="hljs-title class_">ModuleProgramExecutable</span>: <span class="hljs-number">13</span>,
      <span class="hljs-title class_">String</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">UnlinkedModuleProgramCodeBlock</span>: <span class="hljs-number">13</span>,
      <span class="hljs-title class_">JSON</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">AsyncGenerator</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">Symbol</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">GetterSetter</span>: <span class="hljs-number">68</span>,
      <span class="hljs-title class_">ImportMeta</span>: <span class="hljs-number">10</span>,
      <span class="hljs-title class_">DOMAttributeGetterSetter</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">UnlinkedFunctionCodeBlock</span>: <span class="hljs-number">174</span>,
      <span class="hljs-title class_">RegExp</span>: <span class="hljs-number">52</span>,
      <span class="hljs-title class_">ModuleLoader</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">Intl</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">WeakMap</span>: <span class="hljs-number">4</span>,
      <span class="hljs-title class_">Generator</span>: <span class="hljs-number">2</span>,
      <span class="hljs-title class_">PropertyTable</span>: <span class="hljs-number">95</span>,
      <span class="hljs-string">'Array Iterator'</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">JSLexicalEnvironment</span>: <span class="hljs-number">75</span>,
      <span class="hljs-title class_">UnlinkedFunctionExecutable</span>: <span class="hljs-number">2067</span>,
      <span class="hljs-title class_">WeakSet</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">console</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">Map</span>: <span class="hljs-number">23</span>,
      <span class="hljs-title class_">SparseArrayValueMap</span>: <span class="hljs-number">14</span>,
      <span class="hljs-title class_">StructureChain</span>: <span class="hljs-number">19</span>,
      <span class="hljs-title class_">Set</span>: <span class="hljs-number">18</span>,
      <span class="hljs-string">'String Iterator'</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">FunctionRareData</span>: <span class="hljs-number">3</span>,
      <span class="hljs-title class_">JSGlobalLexicalEnvironment</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">Object</span>: <span class="hljs-number">481</span>,
      <span class="hljs-title class_">BigInt</span>: <span class="hljs-number">2</span>,
      <span class="hljs-title class_">StructureRareData</span>: <span class="hljs-number">55</span>,
      <span class="hljs-title class_">Array</span>: <span class="hljs-number">179</span>,
      <span class="hljs-title class_">AbortController</span>: <span class="hljs-number">2</span>,
      <span class="hljs-title class_">ModuleNamespaceObject</span>: <span class="hljs-number">11</span>,
      <span class="hljs-title class_">ShadowRealm</span>: <span class="hljs-number">1</span>,
      <span class="hljs-string">'Immutable Butterfly'</span>: <span class="hljs-number">103</span>,
      <span class="hljs-title class_">Primordials</span>: <span class="hljs-number">1</span>,
      <span class="hljs-string">'Set Iterator'</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">JSProxy</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">AsyncFromSyncIterator</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">ModuleRecord</span>: <span class="hljs-number">13</span>,
      <span class="hljs-title class_">FinalizationRegistry</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">AsyncIterator</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">InternalPromise</span>: <span class="hljs-number">22</span>,
      <span class="hljs-title class_">Iterator</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">CustomGetterSetter</span>: <span class="hljs-number">65</span>,
      <span class="hljs-title class_">Promise</span>: <span class="hljs-number">19</span>,
      <span class="hljs-title class_">WeakRef</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">InternalPromisePrototype</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">Function</span>: <span class="hljs-number">2381</span>,
      <span class="hljs-title class_">AsyncFunction</span>: <span class="hljs-number">2</span>,
      <span class="hljs-title class_">GlobalObject</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">ArrayBuffer</span>: <span class="hljs-number">2</span>,
      <span class="hljs-title class_">Boolean</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">Math</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">CallbackConstructor</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">Error</span>: <span class="hljs-number">2</span>,
      <span class="hljs-title class_">JSModuleEnvironment</span>: <span class="hljs-number">13</span>,
      <span class="hljs-title class_">WebAssembly</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">HashMapBucket</span>: <span class="hljs-number">300</span>,
      <span class="hljs-title class_">Callee</span>: <span class="hljs-number">3</span>,
      <span class="hljs-attr">symbol</span>: <span class="hljs-number">37</span>,
      <span class="hljs-attr">string</span>: <span class="hljs-number">2484</span>,
      <span class="hljs-title class_">Performance</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">ModuleProgramCodeBlock</span>: <span class="hljs-number">12</span>,
      <span class="hljs-title class_">JSSourceCode</span>: <span class="hljs-number">13</span>,
      <span class="hljs-title class_">JSPropertyNameEnumerator</span>: <span class="hljs-number">3</span>,
      <span class="hljs-title class_">NativeExecutable</span>: <span class="hljs-number">290</span>,
      <span class="hljs-title class_">Number</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">Structure</span>: <span class="hljs-number">1550</span>,
      <span class="hljs-title class_">SymbolTable</span>: <span class="hljs-number">108</span>,
      <span class="hljs-title class_">GeneratorFunction</span>: <span class="hljs-number">2</span>,
      <span class="hljs-string">'Map Iterator'</span>: <span class="hljs-number">1</span>
    },
    <span class="hljs-attr">protectedObjectTypeCounts</span>: {
      <span class="hljs-title class_">CallbackConstructor</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">BigInt</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">RegExp</span>: <span class="hljs-number">2</span>,
      <span class="hljs-title class_">GlobalObject</span>: <span class="hljs-number">1</span>,
      <span class="hljs-title class_">UnlinkedModuleProgramCodeBlock</span>: <span class="hljs-number">13</span>,
      <span class="hljs-title class_">HashMapBucket</span>: <span class="hljs-number">2</span>,
      <span class="hljs-title class_">Structure</span>: <span class="hljs-number">41</span>,
      <span class="hljs-title class_">JSPropertyNameEnumerator</span>: <span class="hljs-number">1</span>
    }
  }
  </code></pre>
          <p>
            JavaScript is a garbage-collected language, not reference counted.
            It's normal and correct for objects to not be freed immediately in
            all cases, though it's not normal for objects to never be freed.
          </p>
          <p>You can force garbage collection to run manually by calling:</p>
          <pre><code class="hljs language-js"><span class="hljs-keyword">const</span> synchronously = <span class="hljs-literal">true</span>;
  <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">gc</span>(synchronously);
  </code></pre>
          <h4 id="javascript-heap-snapshot">JavaScript heap snapshot</h4>
          <p>
            Heap snapshots let you inspect what objects are not being freed. You
            can use the <code>bun:jsc</code> module to take a heap snapshot and
            then view it with Safari or WebKit GTK developer tools.
          </p>
          <img
            width="1324"
            alt="image"
            src="https://user-images.githubusercontent.com/709451/204429337-b0d8935f-3509-4071-b991-217794d1fb27.png"
          />

          <p>To generate a heap snapshot:</p>
          <pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { generateHeapSnapshot } <span class="hljs-keyword">from</span> <span class="hljs-string">"bun"</span>;
  
  <span class="hljs-keyword">const</span> snapshot = <span class="hljs-title function_">generateHeapSnapshot</span>();
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Bun</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">"heap.json"</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(snapshot, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>));
  </code></pre>
          <p>
            To view the snapshot, open the <code>heap.json</code> file in
            Safari's Developer Tools (or WebKit GTK)
          </p>
          <ol>
            <li>Open the Developer Tools</li>
            <li>Click "Timeline"</li>
            <li>
              Click "JavaScript Allocations" in the menu on the left. It might
              not be visible until you click the pencil icon to show all the
              timelines
            </li>
            <li>Click "Import" and select your heap snapshot JSON</li>
          </ol>
          <p>
            <img
              src="https://user-images.githubusercontent.com/709451/204428943-ba999e8f-8984-4f23-97cb-b4e3e280363e.png"
              alt="image"
            />
          </p>
          <h4 id="native-heap-stats">Native heap stats</h4>
          <p>
            Bun uses mimalloc for the other heap. To report a summary of
            non-JavaScript memory usage, set the
            <code>MIMALLOC_SHOW_STATS=1</code> environment variable. and stats
            will print on exit.
          </p>
          <pre><code class="hljs language-js"><span class="hljs-variable constant_">MIMALLOC_SHOW_STATS</span>=<span class="hljs-number">1</span> bun script.<span class="hljs-property">js</span>
  
  # will show something like <span class="hljs-attr">this</span>:
  heap <span class="hljs-attr">stats</span>:    peak      total      freed    current       unit      count
    <span class="hljs-attr">reserved</span>:   <span class="hljs-number">64.0</span> <span class="hljs-title class_">MiB</span>   <span class="hljs-number">64.0</span> <span class="hljs-title class_">MiB</span>      <span class="hljs-number">0</span>       <span class="hljs-number">64.0</span> <span class="hljs-title class_">MiB</span>                        not all freed!
   <span class="hljs-attr">committed</span>:   <span class="hljs-number">64.0</span> <span class="hljs-title class_">MiB</span>   <span class="hljs-number">64.0</span> <span class="hljs-title class_">MiB</span>      <span class="hljs-number">0</span>       <span class="hljs-number">64.0</span> <span class="hljs-title class_">MiB</span>                        not all freed!
       <span class="hljs-attr">reset</span>:      <span class="hljs-number">0</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                            ok
     <span class="hljs-attr">touched</span>:  <span class="hljs-number">128.5</span> <span class="hljs-title class_">KiB</span>  <span class="hljs-number">128.5</span> <span class="hljs-title class_">KiB</span>    <span class="hljs-number">5.4</span> <span class="hljs-title class_">MiB</span>   -<span class="hljs-number">5.3</span> <span class="hljs-title class_">MiB</span>                        ok
    <span class="hljs-attr">segments</span>:      <span class="hljs-number">1</span>          <span class="hljs-number">1</span>          <span class="hljs-number">0</span>          <span class="hljs-number">1</span>                            not all freed!
  -<span class="hljs-attr">abandoned</span>:      <span class="hljs-number">0</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                            ok
     -<span class="hljs-attr">cached</span>:      <span class="hljs-number">0</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                            ok
       <span class="hljs-attr">pages</span>:      <span class="hljs-number">0</span>          <span class="hljs-number">0</span>         <span class="hljs-number">53</span>        -<span class="hljs-number">53</span>                            ok
  -<span class="hljs-attr">abandoned</span>:      <span class="hljs-number">0</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                            ok
   -<span class="hljs-attr">extended</span>:      <span class="hljs-number">0</span>
   -<span class="hljs-attr">noretire</span>:      <span class="hljs-number">0</span>
       <span class="hljs-attr">mmaps</span>:      <span class="hljs-number">0</span>
     <span class="hljs-attr">commits</span>:      <span class="hljs-number">0</span>
     <span class="hljs-attr">threads</span>:      <span class="hljs-number">0</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>          <span class="hljs-number">0</span>                            ok
    <span class="hljs-attr">searches</span>:     <span class="hljs-number">0.0</span> avg
  numa <span class="hljs-attr">nodes</span>:       <span class="hljs-number">1</span>
     <span class="hljs-attr">elapsed</span>:       <span class="hljs-number">0.068</span> s
     <span class="hljs-attr">process</span>: <span class="hljs-attr">user</span>: <span class="hljs-number">0.061</span> s, <span class="hljs-attr">system</span>: <span class="hljs-number">0.014</span> s, <span class="hljs-attr">faults</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">rss</span>: <span class="hljs-number">57.4</span> <span class="hljs-title class_">MiB</span>, <span class="hljs-attr">commit</span>: <span class="hljs-number">64.0</span> <span class="hljs-title class_">MiB</span>
  </code></pre>
          <h2 id="credits">Credits</h2>
          <ul>
            <li>
              While written in Zig instead of Go, bun’s JS transpiler, CSS
              lexer, and node module resolver source code is based on
              <a href="https://github.com/evanw">@evanw</a>’s
              <a href="https://github.com/evanw/esbuild">esbuild</a> project.
              Evan did a fantastic job with esbuild.
            </li>
            <li>
              The idea for the name "bun" came from
              <a href="https://github.com/kipply">@kipply</a>
            </li>
          </ul>
          <h2 id="license">License</h2>
          <p>bun itself is MIT-licensed.</p>
          <p>
            However, JavaScriptCore (and WebKit) is LGPL-2 and bun statically
            links it. WebCore files from WebKit are also licensed under LGPL2.
          </p>
          <p>Per LGPL2:</p>
          <blockquote>
            <p>
              (1) If you statically link against an LGPL’d library, you must
              also provide your application in an object (not necessarily
              source) format, so that a user has the opportunity to modify the
              library and relink the application.
            </p>
          </blockquote>
          <p>
            You can find the patched version of WebKit used by bun here:
            <a href="https://github.com/oven-sh/webkit"
              >https://github.com/oven-sh/webkit</a
            >. If you would like to relink bun with changes:
          </p>
          <ul>
            <li><code>git submodule update --init --recursive</code></li>
            <li><code>make jsc</code></li>
            <li><code>zig build</code></li>
          </ul>
          <p>
            This compiles JavaScriptCore, compiles bun’s
            <code>.cpp</code> bindings for JavaScriptCore (which are the object
            files using JavaScriptCore) and outputs a new
            <code>bun</code> binary with your changes.
          </p>
          <p>bun also statically links these libraries:</p>
          <ul>
            <li>
              <a href="https://boringssl.googlesource.com/boringssl/"
                ><code>boringssl</code></a
              >, which has
              <a
                href="https://boringssl.googlesource.com/boringssl/+/refs/heads/master/LICENSE"
                >several licenses</a
              >
            </li>
            <li>
              <a href="https://github.com/libarchive/libarchive"
                ><code>libarchive</code></a
              >, which has
              <a
                href="https://github.com/libarchive/libarchive/blob/master/COPYING"
                >several licenses</a
              >
            </li>
            <li>
              <a href="https://github.com/cloudflare/lol-html/tree/master/c-api"
                ><code>lol-html</code></a
              >, which is BSD 3-Clause licensed
            </li>
            <li>
              <a href="https://github.com/microsoft/mimalloc"
                ><code>mimalloc</code></a
              >, which is MIT licensed
            </li>
            <li>
              <a href="https://github.com/h2o/picohttpparser"
                ><code>picohttp</code></a
              >, which is dual-licensed under the Perl License or the MIT
              License
            </li>
            <li>
              <a href="https://github.com/simdutf/simdutf"
                ><code>simdutf</code></a
              >, which is Apache 2.0 licensed
            </li>
            <li>
              <a href="https://github.com/tinycc/tinycc"><code>tinycc</code></a
              >, which is LGPL v2.1 licensed
            </li>
            <li>
              <a href="https://github.com/uNetworking/uSockets"
                ><code>uSockets</code></a
              >, which is Apache 2.0 licensed
            </li>
            <li>
              <a href="https://github.com/cloudflare/zlib"
                ><code>zlib-cloudflare</code></a
              >, which is zlib licensed
            </li>
            <li>
              <a href="https://github.com/c-ares/c-ares"><code>c-ares</code></a
              >, which is MIT licensed
            </li>
            <li>
              <code>libicu</code> 72, which can be found here:
              <a
                href="https://github.com/unicode-org/icu/blob/main/icu4c/LICENSE"
                >https://github.com/unicode-org/icu/blob/main/icu4c/LICENSE</a
              >
            </li>
            <li>
              A fork of
              <a href="https://github.com/jarred-sumner/uwebsockets"
                ><code>uWebsockets</code></a
              >, which is Apache 2.0 licensed
            </li>
          </ul>
          <p>
            For compatibility reasons, these NPM packages are embedded into
            bun’s binary and injected if imported.
          </p>
          <ul>
            <li>
              <a href="https://npmjs.com/package/assert"><code>assert</code></a>
              (MIT license)
            </li>
            <li>
              <a href="https://npmjs.com/package/browserify-zlib"
                ><code>browserify-zlib</code></a
              >
              (MIT license)
            </li>
            <li>
              <a href="https://npmjs.com/package/buffer"><code>buffer</code></a>
              (MIT license)
            </li>
            <li>
              <a href="https://npmjs.com/package/constants-browserify"
                ><code>constants-browserify</code></a
              >
              (MIT license)
            </li>
            <li>
              <a href="https://npmjs.com/package/crypto-browserify"
                ><code>crypto-browserify</code></a
              >
              (MIT license)
            </li>
            <li>
              <a href="https://npmjs.com/package/domain-browser"
                ><code>domain-browser</code></a
              >
              (MIT license)
            </li>
            <li>
              <a href="https://npmjs.com/package/events"><code>events</code></a>
              (MIT license)
            </li>
            <li>
              <a href="https://npmjs.com/package/https-browserify"
                ><code>https-browserify</code></a
              >
              (MIT license)
            </li>
            <li>
              <a href="https://npmjs.com/package/os-browserify"
                ><code>os-browserify</code></a
              >
              (MIT license)
            </li>
            <li>
              <a href="https://npmjs.com/package/path-browserify"
                ><code>path-browserify</code></a
              >
              (MIT license)
            </li>
            <li>
              <a href="https://npmjs.com/package/process"
                ><code>process</code></a
              >
              (MIT license)
            </li>
            <li>
              <a href="https://npmjs.com/package/punycode"
                ><code>punycode</code></a
              >
              (MIT license)
            </li>
            <li>
              <a href="https://npmjs.com/package/querystring-es3"
                ><code>querystring-es3</code></a
              >
              (MIT license)
            </li>
            <li>
              <a href="https://npmjs.com/package/stream-browserify"
                ><code>stream-browserify</code></a
              >
              (MIT license)
            </li>
            <li>
              <a href="https://npmjs.com/package/stream-http"
                ><code>stream-http</code></a
              >
              (MIT license)
            </li>
            <li>
              <a href="https://npmjs.com/package/string_decoder"
                ><code>string_decoder</code></a
              >
              (MIT license)
            </li>
            <li>
              <a href="https://npmjs.com/package/timers-browserify"
                ><code>timers-browserify</code></a
              >
              (MIT license)
            </li>
            <li>
              <a href="https://npmjs.com/package/tty-browserify"
                ><code>tty-browserify</code></a
              >
              (MIT license)
            </li>
            <li>
              <a href="https://npmjs.com/package/url"><code>url</code></a> (MIT
              license)
            </li>
            <li>
              <a href="https://npmjs.com/package/util"><code>util</code></a>
              (MIT license)
            </li>
            <li>
              <a href="https://npmjs.com/package/vm-browserify"
                ><code>vm-browserify</code></a
              >
              (MIT license)
            </li>
          </ul>
          <h2 id="developing-bun">Developing bun</h2>
          <p>
            Some links you should read about JavaScriptCore, the JavaScript
            engine Bun uses:
          </p>
          <ul>
            <li>
              <a
                href="https://webkit.org/blog/12967/understanding-gc-in-jsc-from-scratch/"
                >https://webkit.org/blog/12967/understanding-gc-in-jsc-from-scratch/</a
              >
            </li>
            <li>
              <a
                href="https://webkit.org/blog/7122/introducing-riptide-webkits-retreating-wavefront-concurrent-garbage-collector/"
                >https://webkit.org/blog/7122/introducing-riptide-webkits-retreating-wavefront-concurrent-garbage-collector/</a
              >
            </li>
          </ul>
          <p>
            To get your development environment configured, expect it to take
            30-90 minutes :(
          </p>
          <h3 id="dev-container-linuxwindows">Dev Container (Linux/Windows)</h3>
          <p>
            The <a href="https://containers.dev">Dev Container</a> in this
            repository is the easiest way to get started. It comes with Zig,
            JavaScriptCore, Zig Language Server, vscode-zig, and more
            pre-installed on an instance of Ubuntu.
          </p>
          <img
            src="https://user-images.githubusercontent.com/709451/147319227-6446589c-a4d9-480d-bd5b-43037a9e56fd.png"
          />

          <p>
            To develop on Linux/Windows,
            <a href="https://www.docker.com">Docker</a> is required. If using
            WSL on Windows, it is recommended to use
            <a
              href="https://docs.microsoft.com/en-us/windows/wsl/tutorials/wsl-containers"
              >Docker Desktop</a
            >
            for its WSL2 integration.
          </p>
          <h4 id="visual-studio-code">Visual Studio Code</h4>
          <p>
            If you're using VSCode, you'll need to have the
            <a
              href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers"
              >Dev Containers</a
            >
            extension installed.
          </p>
          <p>
            To get started, open VS Code in the <code>bun</code> repository. The
            first time you try to open the dev container, the extension will
            automatically build it for you, based on
            <a href="Dockerfile.devcontainer"
              ><code>Dockerfile.devcontainer</code></a
            >.
          </p>
          <p>
            To open the dev container, open the command palette (Ctrl + Shift +
            P) and run: <code>Dev Containers: Reopen in Container</code>. To
            later rebuild it (only needed when the devcontainer itself changes,
            not the bun code), run:
            <code>Dev Containers: Rebuild and Reopen in Container</code>.
          </p>
          <h4 id="other-editors-and-cli">Other editors and CLI</h4>
          <p>
            If you're using another editor or want to manually control the dev
            container from the command line or a script, you'll need to install
            the
            <a href="https://www.npmjs.com/package/@devcontainers/cli"
              >Dev Container CLI</a
            >: <code>npm install -g @devcontainers/cli</code>.
          </p>
          <p>
            To create and start the dev container, in the
            <code>bun</code> repository, locally run:
          </p>
          <pre><code class="hljs language-bash"><span class="hljs-comment"># `make devcontainer-&lt;command&gt;` should be equivalent to `devcontainer &lt;command&gt;`, it just sets the</span>
  <span class="hljs-comment"># architecture so if you're on ARM64, it'll do the right thing</span>
  make devcontainer-up
  </code></pre>
          <p>To just build the dev container image, run:</p>
          <pre><code class="hljs language-bash">make devcontainer-build
  </code></pre>
          <p>To start a shell inside the container, run:</p>
          <pre><code class="hljs language-bash">make devcontainer-sh
  
  <span class="hljs-comment"># if it attaches to the container non-interactively, instead use the regular docker exec command:</span>
  docker <span class="hljs-built_in">exec</span> -it &lt;container-name/id&gt; zsh
  </code></pre>
          <h4 id="in-the-dev-container">In the dev container</h4>
          <p>
            You will then need to clone the GitHub repository inside that
            container.
          </p>
          <p>Inside the container, run this:</p>
          <pre><code class="hljs language-bash"><span class="hljs-comment"># First time setup</span>
  gh auth login <span class="hljs-comment"># if it fails to open a browser, use Personal Access Token instead</span>
  gh repo <span class="hljs-built_in">clone</span> oven-sh/bun . -- --depth=1 --progress -j8
  
  <span class="hljs-comment"># Compile bun dependencies (zig is already compiled)</span>
  make devcontainer
  
  <span class="hljs-comment"># It initializes and updates all submodules except webkit, because webkit takes a while and it's already compiled for you.</span>
  <span class="hljs-comment"># To do it manually, use:</span>
  <span class="hljs-comment"># git -c submodule."src/bun.js/WebKit".update=none submodule update --init --recursive --depth=1 --progress</span>
  
  <span class="hljs-comment"># Build bun for development</span>
  make dev
  
  <span class="hljs-comment"># Run bun</span>
  bun-debug
  </code></pre>
          <p>
            It is very similar to my own development environment (except I use
            macOS)
          </p>
          <h3 id="macos">MacOS</h3>
          <p>Install LLVM 15 and homebrew dependencies:</p>
          <pre><code class="hljs language-bash">brew install llvm@15 coreutils libtool cmake libiconv automake ninja gnu-sed pkg-config esbuild go rust
  </code></pre>
          <p>
            bun (&amp; the version of Zig) need LLVM 15 and Clang 15 (clang is
            part of LLVM). Weird build &amp; runtime errors will happen
            otherwise.
          </p>
          <p>Make sure LLVM 15 is in your <code>$PATH</code>:</p>
          <pre><code class="hljs language-bash"><span class="hljs-built_in">which</span> clang-15
  </code></pre>
          <p>If it is not, you will have to run this to link it:</p>
          <pre><code class="hljs language-bash"><span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"<span class="hljs-subst">$(brew --prefix llvm@15)</span>/bin"</span>
  <span class="hljs-built_in">export</span> LDFLAGS=<span class="hljs-string">"<span class="hljs-variable">$LDFLAGS</span> -L<span class="hljs-subst">$(brew --prefix llvm@15)</span>/lib"</span>
  <span class="hljs-built_in">export</span> CPPFLAGS=<span class="hljs-string">"<span class="hljs-variable">$CPPFLAGS</span> -I<span class="hljs-subst">$(brew --prefix llvm@15)</span>/include"</span>
  </code></pre>
          <p>
            On fish that looks like
            <code>fish_add_path (brew --prefix llvm@15)/bin</code>
          </p>
          <h4 id="install-zig-macos">Install Zig (macOS)</h4>
          <p>Install the latest version of Zig via Homebrew:</p>
          <pre><code class="hljs language-bash">brew install zig --<span class="hljs-built_in">head</span>
  </code></pre>
          <h4 id="build-bun-macos">Build bun (macOS)</h4>
          <p>One-off command to run:</p>
          <pre><code class="hljs language-bash"><span class="hljs-comment"># If you omit --depth=1, `git submodule update` will take 17.5 minutes on 1gbps internet, mostly due to WebKit.</span>
  git submodule update --init --recursive --progress --depth=1 --checkout
  make vendor identifier-cache webcrypto-debug
  </code></pre>
          <p>To compile C++ code:</p>
          <pre><code class="hljs language-bash"><span class="hljs-comment"># don't forget -j or you will spend like 30 minutes compiling</span>
  make bindings -j12
  </code></pre>
          <p>
            To compile Zig code and link <code>bun-debug</code> into
            <code>packages/debug-bun-darwin-${arch}/bun-debug</code>:
          </p>
          <pre><code class="hljs language-bash">make dev
  </code></pre>
          <p>
            These are separate commands to (usually) save you time, but you can
            combine them like so:
          </p>
          <pre><code class="hljs language-bash">make bindings -j12 &amp;&amp; make dev
  </code></pre>
          <h4 id="verify-it-worked-macos">Verify it worked (macOS)</h4>
          <pre><code class="hljs language-bash">packages/debug-bun-darwin-*/bun-debug --version
  </code></pre>
          <p>
            It should print <code>bun 0.4.0__dev</code> or something similar.
          </p>
          <p>
            You will want to add
            <code>packages/debug-bun-darwin-arm64/</code> or
            <code>packages/debug-bun-darwin-x64/</code> to your
            <code>$PATH</code> so you can run <code>bun-debug</code> from
            anywhere.
          </p>
          <h4 id="javascript-builtins">JavaScript builtins</h4>
          <p>
            When you change anything in <code>src/bun.js/builtins/js/*</code>,
            you need to run this:
          </p>
          <pre><code class="hljs language-bash">make clean-bindings generate-builtins &amp;&amp; make bindings -j12
  </code></pre>
          <p>
            That inlines the JavaScript code into C++ headers using the same
            builtins generator script that Safari uses.
          </p>
          <h4 id="code-generation-scripts">Code generation scripts</h4>
          <p>Bun leverages a lot of code generation scripts</p>
          <p>
            <a href="./src/bun.js/bindings/headers.h"
              >./src/bun.js/bindings/headers.h</a
            >
            has bindings to &amp; from Zig &lt;&gt; C++ code. This file is
            generated by running the following:
          </p>
          <pre><code class="hljs language-bash">make headers
  </code></pre>
          <p>
            This ensures that the types for Zig and the types for C++ match up
            correctly, by using comptime reflection over functions
            exported/imported.
          </p>
          <p>
            TypeScript files that end with <code>*.classes.ts</code> are another
            code generation script. They generate C++ boilerplate for classes
            implemented in Zig. The generated code lives in:
          </p>
          <ul>
            <li>
              <a href="src/bun.js/bindings/ZigGeneratedClasses.cpp"
                >src/bun.js/bindings/ZigGeneratedClasses.cpp</a
              >
            </li>
            <li>
              <a href="src/bun.js/bindings/ZigGeneratedClasses.h"
                >src/bun.js/bindings/ZigGeneratedClasses.h</a
              >
            </li>
            <li>
              <a href="src/bun.js/bindings/generated_classes.zig"
                >src/bun.js/bindings/generated_classes.zig</a
              >
            </li>
          </ul>
          <p>To generate the code, run:</p>
          <pre><code class="hljs language-bash">make codegen
  </code></pre>
          <p>
            Lastly, we also have a
            <a href="src/bun.js/scripts/generate-jssink.js"
              >code generation script</a
            >
            for our native stream implementations.
          </p>
          <p>To run that, run:</p>
          <pre><code class="hljs language-bash">make generate-sink
  </code></pre>
          <p>You probably won't need to run that one much.</p>
          <h3 id="modifying-esm-core-modules">Modifying ESM core modules</h3>
          <p>
            How to modify ESM modules like <code>node:fs</code>,
            <code>node:path</code>, <code>node:stream</code>,
            <code>bun:sqlite</code>:
          </p>
          <p>
            ESM modules implemented in JavaScript live in
            <code>*.exports.js</code> within src/bun.js.
          </p>
          <p>
            While bun is in beta, you can modify them at runtime in release
            builds via the environment variable
            <code>BUN_OVERRIDE_MODULE_PATH</code>.
          </p>
          <p>
            This will look at a folder for a file with the same name as in
            src/bun.js/*.exports.js and if it exists, it will use that instead.
            This is useful for testing changes to the ESM modules without
            needing to compile Bun.
          </p>
          <h4 id="troubleshooting-macos">Troubleshooting (macOS)</h4>
          <p>
            If you see an error when compiling <code>libarchive</code>, run
            this:
          </p>
          <pre><code class="hljs language-bash">brew install pkg-config
  </code></pre>
          <p>
            If you see an error about missing files on
            <code>zig build obj</code>, make sure you built the headers
          </p>
          <h2 id="vscode-zig">vscode-zig</h2>
          <p>Note: this is automatically installed on the devcontainer</p>
          <p>
            You will want to install the fork of <code>vscode-zig</code> so you
            get a <code>Run test</code> and a <code>Debug test</code> button.
          </p>
          <p>To do that:</p>
          <pre><code class="hljs language-bash">curl -L https://github.com/Jarred-Sumner/vscode-zig/releases/download/fork-v1/zig-0.2.5.vsix &gt; vscode-zig.vsix
  code --install-extension vscode-zig.vsix
  </code></pre>
          <p>
            <a
              target="_blank"
              href="https://github.com/jarred-sumner/vscode-zig"
              ><img
                src="https://pbs.twimg.com/media/FBZsKHlUcAYDzm5?format=jpg&amp;name=large"
            /></a>
          </p>
          <h3 id="troubleshooting-general">Troubleshooting (general)</h3>
          <p>
            If you encounter
            <code>error: the build command failed with exit code 9</code> during
            the build process, this means you ran out of memory or swap. Bun
            currently needs about 22 GB of RAM to compile.
          </p>
        </article>
      </custom-element>
    </main>
  </body>
</html>
